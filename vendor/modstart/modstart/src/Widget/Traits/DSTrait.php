<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Widget\Traits; use Illuminate\Support\Facades\DB; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Util\TimeUtil; trait DSTrait { protected function dsTableCountSeriesDaily($aibkj, $pzyNL, $xTHe7 = array()) { goto MT4lw; yuqa5: foreach ($xTHe7 as $kOFY1 => $WtOOL) { goto wQTQo; a81gz: $nx179 = ModelUtil::model($WtOOL['table'])->where('created_at', '>=', $AVf__)->where('created_at', '<', $kLBXS)->where($WtOOL['where'])->groupBy('_time')->get(array(DB::raw('DATE_FORMAT(created_at, \'%Y-%m-%d\') _time'), DB::raw('COUNT(1) AS _cnt')))->toArray(); goto cS0Za; wQTQo: if (empty($WtOOL['where'])) { $WtOOL['where'] = array(); } goto a81gz; cS0Za: foreach ($nx179 as $DUr2V) { $EtuTN[$DUr2V['_time']][$kOFY1] = $DUr2V['_cnt']; } goto yTLJg; yTLJg: } goto QcyFR; LQ3T7: $kLBXS = $pzyNL . ' 23:59:59'; goto Pp69e; K3Va1: for ($tM49X = $Wzqzm; $tM49X < $ts5Yu; $tM49X += TimeUtil::PERIOD_DAY) { $DUr2V = array(); foreach ($xTHe7 as $WtOOL) { $DUr2V[] = 0; } $EtuTN[date('Y-m-d', $tM49X)] = $DUr2V; } goto yuqa5; Pp69e: $Wzqzm = strtotime($AVf__); goto QAa1Z; QcyFR: $HwawJ = array(); goto Mnk4e; QAa1Z: $ts5Yu = strtotime($kLBXS); goto HQ85e; Mnk4e: $gqNXa = array_values($EtuTN); goto OiQ6s; nQx7W: return array('time' => array_keys($EtuTN), 'values' => $HwawJ); goto hDBUk; HQ85e: $EtuTN = array(); goto K3Va1; MT4lw: $AVf__ = $aibkj . ' 00:00:00'; goto LQ3T7; OiQ6s: foreach ($xTHe7 as $kOFY1 => $WtOOL) { foreach ($gqNXa as $w_wOU) { $HwawJ[$kOFY1][] = $w_wOU[$kOFY1]; } } goto nQx7W; hDBUk: } protected function dsTableSumSeriesDaily($aibkj, $pzyNL, $xTHe7 = array()) { goto KEpQG; mBCIw: $Wzqzm = strtotime($AVf__); goto jqTxS; f0bih: $EtuTN = array(); goto GuuSC; MjNsJ: $gqNXa = array_values($EtuTN); goto i0m3v; KEpQG: $AVf__ = $aibkj . ' 00:00:00'; goto I46d4; I46d4: $kLBXS = $pzyNL . ' 23:59:59'; goto mBCIw; i0m3v: foreach ($xTHe7 as $kOFY1 => $WtOOL) { foreach ($gqNXa as $w_wOU) { $HwawJ[$kOFY1][] = $w_wOU[$kOFY1]; } } goto TkKEW; LV4hL: $HwawJ = array(); goto MjNsJ; GuuSC: for ($tM49X = $Wzqzm; $tM49X < $ts5Yu; $tM49X += TimeUtil::PERIOD_DAY) { $DUr2V = array(); foreach ($xTHe7 as $WtOOL) { $DUr2V[] = 0; } $EtuTN[date('Y-m-d', $tM49X)] = $DUr2V; } goto pc5Cv; TkKEW: return array('time' => array_keys($EtuTN), 'values' => $HwawJ); goto jOQPu; jqTxS: $ts5Yu = strtotime($kLBXS); goto f0bih; pc5Cv: foreach ($xTHe7 as $kOFY1 => $WtOOL) { goto NElBp; D9wFj: $nx179 = ModelUtil::model($WtOOL['table'])->where($WtOOL['where'])->where('created_at', '>=', $AVf__)->where('created_at', '<', $kLBXS)->groupBy('_time')->get(array(DB::raw('DATE_FORMAT(created_at, \'%Y-%m-%d\') _time'), DB::raw('SUM(' . $WtOOL['field'] . ') AS _total')))->toArray(); goto jtjwF; NElBp: if (empty($WtOOL['where'])) { $WtOOL['where'] = array(); } goto D9wFj; jtjwF: foreach ($nx179 as $DUr2V) { $EtuTN[$DUr2V['_time']][$kOFY1] = $DUr2V['_total']; } goto CBfjH; CBfjH: } goto LV4hL; jOQPu: } }