<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Admin\Layout; use Illuminate\Contracts\Support\Renderable; use ModStart\Admin\Auth\AdminPermission; use ModStart\Core\Dao\DynamicModel; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Core\Util\IdUtil; use ModStart\Core\Util\SerializeUtil; use ModStart\Field\AbstractField; use ModStart\Form\Form; use ModStart\Layout\Page; use ModStart\Repository\RepositoryUtil; use ModStart\Widget\Box; class AdminConfigBuilder implements Renderable { private $page; private $form; private $pagePrepend = array(); private $config = array('disableBoxWrap' => false); public function __construct() { $this->form = new Form(DynamicModel::class); $this->useFrame(); } public function form() { return $this->form; } public function page() { return $this->page; } public function useFrame() { $this->page = new AdminPage(); $this->form->showReset(false)->showSubmit(true); } public function useDialog() { $this->page = new AdminDialogPage(); $this->form->showReset(false)->showSubmit(false); } public function pagePrepend($kuRG8) { array_unshift($this->pagePrepend, $kuRG8); } public function render() { goto fY6iM; V61XA: if (!$this->config['disableBoxWrap']) { $q5xOX = new Box($this->form, $this->page->pageTitle()); } goto zEn_B; zEn_B: $this->page->body($q5xOX); goto JlxOC; Y2Bt9: $q5xOX = $this->form; goto V61XA; fY6iM: if (!empty($this->pagePrepend)) { foreach ($this->pagePrepend as $DUr2V) { $this->page->row($DUr2V); } } goto Y2Bt9; JlxOC: return $this->page->render(); goto V8bPV; V8bPV: } public function perform($DUr2V = null, $k_TMY = null) { goto SLm56; nRn7o: if (null === $DUr2V) { goto sQEUA; kjVXi: $LyfCI = modstart_config(); goto mfCGt; sQEUA: $DUr2V = array(); goto kjVXi; mfCGt: foreach ($this->form->fields() as $dBa7F) { goto n2L9L; grmVw: $OYcjm = $LyfCI->has($dBa7F->column()); goto w4Ua8; u32dH: if (is_array($yFWLi)) { $yFWLi = SerializeUtil::jsonEncode($yFWLi); } goto Mp3D6; n2L9L: if ($dBa7F->isLayoutField()) { continue; } goto grmVw; w4Ua8: if ($OYcjm) { $yFWLi = modstart_config($dBa7F->column()); } else { $yFWLi = null; } goto u32dH; Mp3D6: $DUr2V[$dBa7F->column()] = $yFWLi; goto RbELR; RbELR: } goto kCVsd; kCVsd: } else { if (false === $DUr2V) { $DUr2V = array(); foreach ($this->form->fields() as $dBa7F) { if ($dBa7F->isLayoutField()) { continue; } $DUr2V[$dBa7F->column()] = null; } } } goto IZ41F; H2NGh: return $this; goto Krfpg; LvfXG: $this->form->fillFields(); goto H2NGh; SLm56: if (Request::isPost()) { AdminPermission::demoCheck(); return $this->form->formRequest(function (Form $c9K5c) use($k_TMY) { if ($k_TMY) { $nMi2c = call_user_func($k_TMY, $c9K5c); if (null !== $nMi2c) { return $nMi2c; } } else { $LyfCI = modstart_config(); foreach ($c9K5c->dataForming() as $dKmL2 => $yFWLi) { $LyfCI->set($dKmL2, $yFWLi); } } return Response::jsonSuccess(L('Save Success')); }); } goto nRn7o; IZ41F: $this->form->item(RepositoryUtil::itemFromArray($DUr2V)); goto LvfXG; Krfpg: } public function contentFixedBottomContentSave() { $this->contentFixedBottomContent('<button type="submit" class="btn btn-primary">' . L('Save') . '</button>'); } public function contentFixedBottomContent($irW2y) { goto foKwT; sHFr7: return $this; goto TBYhk; wkmgY: $this->layoutHtml('
<div class="content-fixed-bottom-toolbox-placeholder" id="' . $CeOJi . 'Placeholder"></div>
<div class="content-fixed-bottom-toolbox" id="' . $CeOJi . 'Content">' . $irW2y . '</div>
<script>$(function(){ $("#' . $CeOJi . 'Placeholder").css("height",20+$("#' . $CeOJi . 'Content").height()+"px"); });</script>
'); goto sHFr7; foKwT: $CeOJi = IdUtil::generate('ContentFixedBottomContent'); goto wkmgY; TBYhk: } public function __call($HQ4FM, $wnXyT) { goto BtBPI; BtBPI: if (isset($this->config[$HQ4FM])) { $this->config[$HQ4FM] = $wnXyT[0]; return $this; } goto JK0Av; IhklU: return $this->form->{$HQ4FM}(...$wnXyT); goto ud2rD; JK0Av: if (method_exists($this->page, $HQ4FM)) { return $this->page->{$HQ4FM}(...$wnXyT); } goto IhklU; ud2rD: } }