<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Admin\Controller; use Illuminate\Routing\Controller; use ModStart\Admin\Auth\Admin; use ModStart\Admin\Auth\AdminPermission; use ModStart\Admin\Layout\AdminPage; use ModStart\Core\Dao\DynamicModel; use ModStart\Core\Exception\ResultException; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Form\Form; use ModStart\Layout\Row; use ModStart\Widget\Box; class ProfileController extends Controller { public function changePassword(AdminPage $NYdGA) { goto owTmU; J6H6Q: $c9K5c->password('password', L('Password'))->rules('required'); goto a8xNi; owTmU: $c9K5c = new Form(DynamicModel::class); goto J6H6Q; OWc0j: if (Request::isPost()) { AdminPermission::demoCheck(); return $c9K5c->formRequest(function (Form $c9K5c) { $nx179 = $c9K5c->dataForming(); ResultException::throwsIf(L('New Password Not Match'), $nx179['passwordNew'] != $nx179['passwordRepeat']); $nMi2c = Admin::changePassword(Admin::id(), $nx179['password'], $nx179['passwordNew']); ResultException::throwsIfFail($nMi2c); Admin::addInfoLog(Admin::id(), L('Change password')); return Response::json(0, L('Password change correct, please relogin'), null, modstart_admin_url('logout')); }); } goto vL9OI; YaIZT: $c9K5c->password('passwordRepeat', L('Repeat Password'))->rules('required'); goto OWc0j; vL9OI: return $NYdGA->pageTitle(L('Change Password'))->row(function (Row $BnPIe) use($c9K5c) { $BnPIe->column(6, new Box($c9K5c, L('Change Password'))); }); goto Gv0Zb; a8xNi: $c9K5c->password('passwordNew', L('New Password'))->rules('required'); goto YaIZT; Gv0Zb: } }