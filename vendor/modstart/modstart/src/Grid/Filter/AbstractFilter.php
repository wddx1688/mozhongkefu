<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Grid\Filter; use Illuminate\Support\Facades\View; use ModStart\Core\Exception\BizException; use ModStart\Core\Util\IdUtil; use ModStart\Grid\Filter; use ModStart\Grid\Filter\Field\Text; use ModStart\Grid\Grid; use ModStart\Grid\GridFilter; use ModStart\Support\Concern\HasFluentAttribute; abstract class AbstractFilter { use HasFluentAttribute; private $fluentAttributes = array('hookRendering'); private $hookRendering; private $grid; protected $id; protected $label; protected $column; protected $field; protected $defaultValue; protected $query = 'where'; private $tableFilter; private $autoHide = false; public function __construct($NS5_3, $ueQYS = '') { goto A5IxO; jou__: $this->label = $ueQYS; goto TFEZS; WrWGb: $this->column = $NS5_3; goto jou__; TFEZS: $this->field = new Text($this); goto irSXi; irSXi: $this->field->label($this->label); goto EMy1_; A5IxO: $this->id = IdUtil::generate('GridFilter'); goto WrWGb; EMy1_: } public function name() { $cVwn0 = explode('\\', get_called_class()); return lcfirst(end($cVwn0)); } public function setTableFilter(GridFilter $AKg7l) { $this->tableFilter = $AKg7l; } public function condition($SPnSA) { if (isset($SPnSA['eq']) && $SPnSA['eq'] !== '') { return $this->buildCondition($this->column, '=', $SPnSA['eq']); } return null; } public function field($VuXfH = null) { goto i1O8_; i1O8_: if (null === $VuXfH) { return $this->field; } goto J9CgM; J9CgM: $this->field = $VuXfH; goto Qc8n1; Qc8n1: return $this; goto emxYQ; emxYQ: } public function defaultValue($VuXfH) { $this->defaultValue = $VuXfH; return $this; } public function autoHide($x6K73 = null) { goto XINEK; OQng1: $this->autoHide = $x6K73; goto rSZW_; XINEK: if (null === $x6K73) { return $this->autoHide; } goto OQng1; rSZW_: return $this; goto nHPIo; nHPIo: } public function column() { return $this->column; } protected function buildCondition() { goto GQi2k; eL4RJ: if (count($NS5_3) == 1 || $this->grid->isDynamicModel()) { return array($this->query => func_get_args()); } goto pJTUd; GQi2k: $NS5_3 = explode('.', $this->column); goto eL4RJ; pJTUd: return call_user_func_array(array($this, 'buildRelationCondition'), func_get_args()); goto kGfXC; kGfXC: } protected function buildRelationCondition() { goto CUhn8; Ml_eZ: return array('whereHas' => array($HN67o, function ($HN67o) use($jrTHd) { call_user_func_array(array($HN67o, $this->query), $jrTHd); })); goto yfENS; CUhn8: $jrTHd = func_get_args(); goto y0PM6; y0PM6: list($HN67o, $jrTHd[0]) = explode('.', $this->column); goto Ml_eZ; yfENS: } public function variables() { goto CxZpv; OXL0k: return $XkA0X; goto zGaCz; CxZpv: $XkA0X = array('id' => $this->id, 'column' => $this->column, 'label' => $this->label, 'field' => $this->field, 'defaultValue' => $this->defaultValue, 'autoHide' => $this->autoHide); goto nSJ45; nSJ45: $XkA0X = array_merge($XkA0X, $this->field->variables()); goto OXL0k; zGaCz: } public function render() { goto owT9Y; MnW5l: $cVwn0 = explode('\\', get_called_class()); goto fXX2G; owT9Y: if ($this->hookRendering instanceof \Closure) { $nMi2c = call_user_func($this->hookRendering, $this); if (null !== $nMi2c) { return $nMi2c; } } goto MnW5l; fXX2G: $AZOts = explode('\\', get_class($this->field)); goto g9u4v; g9u4v: $de9hK = 'modstart::core.grid.filter.' . lcfirst(end($cVwn0)) . '-' . lcfirst(end($AZOts)); goto Kkqaf; Kkqaf: return View::make($de9hK, $this->variables())->render(); goto kAuqM; kAuqM: } public function grid($h7Rk_ = null) { goto qezlp; MZ5oz: return $this; goto wFf1P; qezlp: if (null === $h7Rk_) { return $this->grid; } goto IfhX2; IfhX2: $this->grid = $h7Rk_; goto MZ5oz; wFf1P: } public function __call($HQ4FM, $wnXyT) { if ($this->isFluentAttribute($HQ4FM)) { return $this->fluentAttribute($HQ4FM, $wnXyT); } throw new \Exception('AbstractFilter __call error : ' . $HQ4FM); } }