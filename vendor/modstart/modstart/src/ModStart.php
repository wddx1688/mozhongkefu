<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart; use Illuminate\Contracts\View\Factory; use Illuminate\Foundation\Application; use Illuminate\Support\Facades\Cache; use Illuminate\View\View; use ModStart\Core\Exception\BizException; use ModStart\Module\ModuleManager; use ModStart\Support\Manager\FieldManager; use ModStart\Support\Manager\WidgetManager; class ModStart { public static $version = '3.8.0'; public static $script = array(); public static $style = array(); public static $css = array(); public static $js = array(); public static function cacheKey($cANPj) { goto T2lPb; gyM8D: return join(':', array($cANPj, $mSCVj)); goto fDUyQ; T2lPb: static $mSCVj = null; goto WbpZi; WbpZi: if (null === $mSCVj) { $mSCVj = md5(__DIR__); } goto gyM8D; fDUyQ: } public static function clearCache() { goto RMp5A; RMp5A: Cache::forget(self::cacheKey('ModStartServiceProviders')); goto PwSPo; ao9jG: self::safeCleanOptimizedFile('bootstrap/cache/config.php'); goto IjGJk; EIvbv: Cache::forget(self::cacheKey('ModStartApiRoutes')); goto wBhzY; IjGJk: if (method_exists(ModuleManager::class, 'hotReloadSystemConfig')) { ModuleManager::hotReloadSystemConfig(); } goto CF4Bl; m2EVJ: Cache::forget(self::cacheKey('ModStartWebRoutes')); goto r934J; wBhzY: Cache::forget(self::cacheKey('ModStartOpenApiRoutes')); goto m2EVJ; j_ahk: self::safeCleanOptimizedFile('bootstrap/cache/services.json'); goto ao9jG; r934J: self::safeCleanOptimizedFile('bootstrap/cache/compiled.php'); goto j_ahk; PwSPo: Cache::forget(self::cacheKey('ModStartAdminRoutes')); goto EIvbv; CF4Bl: } private static function safeCleanOptimizedFile($Z3orD) { if (file_exists($hCl98 = base_path($Z3orD))) { @unlink($hCl98); } } public static function scriptFile($seT0Q, $YUEgD = false) { if (!$YUEgD) { $seT0Q = base_path($seT0Q); } try { return self::script(file_get_contents($seT0Q)); } catch (\Exception $l8i0J) { BizException::throws('FileNotFound -> ' . $seT0Q); } } public static function script($oKMGD = '') { goto W2Xui; L130Z: return view('modstart::part.script', array('script' => array_unique(self::$script))); goto CZLpp; W2Xui: $oKMGD = trim($oKMGD); goto gwS9E; gwS9E: if (!empty($oKMGD)) { self::$script = array_merge(self::$script, (array) $oKMGD); return; } goto L130Z; CZLpp: } public static function styleFile($zZ8m0, $YUEgD = false) { if (!$YUEgD) { $zZ8m0 = base_path($zZ8m0); } try { return self::style(file_get_contents($zZ8m0)); } catch (\Exception $l8i0J) { BizException::throws('FileNotFound -> ' . $zZ8m0); } } public static function style($bMeGg = '') { goto EZuBv; sDkmS: static::$style = array_merge(static::$style, FieldManager::collectFieldAssets('style'), WidgetManager::collectWidgetAssets('style')); goto a8Kta; EZuBv: $bMeGg = trim($bMeGg); goto jxcHt; jxcHt: if (!empty($bMeGg)) { self::$style = array_merge(self::$style, (array) $bMeGg); return; } goto sDkmS; a8Kta: return view('modstart::part.style', array('style' => array_unique(self::$style))); goto qEgNE; qEgNE: } public static function css($rkijL = null) { goto bi93k; dLKqm: static::$css = array_merge(static::$css, FieldManager::collectFieldAssets('css')); goto JR3zy; JR3zy: return view('modstart::part.css', array('css' => array_unique(static::$css))); goto gT4SG; bi93k: if (!is_null($rkijL)) { self::$css = array_merge(self::$css, (array) $rkijL); return; } goto dLKqm; gT4SG: } public static function js($qUJQM = null) { goto FgAiY; EA02q: return view('modstart::part.js', array('js' => array_unique(static::$js))); goto uPeS8; FgAiY: if (!is_null($qUJQM)) { self::$js = array_merge(self::$js, (array) $qUJQM); return; } goto C9bcH; C9bcH: static::$js = array_merge(static::$js, FieldManager::collectFieldAssets('js')); goto EA02q; uPeS8: } public static function env() { goto f73ky; jBUNc: return $r0nrL; goto cknBO; f73ky: static $r0nrL = null; goto jkv1w; jkv1w: if (null === $r0nrL) { $YkA9c = explode('.', \Illuminate\Foundation\Application::VERSION); $r0nrL = 'laravel' . $YkA9c[0]; } goto jBUNc; cknBO: } }