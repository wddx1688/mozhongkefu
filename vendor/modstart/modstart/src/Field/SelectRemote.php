<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Field; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use ModStart\Field\Concern\CanCascadeFields; use ModStart\Field\Type\FieldRenderMode; class SelectRemote extends AbstractField { use CanCascadeFields; protected function setup() { $this->addVariables(array('server' => '')); } public function server($HCA_O) { $this->addVariables(array('server' => $HCA_O)); return $this; } public function viewWithModel($R3agm, $oUKVW = 'id', $J2pjX = 'title') { $this->hookRendering(function (AbstractField $dBa7F, $DUr2V, $kOFY1) use($R3agm, $oUKVW, $J2pjX) { switch ($dBa7F->renderMode()) { case FieldRenderMode::DETAIL: case FieldRenderMode::GRID: goto gIpv8; Ekrs2: if ($jdXuk) { $VuXfH = $jdXuk[$J2pjX]; } goto DsJyW; JwW9s: $jdXuk = ModelUtil::get($R3agm, array($oUKVW => $VuXfH)); goto Ekrs2; DsJyW: return AutoRenderedFieldValue::make($VuXfH); goto O9Yqd; gIpv8: $VuXfH = $DUr2V[$dBa7F->name()]; goto JwW9s; O9Yqd: } }); return $this; } public static function handleModel($R3agm, $oUKVW = 'id', $J2pjX = 'title', $kKcR8 = array()) { goto xOKBW; NIfjc: if ($VuXfH) { $IpOIw = $IpOIw->where($oUKVW, $VuXfH); } goto rxs9t; xOKBW: if (!isset($kKcR8['sort'])) { $kKcR8['sort'] = array('id', 'desc'); } goto dOLo2; xtmae: $VuXfH = $gY_Ck->getInteger('value'); goto RMNqS; elaF1: $iVFbz = array(); goto Dlohi; dOLo2: $gY_Ck = InputPackage::buildFromInput(); goto xtmae; MeS8D: $IpOIw = ModelUtil::model($R3agm); goto NIfjc; DJ6Hm: return Response::generateSuccessData(array('options' => $iVFbz)); goto nw1Wg; rxs9t: if ($qLyBy) { $IpOIw = $IpOIw->where($J2pjX, 'like', '%' . $qLyBy . '%'); } goto yhcAZ; RMNqS: $qLyBy = $gY_Ck->getTrimString('keywords'); goto MeS8D; yhcAZ: $nQYo_ = $IpOIw->orderBy($kKcR8['sort'][0], $kKcR8['sort'][1])->limit(10)->get(array($oUKVW, $J2pjX))->toArray(); goto elaF1; Dlohi: foreach ($nQYo_ as $jdXuk) { $iVFbz[] = array('value' => $jdXuk[$oUKVW], 'label' => $jdXuk[$J2pjX]); } goto DJ6Hm; nw1Wg: } }