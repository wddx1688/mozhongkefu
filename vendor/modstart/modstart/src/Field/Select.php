<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Field; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use ModStart\Core\Util\TreeUtil; use ModStart\Field\Concern\CanCascadeFields; use ModStart\Repository\TreeRepositoryInterface; class Select extends AbstractField { use CanCascadeFields; protected function setup() { $this->addVariables(array('options' => array(), 'onValueChangeJsFunction' => '', 'selectSearch' => false, 'selectRemote' => null)); } public function selectSearch($VuXfH) { $this->addVariables(array('selectSearch' => $VuXfH)); return $this; } public function selectRemote($VuXfH) { $this->addVariables(array('selectRemote' => $VuXfH)); return $this; } public function options($iVFbz) { $this->addVariables(array('options' => $iVFbz)); return $this; } public function optionsValue($iVFbz) { $this->addVariables(array('options' => array_build($iVFbz, function ($dKmL2, $yFWLi) { return array($yFWLi, $yFWLi); }))); return $this; } public function optionArray($iVFbz, $GYMeL = 'id', $trsu0 = 'title') { $iVFbz = array_build($iVFbz, function ($dKmL2, $yFWLi) use($GYMeL, $trsu0) { return array($yFWLi[$GYMeL], $yFWLi[$trsu0]); }); return $this->options($iVFbz); } public function onValueChangeJsFunction($sDNYN) { $this->addVariables(array('onValueChangeJsFunction' => $sDNYN)); return $this; } public function optionType($iCXib) { return $this->options($iCXib::getList()); } public function optionModel($R3agm, $PkGEp = 'id', $HamKI = 'name', $kNTjB = array()) { return $this->options(ModelUtil::valueMap($R3agm, $PkGEp, $HamKI, $kNTjB)); } public function optionModelTree($R3agm, $GYMeL = 'id', $Liw_V = 'pid', $trsu0 = 'title', $qoMM9 = 'sort', $kNTjB = array()) { goto uq1VV; bA83n: return $this->optionItems($c0PBf, $GYMeL, $trsu0); goto OkZc9; kSiGF: $c0PBf = TreeUtil::itemsMergeLevel($c0PBf, $GYMeL, $Liw_V, $qoMM9); goto bA83n; uq1VV: $c0PBf = ModelUtil::autoModel($R3agm)->where($kNTjB)->get(array($GYMeL, $Liw_V, $trsu0, $qoMM9)); goto kSiGF; OkZc9: } public function optionRepositoryTreeItems(TreeRepositoryInterface $Cxh0W, $WmEKP = 0) { $c0PBf = $Cxh0W->getTreeItems($this->context); return $this->optionItems($c0PBf, $Cxh0W->getKeyName(), $Cxh0W->getTreeTitleColumn(), $WmEKP); } public function optionItems($c0PBf, $GYMeL = 'id', $trsu0 = 'title', $WmEKP = 0) { goto Av_hj; A7Z2s: $iVFbz[0] = L('Root'); goto Cajb5; Cajb5: if ($WmEKP > 0) { $c0PBf = $c0PBf->filter(function ($DUr2V) use($WmEKP) { return $DUr2V->_level <= $WmEKP - 1; }); } goto V2BWm; Av_hj: $iVFbz = array(); goto A7Z2s; a1amw: foreach ($c0PBf as $qsK6T => $DUr2V) { goto two6S; qY203: $iVFbz[$DUr2V->{$GYMeL}] = array('label' => $OFAbu . $DUr2V->{$trsu0}, 'title' => join('-', $SC6gt)); goto MShDw; iVNRl: if ($DUr2V->_level > $lL7cM) { array_push($SC6gt, $DUr2V->{$trsu0}); } else { goto HFp0w; mUBJn: array_push($SC6gt, $DUr2V->{$trsu0}); goto D8LgH; iulhI: array_pop($SC6gt); goto mUBJn; HFp0w: while ($DUr2V->_level < $lL7cM) { array_pop($SC6gt); $lL7cM--; } goto iulhI; D8LgH: } goto P0mrJ; P0mrJ: $lL7cM = $DUr2V->_level; goto qY203; two6S: $OFAbu = TreeUtil::itemLevelPrefix($DUr2V->_level); goto iVNRl; MShDw: } goto JPTaF; V2BWm: $lL7cM = 0; goto n7wNy; n7wNy: $SC6gt = array(); goto a1amw; JPTaF: return $this->options($iVFbz); goto BSM8B; BSM8B: } public static function optionRemoteHandleModel($R3agm, $oUKVW = 'id', $J2pjX = 'title', $kKcR8 = array()) { goto KN0op; KN0op: if (!isset($kKcR8['sort'])) { $kKcR8['sort'] = array('id', 'desc'); } goto LJiFF; htgxo: foreach ($nQYo_ as $jdXuk) { $iVFbz[] = array('value' => $jdXuk[$oUKVW], 'label' => $jdXuk[$J2pjX]); } goto iPRn2; wuZZj: $IpOIw = ModelUtil::model($R3agm); goto gqRYi; TVBJK: if ($qLyBy) { $IpOIw = $IpOIw->where($J2pjX, 'like', '%' . $qLyBy . '%'); } goto MmCRb; gqRYi: if ($VuXfH) { $IpOIw = $IpOIw->where($oUKVW, $VuXfH); } goto TVBJK; iPRn2: return Response::generateSuccessData(array('options' => $iVFbz)); goto xxJM8; MmCRb: $nQYo_ = $IpOIw->orderBy($kKcR8['sort'][0], $kKcR8['sort'][1])->limit(10)->get(array($oUKVW, $J2pjX))->toArray(); goto yo9cv; LJiFF: $gY_Ck = InputPackage::buildFromInput(); goto KFKtn; KFKtn: $VuXfH = $gY_Ck->getInteger('value'); goto neOIR; neOIR: $qLyBy = $gY_Ck->getTrimString('keywords'); goto wuZZj; yo9cv: $iVFbz = array(); goto htgxo; xxJM8: } public function render() { $this->addCascadeScript(); return parent::render(); } }