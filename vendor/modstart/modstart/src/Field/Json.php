<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Field; use ModStart\Core\Exception\BizException; use ModStart\Core\Util\CurlUtil; use ModStart\Core\Util\SerializeUtil; class Json extends AbstractField { const MODE_API = 'api'; const MODE_DEFAULT = 'default'; protected function setup() { $this->addVariables(array('editorHeight' => '200px', 'jsonMode' => 'default')); } public function jsonMode($VuXfH) { $this->addVariables(array('jsonMode' => $VuXfH)); return $this; } public function editorHeight($VuXfH) { $this->addVariables(array('editorHeight' => $VuXfH)); return $this; } public function unserializeValue($VuXfH, AbstractField $dBa7F) { if (null === $VuXfH) { return $VuXfH; } return @json_decode($VuXfH, true); } public function serializeValue($VuXfH, $Wa8N4) { return SerializeUtil::jsonEncode($VuXfH); } public function prepareInput($VuXfH, $Wa8N4) { goto djpue; IAXC2: return $pKNCN; goto OyZ4H; djpue: $pKNCN = @json_decode($VuXfH, true); goto CsPWz; CsPWz: BizException::throwsIf($this->label . ' ' . L('Json Format Error'), $VuXfH && null === $pKNCN); goto IAXC2; OyZ4H: } public static function executeApi($VuXfH) { goto NFBpP; n79dL: $mH3Yd['method'] = $VuXfH['method']; goto Dp1n7; Dp1n7: $mH3Yd['header'] = array(); goto oeqJv; HftZh: $nMi2c = CurlUtil::request($VuXfH['url'], $kKcR8, $mH3Yd); goto huKwX; Kc2Z5: if (!empty($VuXfH['query'])) { goto EQMNw; vvnb_: foreach ($VuXfH['query'] as $yFWLi) { $IpOIw[$yFWLi['key']] = $yFWLi['value']; } goto IUmI9; IUmI9: $kKcR8 = $IpOIw; goto YX5yk; EQMNw: $IpOIw = array(); goto vvnb_; YX5yk: } goto dwNkw; huKwX: return $nMi2c; goto wbdCs; UsejM: $kKcR8 = array(); goto g8oFc; dwNkw: switch ($mH3Yd['method']) { case 'POST': switch ($VuXfH['enctype']) { case 'FormData': goto PnufU; R2EHM: if (!empty($VuXfH['bodyParam'])) { foreach ($VuXfH['bodyParam'] as $yFWLi) { $kKcR8[$yFWLi['key']] = $yFWLi['value']; } } goto nAxwP; wqHY5: break; goto CVE78; nAxwP: $mH3Yd['header']['Content-Type'] = 'multipart/form-data'; goto wqHY5; PnufU: $kKcR8 = array(); goto R2EHM; CVE78: case 'UrlEncoded': goto zPpp9; e2twS: if (!empty($VuXfH['bodyParam'])) { foreach ($VuXfH['bodyParam'] as $yFWLi) { $kKcR8[$yFWLi['key']] = $yFWLi['value']; } } goto K18A6; zPpp9: $kKcR8 = array(); goto e2twS; K18A6: $mH3Yd['header']['Content-Type'] = 'application/x-www-form-urlencoded'; goto argO_; argO_: break; goto a1gl4; a1gl4: case 'Json': goto HlbdS; OA9qV: $mH3Yd['header']['Content-Type'] = 'application/json'; goto L2SnJ; L2SnJ: break; goto JF5wv; HlbdS: $kKcR8 = $VuXfH['bodyRaw']; goto OA9qV; JF5wv: } break; } goto HftZh; wRWLD: BizException::throwsIf('method错误', empty($VuXfH['method']) || !in_array($VuXfH['method'], array('GET', 'POST', 'PUT', 'DELETE'))); goto BvEoe; NFBpP: BizException::throwsIf('url为空', empty($VuXfH['url'])); goto wRWLD; BvEoe: BizException::throwsIf('enctype错误', empty($VuXfH['enctype']) || !in_array($VuXfH['enctype'], array('FormData', 'UrlEncoded', 'Json'))); goto UsejM; oeqJv: if (!empty($VuXfH['headers'])) { foreach ($VuXfH['headers'] as $yFWLi) { $mH3Yd['header'][$yFWLi['key']] = $yFWLi['value']; } } goto Kc2Z5; QKc7e: $mH3Yd['returnHeader'] = true; goto n79dL; g8oFc: $mH3Yd = array(); goto QKc7e; wbdCs: } }