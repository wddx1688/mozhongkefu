<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\App\Api\Middleware; use Illuminate\Http\Request; use Illuminate\Http\Response; use Illuminate\Support\Facades\Input; use Illuminate\Support\Facades\Log; use Illuminate\Support\Facades\Session; class SessionMiddleware { public function handle(Request $mHrWb, \Closure $g0nKp) { goto yKjx9; yKjx9: $CTCZ9 = false; goto bxps4; misJR: $mHrWb->headers->set('api-version', $SbMTt); goto LL74c; O6O7x: if (empty($QTs_B) || !Session::isValidId($QTs_B)) { $QTs_B = Session::getId(); $CTCZ9 = true; } else { Session::setId($QTs_B); $D_pV_ = true; } goto sxUdv; g5IEp: $QTs_B = $this->get($mHrWb, 'api-token'); goto O6O7x; s74Du: return $xtWCf; goto zBg0V; lwQjQ: $mHrWb->headers->set('api-device', $Vw2DC); goto JQJAT; naEoh: if ($CTCZ9) { goto BhyfJ; BhyfJ: $wGM6Z = 'Illuminate\\Http\\Response'; goto AmT3r; AmT3r: $hhaEk = 'Symfony\\Component\\HttpFoundation\\Response'; goto ENLOq; ENLOq: if ($xtWCf instanceof $wGM6Z) { $xtWCf->header('api-token', $QTs_B); } else { if ($xtWCf instanceof $hhaEk) { $xtWCf->headers->set('api-token', $QTs_B); } } goto R9xhr; R9xhr: } goto s74Du; IFvCj: $Vw2DC = $this->get($mHrWb, 'api-device'); goto lwQjQ; tcTsG: $mHrWb->headers->set('api-param', $XUUyc); goto LVS9X; JQJAT: $XUUyc = $this->get($mHrWb, 'api-param'); goto tcTsG; IEuVW: $mHrWb->headers->set('api-token', $QTs_B); goto IFvCj; sxUdv: $WMf4I = Session::getId(); goto cBREV; cBREV: if ($WMf4I && $WMf4I != $QTs_B) { Session::setId($QTs_B); $D_pV_ = true; } goto OcfVQ; LVS9X: $SbMTt = $this->get($mHrWb, 'api-version'); goto misJR; OcfVQ: if ($D_pV_) { Session::start(); } goto IEuVW; bxps4: $D_pV_ = false; goto g5IEp; LL74c: $xtWCf = $g0nKp($mHrWb); goto naEoh; zBg0V: } private function get(Request &$mHrWb, $cANPj) { goto uwmeM; cqJO4: if (!empty($VuXfH)) { return $VuXfH; } goto NOLSv; w1TYl: $VuXfH = Input::get($pQjR2, null); goto WuQ1M; MAE2A: if (!empty($VuXfH)) { return $VuXfH; } goto gMuVM; GTE_k: $VuXfH = $mHrWb->header($cANPj); goto cqJO4; NOLSv: $VuXfH = $mHrWb->cookie($pQjR2); goto MAE2A; gMuVM: return null; goto M_OKp; WuQ1M: if (!empty($VuXfH)) { return $VuXfH; } goto GTE_k; uwmeM: $pQjR2 = str_replace('-', '_', $cANPj); goto w1TYl; M_OKp: } private function getCookieSessionId(Request &$mHrWb) { return $mHrWb->cookie(config('session.cookie')); } }