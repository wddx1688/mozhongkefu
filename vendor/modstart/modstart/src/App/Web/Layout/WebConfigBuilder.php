<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\App\Web\Layout; use Illuminate\Contracts\Support\Renderable; use ModStart\Core\Dao\DynamicModel; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use ModStart\Form\Form; use ModStart\Layout\Page; use ModStart\Repository\RepositoryUtil; use ModStart\Widget\Box; class WebConfigBuilder implements Renderable { private $page; private $form; private $pagePrepend = array(); public function __construct() { $this->form = new Form(DynamicModel::class); $this->useFrame(); } public function form() { return $this->form; } public function page() { return $this->page; } public function useFrame() { $this->page = new WebPage(); $this->form->showReset(false)->showSubmit(true); } public function useDialog() { $this->page = new WebDialogPage(); $this->form->showReset(false)->showSubmit(false); } public function pagePrepend($kuRG8) { array_unshift($this->pagePrepend, $kuRG8); } public function render() { goto AheCx; AheCx: if (!empty($this->pagePrepend)) { foreach ($this->pagePrepend as $DUr2V) { $this->page->row($DUr2V); } } goto z5daR; iNyW2: return $this->page->render(); goto b_xmb; z5daR: if ($this->page instanceof WebDialogPage) { $this->page->body($this->form); } else { $this->page->body(new Box($this->form, $this->pageTitle())); } goto iNyW2; b_xmb: } public function perform($DUr2V = null, $k_TMY = null) { goto rS0bE; VWD6_: if (null === $DUr2V) { $DUr2V = array(); foreach ($this->form->fields() as $dBa7F) { $DUr2V[$dBa7F->column()] = null; } } goto uDPrr; uDPrr: $this->form->item(RepositoryUtil::itemFromArray($DUr2V)); goto rU9Sg; rU9Sg: $this->form->fillFields(); goto lBu21; rS0bE: if (Request::isPost()) { return $this->form->formRequest(function (Form $c9K5c) use($k_TMY) { $nMi2c = call_user_func($k_TMY, $c9K5c); if (null !== $nMi2c) { return $nMi2c; } return Response::jsonSuccess(L('Save Success')); }); } goto VWD6_; lBu21: return $this; goto WUjAO; WUjAO: } public function __call($HQ4FM, $wnXyT) { if (method_exists($this->page, $HQ4FM)) { return $this->page->{$HQ4FM}(...$wnXyT); } return $this->form->{$HQ4FM}(...$wnXyT); } }