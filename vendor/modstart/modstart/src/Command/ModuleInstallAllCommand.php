<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Command; use Illuminate\Console\Command; use ModStart\Admin\Auth\Admin; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Input\Response; use ModStart\ModStart; use ModStart\Module\ModuleManager; class ModuleInstallAllCommand extends Command { protected $signature = 'modstart:module-install-all {--link-asset}'; public function handle() { goto UTp2f; KrXHd: if ($n9Kdc) { goto YTZMx; Fw6o3: $n9Kdc = array_map(function ($yFWLi) { list($rCnA9, $mDyAE) = explode(':', $yFWLi); $rCnA9 = trim($rCnA9); $mDyAE = trim($mDyAE); if (empty($rCnA9) || empty($mDyAE)) { return null; } return array('user' => $rCnA9, 'password' => $mDyAE); }, $n9Kdc); goto AXatp; YTZMx: $n9Kdc = explode(';', $n9Kdc); goto Fw6o3; AXatp: $n9Kdc = array_filter($n9Kdc); goto Rx0pj; Rx0pj: if (!empty($n9Kdc)) { if (ModelUtil::count('admin_user') <= 0) { foreach ($n9Kdc as $WN5XF) { Admin::add($WN5XF['user'], $WN5XF['password']); $this->warn(">>> Init User: {$WN5XF['user']}"); } } } goto Ey2Ro; Ey2Ro: } goto IRjyD; ZgiVc: $n9Kdc = config('env.MS_INIT_ADMIN_USERS', ''); goto KrXHd; fBADe: $this->warn('ModuleInstallAll Run Finished'); goto O0SYl; YTTeu: $this->info('ModuleInstallAll
'); goto s0ai_; s0ai_: foreach (ModuleManager::listAllInstalledModulesInRequiredOrder() as $C1S_N) { goto CymW0; pjUQy: if (Response::isSuccess($nMi2c)) { $this->info($nMi2c['data']['output']); } else { $this->error($nMi2c['msg']); } goto Sz7YY; oowcc: $nMi2c = ModuleManager::install($C1S_N, false, array('linkAsset' => $u1YEC)); goto pjUQy; CymW0: if (!ModuleManager::isExists($C1S_N)) { continue; } goto QQV2Z; Sz7YY: $this->info(''); goto F8OrX; QQV2Z: $this->warn(">>> Module {$C1S_N} Installing"); goto oowcc; F8OrX: } goto ZgiVc; IRjyD: $this->publishHotfixFiles(); goto fBADe; UTp2f: $u1YEC = $this->option('link-asset'); goto YTTeu; O0SYl: } private function publishHotfixFiles() { goto GX0Up; AL5KD: $r0nrL = ModStart::env(); goto RqqQD; mFU_j: foreach ($pKNCN as $vhE98 => $hCl98) { goto EQkoK; eeD4H: $this->info('Hotfix: ' . $hCl98); goto Rtpbc; h3AV1: @file_put_contents(base_path($hCl98), $N19iJ); goto eeD4H; EQkoK: $N19iJ = file_get_contents($l4725 . $r0nrL . '/' . $vhE98); goto h3AV1; Rtpbc: } goto YCNvU; bepS9: if (!file_exists($O1xMi)) { return; } goto MonJ9; RqqQD: $l4725 = rtrim(base_path('vendor/modstart/modstart/resources/hot_fix'), '/') . '/'; goto qBLbO; GX0Up: $this->warn('>>> Publish Hotfix'); goto AL5KD; qBLbO: $O1xMi = $l4725 . $r0nrL . '.json'; goto bepS9; MonJ9: $pKNCN = @json_decode(file_get_contents($O1xMi), true); goto mFU_j; YCNvU: $this->info(''); goto Agoa8; Agoa8: } }