<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Hook; use ModStart\Core\Exception\BizException; class ModStartHook { private static $listeners = array(); public static function subscribe($HQ4FM, $EioS4) { if (!is_array($HQ4FM)) { $HQ4FM = array($HQ4FM); } foreach ($HQ4FM as $DUr2V) { if (!isset(self::$listeners[$DUr2V])) { self::$listeners[$DUr2V] = array(); } self::$listeners[$DUr2V][] = $EioS4; } } public static function get($HQ4FM = '') { if (empty($HQ4FM)) { return self::$listeners; } return array_key_exists($HQ4FM, self::$listeners) ? self::$listeners[$HQ4FM] : array(); } public static function fire($HQ4FM, &$kKcR8 = null, $LGQQv = null) { goto xISVG; r3DFN: foreach (static::get($HQ4FM) as $cANPj => $EioS4) { $AxBu3[$cANPj] = self::call($EioS4, $HQ4FM, $kKcR8, $LGQQv); } goto hfz2E; xISVG: $AxBu3 = array(); goto r3DFN; hfz2E: return $AxBu3; goto os9hg; os9hg: } public static function fireInView($HQ4FM, &$kKcR8 = null, $LGQQv = null) { return join('', self::fire($HQ4FM, $kKcR8, $LGQQv)); } private static function call($EioS4, $HQ4FM = '', &$kKcR8 = null, $LGQQv = null) { if ($EioS4 instanceof \Closure) { $jq2n1 = call_user_func_array($EioS4, array(&$kKcR8, $LGQQv)); } elseif (is_array($EioS4)) { list($EioS4, $lrQvV) = $EioS4; $jq2n1 = call_user_func_array(array(&$EioS4, $lrQvV), array(&$kKcR8, $LGQQv)); } else { if (is_object($EioS4)) { $lrQvV = "on{$HQ4FM}"; $jq2n1 = call_user_func_array(array(&$EioS4, $lrQvV), array(&$kKcR8, $LGQQv)); } elseif (strpos($EioS4, '::')) { $jq2n1 = call_user_func_array($EioS4, array(&$kKcR8, $LGQQv)); } else { BizException::throws('ModStartHook call error'); } } return $jq2n1; } }