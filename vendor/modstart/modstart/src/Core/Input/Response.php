<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Input; use Illuminate\Http\JsonResponse; use Illuminate\Support\Facades\Input; use Illuminate\Support\Facades\View; use ModStart\Core\Exception\BizException; use ModStart\Core\Util\FileUtil; use ModStart\Core\Util\SerializeUtil; class Response { public static function tryGetData($nMi2c, $cANPj = null) { goto MSyHE; X_fHP: if (!isset($nMi2c['code'])) { BizException::throws('ERROR_RESPONSE'); } goto VOYq4; MSyHE: if ($nMi2c instanceof JsonResponse) { $nMi2c = $nMi2c->getData(true); } goto X_fHP; s3Ikx: if (null !== $cANPj) { if (!array_key_exists($cANPj, $nMi2c['data'])) { BizException::throws('data not exists ' . $cANPj); } return $nMi2c['data'][$cANPj]; } goto nvXAE; VOYq4: if ($nMi2c['code']) { BizException::throws($nMi2c['msg']); } goto s3Ikx; nvXAE: return isset($nMi2c['data']) ? $nMi2c['data'] : null; goto B8v4A; B8v4A: } public static function isSuccess($jq2n1) { if ($jq2n1 instanceof JsonResponse) { $jq2n1 = $jq2n1->getData(true); } return isset($jq2n1['code']) && 0 === $jq2n1['code']; } public static function isError($jq2n1) { return !self::isSuccess($jq2n1); } public static function generateRedirect($vqlrZ) { return self::generate(-1, null, null, $vqlrZ); } public static function generate($SIPLh, $BDbmq, $nx179 = null, $vqlrZ = null) { goto o3ul3; vxBxi: return $xtWCf; goto KRC1n; wYgkV: if (null === $nx179) { unset($xtWCf['data']); } goto Xirvm; wkxK1: $xtWCf = array('code' => $SIPLh, 'msg' => $BDbmq, 'data' => $nx179, 'redirect' => $vqlrZ); goto wYgkV; Xirvm: if (null === $vqlrZ) { unset($xtWCf['redirect']); } goto vxBxi; o3ul3: if (null === $vqlrZ) { if ($o7OPw = trim(Input::get('_redirect'))) { $vqlrZ = $o7OPw; } } goto wkxK1; KRC1n: } public static function generateSuccessPaginate($mZ5xK, $qp8x7, $LHFyR) { return self::generateSuccessPaginateData($mZ5xK, $qp8x7, $LHFyR['records'], $LHFyR['total']); } public static function generateSuccessPaginateData($mZ5xK, $qp8x7, $nQYo_, $Pm92r, $N2rtk = -1) { return self::generateSuccessData(array('page' => $mZ5xK, 'pageSize' => $qp8x7, 'records' => $nQYo_, 'total' => $Pm92r, 'maxRecords' => $N2rtk)); } public static function generateSuccessData($nx179) { return self::generate(0, 'ok', $nx179); } public static function generateSuccess($BDbmq = 'ok') { return self::generate(0, $BDbmq); } public static function generateError($BDbmq = 'error', $nx179 = null, $vqlrZ = null) { return self::generate(-1, $BDbmq, $nx179, $vqlrZ); } public static function jsonSuccessData($nx179) { return self::json(0, 'ok', $nx179); } public static function jsonSuccess($BDbmq = 'ok') { return self::json(0, $BDbmq); } public static function jsonError($BDbmq = 'error') { return self::json(-1, $BDbmq); } public static function jsonException(\Exception $l8i0J) { return self::jsonError($l8i0J->getMessage()); } public static function json($SIPLh, $BDbmq, $nx179 = null, $vqlrZ = null) { goto F5NLn; LZmei: return \Illuminate\Support\Facades\Response::json($xtWCf); goto o3r8N; EC11N: if (null === $vqlrZ) { unset($xtWCf['redirect']); } goto LZmei; F5NLn: $xtWCf = array('code' => $SIPLh, 'msg' => $BDbmq, 'data' => $nx179, 'redirect' => $vqlrZ); goto EC11N; o3r8N: } public static function jsonFromGenerate($nMi2c) { goto ES_qd; ES_qd: if ($nMi2c instanceof JsonResponse) { return $nMi2c; } goto QaoyO; QaoyO: if ($nMi2c['code']) { return self::json($nMi2c['code'], $nMi2c['msg'], isset($nMi2c['data']) ? $nMi2c['data'] : null, isset($nMi2c['redirect']) ? $nMi2c['redirect'] : null); } goto MOoui; lqnDC: return self::json($nMi2c['code'], $nMi2c['msg'], isset($nMi2c['data']) ? $nMi2c['data'] : null, isset($nMi2c['redirect']) ? $nMi2c['redirect'] : null); goto X1zJG; MOoui: if (!isset($nMi2c['msg'])) { $nMi2c['msg'] = null; } goto lqnDC; X1zJG: } public static function jsonIfGenerateSuccess($nMi2c, $BDbmq = 'ok', $nx179 = null, $vqlrZ = null) { if ($nMi2c['code']) { return self::json($nMi2c['code'], $nMi2c['msg'], empty($nMi2c['data']) ? null : $nMi2c['data'], empty($nMi2c['redirect']) ? null : $nMi2c['redirect']); } return self::json(0, $BDbmq, $nx179, $vqlrZ); } public static function jsonRaw($nx179) { return \Illuminate\Support\Facades\Response::json($nx179); } public static function jsonp($nx179, $k_TMY = null) { goto l52BK; KtGQQ: return \Illuminate\Support\Facades\Response::jsonp($k_TMY, $nx179); goto hXITP; K4jdT: if (empty($k_TMY)) { return \Illuminate\Support\Facades\Response::json($nx179); } goto lcuXn; l52BK: if (empty($k_TMY)) { $k_TMY = \Illuminate\Support\Facades\Input::get('callback', null); } goto K4jdT; lcuXn: if (!preg_match('/^[a-zA-Z_0-9]+$/', $k_TMY)) { return \Illuminate\Support\Facades\Response::json(array('code' => -1, 'msg' => 'callback error')); } goto KtGQQ; hXITP: } public static function sendIfGenerateSuccess($nMi2c, $BDbmq = 'ok', $nx179 = null, $vqlrZ = null) { if ($nMi2c['code']) { return self::send($nMi2c['code'], $nMi2c['msg'], empty($nMi2c['data']) ? null : $nMi2c['data'], empty($nMi2c['redirect']) ? null : $nMi2c['redirect']); } return self::send(0, $BDbmq, $nx179, $vqlrZ); } public static function sendFromGenerate($nMi2c) { return self::send($nMi2c['code'], empty($nMi2c['msg']) ? null : $nMi2c['msg'], empty($nMi2c['data']) ? null : $nMi2c['data'], empty($nMi2c['redirect']) ? null : $nMi2c['redirect']); } public static function sendError($BDbmq, $nx179 = null, $vqlrZ = null) { return self::send(-1, $BDbmq, $nx179, $vqlrZ); } public static function sendException(\Exception $l8i0J) { return self::sendError($l8i0J->getMessage()); } public static function abortMsg($BDbmq) { abort(200, $BDbmq); } public static function page404() { if (Request::isAjax()) { return self::json(-1, L('Api Not Found : %s', Request::basePath())); } else { abort(404, L('Page Not Found')); } } public static function pagePermissionDenied($BDbmq = null) { if (Request::isAjax()) { return self::json(-1, $BDbmq ? $BDbmq : L('No Permission')); } else { abort(403, $BDbmq ? $BDbmq : L('No Permission')); } } public static function quit($SIPLh, $BDbmq, $nx179 = null, $vqlrZ = null) { goto n62az; Avakw: if (\Illuminate\Support\Facades\Request::ajax()) { header('Content-Type: application/json; charset=UTF-8'); echo SerializeUtil::jsonEncode($xtWCf); } else { header('Content-Type: text/html; charset=UTF-8'); echo View::make('modstart::core.msg.msg', $xtWCf)->render(); } goto sjl6l; n62az: $xtWCf = array('code' => $SIPLh, 'msg' => $BDbmq, 'redirect' => $vqlrZ, 'data' => $nx179); goto brp4a; sjl6l: die; goto e92ym; brp4a: if (null === $vqlrZ) { unset($xtWCf['redirect']); } goto Avakw; e92ym: } public static function redirect($vqlrZ) { return self::send(0, null, null, $vqlrZ); } public static function redirectPermanently($vqlrZ) { return app('redirect')->away($vqlrZ, 301); } public static function send($SIPLh, $BDbmq, $nx179 = null, $vqlrZ = null) { if (\Illuminate\Support\Facades\Request::ajax() || Request::headerGet('is-ajax', false) || ($RLSbu = Request::headerGet('accept')) && $RLSbu == 'application/json') { return self::json($SIPLh, $BDbmq, $nx179, $vqlrZ); } else { goto U2xPJ; Ka0d7: return view('modstart::core.msg.msg', $xtWCf); goto qDc4M; U2xPJ: if (empty($BDbmq) && $vqlrZ) { return app('redirect')->away($vqlrZ); } goto TayOR; TayOR: $xtWCf = array('code' => $SIPLh, 'msg' => $BDbmq, 'redirect' => $vqlrZ, 'data' => $nx179); goto ugqti; ugqti: if (null === $vqlrZ) { unset($xtWCf['redirect']); } goto Ka0d7; qDc4M: } } public static function download($owyBa, $N19iJ, $q3IdH = array(), $ROb22 = null) { goto GrMj2; GrMj2: if (empty($ROb22)) { $ROb22 = 'file.' . FileUtil::extension($owyBa); } goto SL_sI; qfQEk: return $xtWCf; goto xsTVp; CilSe: foreach ($q3IdH as $dKmL2 => $yFWLi) { $xtWCf->headers->set($dKmL2, $yFWLi); } goto qfQEk; hmVTM: if (!isset($q3IdH['Content-Type'])) { $xtWCf->headers->set('Content-Type', 'application/octet-stream'); } goto CilSe; rJ1nU: $xtWCf->headers->set('Content-Disposition', $bnbvB); goto hmVTM; SL_sI: $xtWCf = new \Illuminate\Http\Response($N19iJ); goto PUwhv; PUwhv: $bnbvB = $xtWCf->headers->makeDisposition(\Symfony\Component\HttpFoundation\ResponseHeaderBag::DISPOSITION_ATTACHMENT, $owyBa, $ROb22); goto rJ1nU; xsTVp: } public static function raw($N19iJ, $q3IdH = array()) { goto XEGSu; XEGSu: $xtWCf = new \Illuminate\Http\Response($N19iJ); goto OF5Zj; OF5Zj: foreach ($q3IdH as $dKmL2 => $yFWLi) { $xtWCf->headers->set($dKmL2, $yFWLi); } goto YCw6j; YCw6j: return $xtWCf; goto ZNGKK; ZNGKK: } }