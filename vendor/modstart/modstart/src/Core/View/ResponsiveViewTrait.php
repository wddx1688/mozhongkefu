<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\View; use Illuminate\Support\Facades\Input; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use Illuminate\Support\Str; use ModStart\Core\Exception\BizException; use ModStart\Core\Util\AgentUtil; use Module\Vendor\Provider\SiteTemplate\SiteTemplateProvider; trait ResponsiveViewTrait { protected $_viewBase = null; public function getModule() { goto C77Ox; DX9wq: return $C1S_N; goto be0Sq; hLIvw: if (null === $C1S_N) { $iCXib = get_class($this); if (preg_match('/^Module\\\\([\\w]+).*?/', $iCXib, $jRzIK)) { $C1S_N = $jRzIK[1]; } else { if (method_exists($this, 'getCurrentModule')) { $C1S_N = $this->getCurrentModule(); } else { $C1S_N = ''; } } } goto DX9wq; C77Ox: static $C1S_N = null; goto hLIvw; be0Sq: } private function fetchViewPath($ZSsZq, $FiRm_, $C1S_N, $ITT9D, $de9hK) { goto x4fps; f1NbT: if (view()->exists($fOwYG)) { return $fOwYG; } goto Vv6qc; x4fps: if (Str::contains($de9hK, '::')) { return $de9hK; } goto mOt8A; hC6WH: $zuToZ = "theme.default.{$ITT9D}.{$de9hK}"; goto Fmfjh; MSM40: $fOwYG = "{$FiRm_}.{$ITT9D}.{$de9hK}"; goto MVt_2; MVt_2: if ($C1S_N) { $UTrXJ = "module::{$C1S_N}.View.{$ITT9D}.{$de9hK}"; } goto hC6WH; Vv6qc: if ($C1S_N) { if (view()->exists($UTrXJ)) { return $UTrXJ; } } goto yh4e_; cL7Fn: return null; goto Pa9ka; Fmfjh: if (view()->exists($h6Sm1)) { return $h6Sm1; } goto f1NbT; yh4e_: if (view()->exists($zuToZ)) { return $zuToZ; } goto cL7Fn; mOt8A: $h6Sm1 = "theme.{$ZSsZq}.{$ITT9D}.{$de9hK}"; goto MSM40; Pa9ka: } protected function viewTemplateProvider() { goto x3NE1; WqK5W: $tM49X = Input::get('msSiteTemplate', null); goto wCYz_; wCYz_: if (!empty($tM49X)) { $xqqfG = SiteTemplateProvider::get($tM49X); if (!empty($xqqfG)) { Session::flash('msSiteTemplate', $tM49X); } } goto VGoV3; i00ST: return $xqqfG; goto v9Een; x3NE1: $xqqfG = null; goto WqK5W; ssvWH: if (empty($xqqfG)) { goto WQZnp; WQZnp: $tM49X = modstart_config()->getWithEnv('siteTemplate', 'default'); goto drPGa; ESSAI: if (empty($xqqfG)) { $tM49X = null; } goto LQMBx; drPGa: $xqqfG = SiteTemplateProvider::get($tM49X); goto ESSAI; LQMBx: } goto i00ST; VGoV3: if (empty($xqqfG)) { $tM49X = Session::get('msSiteTemplate', null); if (!empty($tM49X)) { $xqqfG = SiteTemplateProvider::get($tM49X); if (empty($xqqfG)) { Session::forget('msSiteTemplate'); } } } goto ssvWH; v9Een: } protected function viewPaths($de9hK) { goto DRecH; xYEW2: return array($G6dJR, $GpQVt); goto ol9v0; CPg0V: $GpQVt = null; goto YyVYi; YyVYi: $C1S_N = $this->getModule(); goto lH8rc; xRrgx: $G6dJR = null; goto CPg0V; lH8rc: if ($this->isMobile()) { $G6dJR = $this->fetchViewPath($ZSsZq, $FiRm_, $C1S_N, 'm', $de9hK); $GpQVt = $this->fetchViewPath($ZSsZq, $FiRm_, $C1S_N, 'm', 'frame'); } goto MzN26; Fx799: if (null === $ZSsZq) { goto E6ORd; z9qR5: Session::put('msSiteTemplateUsing', $ZSsZq); goto NE_qz; Ivkvw: $ZSsZq = $xqqfG ? $xqqfG->name() : 'default'; goto mYVG0; E6ORd: $xqqfG = $this->viewTemplateProvider(); goto Ivkvw; mYVG0: $FiRm_ = $xqqfG ? $xqqfG->root() : 'theme.' . $ZSsZq; goto z9qR5; NE_qz: } goto xRrgx; C2PAh: View::share('_viewFrame', $GpQVt); goto ojykI; DRecH: static $ZSsZq = null; goto FHUxf; FHUxf: static $FiRm_ = null; goto Fx799; ojykI: BizException::throwsIfEmpty('View Not Exists : ' . $de9hK, $G6dJR); goto xYEW2; MzN26: if (empty($G6dJR)) { $G6dJR = $this->fetchViewPath($ZSsZq, $FiRm_, $C1S_N, 'pc', $de9hK); } goto jKhrm; jKhrm: if (empty($GpQVt)) { $GpQVt = $this->fetchViewPath($ZSsZq, $FiRm_, $C1S_N, 'pc', 'frame'); } goto C2PAh; ol9v0: } protected function shareDialogPageViewFrame() { list($qEF3N, $Wos7B) = $this->viewPaths('dialogPage'); View::share('_viewFrameDialog', $qEF3N); } protected function view($de9hK, $l1eNl = array()) { list($de9hK, $eqlvl) = $this->viewPaths($de9hK); return view($de9hK, $l1eNl); } protected function viewRender($de9hK, $l1eNl = array()) { list($de9hK, $eqlvl) = $this->viewPaths($de9hK); return view($de9hK, $l1eNl)->render(); } protected function viewRealpath($de9hK) { return View::getFinder()->find($de9hK); } protected function isMobile() { return AgentUtil::isMobile(); } protected function isPC() { return AgentUtil::isPC(); } }