<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Util; use Chumper\Zipper\Zipper; use Illuminate\Support\Str; class ZipUtil { private static function fileTreeBuild($a3n3M) { goto WsPYq; qOCci: return $owLu9; goto aa_Oj; WsPYq: $owLu9 = array(); goto x3Niq; x3Niq: foreach ($a3n3M as $Z3orD) { goto uuU09; o9feu: foreach ($QdEEm as $hsM5x => $zm9f1) { goto AJDqu; AJDqu: $oZkmx = false; goto Ylb3K; JnIE3: if (!$oZkmx) { goto Fvn3S; E1Suu: if (!$tDzBW) { $T3B9A =& $T3B9A[count($T3B9A) - 1]['_child']; } goto Bgqo3; DotY4: if ($tDzBW) { $edZxL['type'] = strtolower(pathinfo($zm9f1, PATHINFO_EXTENSION)); $edZxL['size'] = $Z3orD['size']; } else { $edZxL['_child'] = array(); } goto zrO25; s6ySy: $edZxL = array('name' => $zm9f1); goto DotY4; Fvn3S: $tDzBW = $hsM5x === $d1F2S - 1; goto s6ySy; zrO25: $T3B9A[] = $edZxL; goto E1Suu; Bgqo3: } goto JqPgC; Ylb3K: foreach ($T3B9A as &$ywRGS) { if ($ywRGS['name'] === $zm9f1) { goto Pb3TO; itZG_: $oZkmx = true; goto wvDa6; Pb3TO: $T3B9A =& $ywRGS['_child']; goto itZG_; wvDa6: break; goto fibQ8; fibQ8: } } goto JnIE3; JqPgC: } goto bm3JL; uuU09: $QdEEm = explode('/', $Z3orD['path']); goto DYUl4; P8X5D: $d1F2S = count($QdEEm); goto o9feu; DYUl4: $T3B9A =& $owLu9; goto P8X5D; bm3JL: } goto qOCci; aa_Oj: } private static function fileTreeFilter($owLu9, $AKg7l, $DYG2U = 0) { goto r6pYk; r6pYk: $zrT3F = array(); goto B1DwC; XbwNX: return $zrT3F; goto ziBXl; B1DwC: foreach ($owLu9 as $ywRGS) { if (call_user_func_array($AKg7l, array($ywRGS, $DYG2U))) { goto xn7dU; gIm2Y: if (isset($ywRGS['_child'])) { $edZxL['_child'] = self::fileTreeFilter($ywRGS['_child'], $AKg7l, $DYG2U + 1); } goto kCW7l; kCW7l: $zrT3F[] = $edZxL; goto u7EUi; xn7dU: $edZxL = $ywRGS; goto gIm2Y; u7EUi: } } goto XbwNX; ziBXl: } private static function fileTreeSortNodes(&$EApxo) { usort($EApxo, function ($Z8OEc, $hc1S8) { if (isset($Z8OEc['type']) && isset($hc1S8['type'])) { return strcmp($Z8OEc['name'], $hc1S8['name']); } else { if (isset($Z8OEc['type'])) { return 1; } else { if (isset($hc1S8['type'])) { return -1; } } } return strcmp($Z8OEc['name'], $hc1S8['name']); }); return $EApxo; } private static function fileTreeSort(&$owLu9) { goto EaEsd; EaEsd: foreach ($owLu9 as &$ywRGS) { if (isset($ywRGS['_child'])) { self::fileTreeSort($ywRGS['_child']); } } goto N1okI; N1okI: self::fileTreeSortNodes($owLu9); goto p4CnS; p4CnS: return $owLu9; goto zVkD6; zVkD6: } public static function fileTree($hCl98, $mH3Yd = array()) { goto z0Hfu; uGlXs: if ($mH3Yd['ignoreHidden']) { $owLu9 = self::fileTreeFilter($owLu9, function ($ywRGS, $DYG2U) { if (Str::startsWith($ywRGS['name'], '.')) { return false; } return true; }); } goto Dry6w; v_11y: $fGqrl = new Zipper(); goto ZiXQ1; cyEex: $a3n3M = ArrayUtil::sortByKey($a3n3M, 'path'); goto oZCU_; U8B5j: if (!isset($mH3Yd['maxDepth'])) { $mH3Yd['maxDepth'] = 0; } goto Nnhqt; wel19: return self::fileTreeSort($owLu9); goto Co6bq; gezx2: if ($mH3Yd['ignoreSystem']) { $owLu9 = self::fileTreeFilter($owLu9, function ($ywRGS, $DYG2U) { if (isset($ywRGS['type'])) { if (in_array($ywRGS['type'], array('DS_Store'))) { return false; } } else { if (in_array($ywRGS['name'], array('__MACOSX'))) { return false; } } return true; }); } goto uGlXs; Dry6w: if ($mH3Yd['detectRoot']) { goto d1v6Y; d1v6Y: $oQtao = $owLu9; goto YwaiV; RwhJA: $owLu9 = $oQtao; goto F35r3; YwaiV: for (;;) { if (count($oQtao) > 1) { break; } if (!isset($oQtao[0]['_child'])) { break; } $oQtao = $oQtao[0]['_child']; } goto RwhJA; F35r3: } goto XyaHB; ZiXQ1: $fGqrl->make($hCl98); goto Vaphp; Vaphp: $a3n3M = array(); goto sHw8p; RK3HG: if (!isset($mH3Yd['ignoreHidden'])) { $mH3Yd['ignoreHidden'] = true; } goto U8B5j; oZCU_: $owLu9 = self::fileTreeBuild($a3n3M); goto gezx2; sHw8p: $fGqrl->getRepository()->each(function ($HQ4FM, $ZyJ3i) use(&$a3n3M) { $a3n3M[] = array('path' => str_replace('\\', '/', $HQ4FM), 'size' => $ZyJ3i['size']); }); goto RM1Gy; XyaHB: if ($mH3Yd['maxDepth'] > 0) { $owLu9 = self::fileTreeFilter($owLu9, function ($ywRGS, $DYG2U) use($mH3Yd) { return $DYG2U < $mH3Yd['maxDepth']; }); } goto wel19; Nnhqt: if (!isset($mH3Yd['detectRoot'])) { $mH3Yd['detectRoot'] = false; } goto v_11y; RM1Gy: $fGqrl->close(); goto cyEex; z0Hfu: if (!isset($mH3Yd['ignoreSystem'])) { $mH3Yd['ignoreSystem'] = true; } goto RK3HG; Co6bq: } }