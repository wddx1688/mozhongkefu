<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Util; class CurlUtil { private static function JSONResult($SIPLh, $BDbmq = '', $nx179 = null) { goto vBtdK; tTAKw: if (null !== $nx179) { $jq2n1['data'] = $nx179; } goto A13wD; A13wD: return $jq2n1; goto gGCxn; vBtdK: $jq2n1 = array('code' => $SIPLh, 'msg' => $BDbmq); goto tTAKw; gGCxn: } private static function removeStringBOF($ylUv7) { if (strlen($ylUv7) >= 3) { if ('EFBBBF' == sprintf('%X%X%X', ord($ylUv7[0]), ord($ylUv7[1]), ord($ylUv7[2]))) { return substr($ylUv7, 3); } } return $ylUv7; } public static function getJSONData($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto lw1bT; lw1bT: $nMi2c = self::getJSON($ikc2A, $kKcR8, $mH3Yd); goto zXYix; zXYix: if ($nMi2c['code'] === 0) { return $nMi2c['data']; } goto beYJK; beYJK: return null; goto NScx5; NScx5: } public static function getJSON($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto Yahv0; eg4LG: return self::JSONResult(0, '', $pKNCN); goto wdMJ0; Xt4jF: if (empty($jq2n1['body'])) { return self::JSONResult(-1, 'CurlUtil.getJSON result empty'); } goto ubU9Z; Yahv0: $jq2n1 = self::get($ikc2A, $kKcR8, $mH3Yd); goto Xt4jF; rzDeD: if (empty($pKNCN)) { return self::JSONResult(-1, 'CurlUtil.getJSON json parse error', $jq2n1['body']); } goto eg4LG; PEoyr: $pKNCN = @json_decode($jq2n1['body'], true); goto rzDeD; ubU9Z: $jq2n1['body'] = self::removeStringBOF($jq2n1['body']); goto PEoyr; wdMJ0: } public static function postContent($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto isRp5; FRl33: if (empty($jq2n1['body'])) { return null; } goto E_Dsi; isRp5: $jq2n1 = self::post($ikc2A, $kKcR8, $mH3Yd); goto FRl33; E_Dsi: return $jq2n1['body']; goto xTQFG; xTQFG: } public static function postJSONBody($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto KJNqL; KJNqL: $nMi2c = self::postJSON($ikc2A, $kKcR8, $mH3Yd); goto EAcUR; EAcUR: if ($nMi2c['code']) { return $nMi2c; } goto u_ibd; u_ibd: return $nMi2c['data']; goto YOrmT; YOrmT: } public static function postJSON($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto mXZNq; P2_xx: if (empty($pKNCN)) { return self::JSONResult(-1, 'CurlUtil.postJSON json parse error', $jq2n1['body']); } goto EiUe2; QI5YA: $jq2n1['body'] = self::removeStringBOF($jq2n1['body']); goto mo8IG; T0q63: if (empty($jq2n1['body'])) { return self::JSONResult(-1, 'CurlUtil.postJSON result empty'); } goto QI5YA; EiUe2: return self::JSONResult(0, '', $pKNCN); goto RfvCX; mo8IG: $pKNCN = @json_decode($jq2n1['body'], true); goto P2_xx; mXZNq: $jq2n1 = self::post($ikc2A, $kKcR8, $mH3Yd); goto T0q63; RfvCX: } public static function putJSON($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto i7xco; ILdMx: return self::JSONResult(0, '', $pKNCN); goto w3ReU; kXH6M: $jq2n1['body'] = self::removeStringBOF($jq2n1['body']); goto qEXFN; lmqDw: if (empty($pKNCN)) { return self::JSONResult(-1, 'CurlUtil.putJSON json parse error', $jq2n1['body']); } goto ILdMx; i7xco: $jq2n1 = self::put($ikc2A, $kKcR8, $mH3Yd); goto RppVn; RppVn: if (empty($jq2n1['body'])) { return self::JSONResult(-1, 'CurlUtil.putJSON result empty'); } goto kXH6M; qEXFN: $pKNCN = @json_decode($jq2n1['body'], true); goto lmqDw; w3ReU: } public static function deleteJSON($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto uSeOC; oHC03: $pKNCN = @json_decode($jq2n1['body'], true); goto xn0ga; njta6: if (empty($jq2n1['body'])) { return self::JSONResult(-1, 'CurlUtil.deleteJSON result empty'); } goto N0EaF; uSeOC: $jq2n1 = self::delete($ikc2A, $kKcR8, $mH3Yd); goto njta6; L4ace: return self::JSONResult(0, '', $pKNCN); goto Ymuqi; N0EaF: $jq2n1['body'] = self::removeStringBOF($jq2n1['body']); goto oHC03; xn0ga: if (empty($pKNCN)) { return self::JSONResult(-1, 'CurlUtil.deleteJSON json parse error', $jq2n1['body']); } goto L4ace; Ymuqi: } public static function get($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { $mH3Yd['method'] = 'get'; return self::request($ikc2A, $kKcR8, $mH3Yd); } public static function post($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { $mH3Yd['method'] = 'post'; return self::request($ikc2A, $kKcR8, $mH3Yd); } public static function put($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { $mH3Yd['method'] = 'put'; return self::request($ikc2A, $kKcR8, $mH3Yd); } public static function delete($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { $mH3Yd['method'] = 'delete'; return self::request($ikc2A, $kKcR8, $mH3Yd); } public static function request($ikc2A, $kKcR8, $mH3Yd = array()) { goto kGB8t; V6wJx: if ($W3OQX) { goto dUdxF; WVgsJ: foreach (explode('
', $fgklD) as $ijEg1) { $ijEg1 = trim($ijEg1); if (preg_match('/^(.*?):(.*?)$/', $ijEg1, $jRzIK)) { $jq2n1['header'][] = array(trim($jRzIK[1]) => trim($jRzIK[2])); $jq2n1['headerMap'][trim($jRzIK[1])] = trim($jRzIK[2]); } } goto RpR21; BsejR: $jq2n1['body'] = substr($XChuh, $nb81w); goto WVgsJ; dy669: $fgklD = substr($XChuh, 0, $nb81w); goto BsejR; dUdxF: $nb81w = curl_getinfo($lQbOb, CURLINFO_HEADER_SIZE); goto dy669; RpR21: } else { $jq2n1['body'] = $XChuh; } goto q0WvJ; e8So8: if (!isset($mH3Yd['timeout'])) { $mH3Yd['timeout'] = 30; } goto tB6HO; WyhUm: if (defined('CURLOPT_IPRESOLVE') && defined('CURL_IPRESOLVE_V4')) { curl_setopt($lQbOb, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4); } goto BuzKI; ZCqKG: if (strpos($ikc2A, 'https://') === 0) { curl_setopt($lQbOb, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($lQbOb, CURLOPT_SSL_VERIFYHOST, false); } goto yz2X2; wm_Nm: if (!empty($mH3Yd['debugFile'])) { goto wqOsE; xEKAR: $EdFKH = fopen($mH3Yd['debugFile'], 'w'); goto r6Ppz; r6Ppz: curl_setopt($lQbOb, CURLOPT_STDERR, $EdFKH); goto knZjw; wqOsE: curl_setopt($lQbOb, CURLOPT_VERBOSE, true); goto xEKAR; knZjw: } goto mCXRB; n_igE: curl_setopt($lQbOb, CURLOPT_RETURNTRANSFER, true); goto Yb7uh; cQMxF: $W3OQX = false; goto J5TOM; XmUAd: if (!empty($xRKal)) { curl_setopt($lQbOb, CURLOPT_HTTPHEADER, $xRKal); } goto n_igE; qOPub: return $jq2n1; goto fVtqm; mCXRB: curl_setopt($lQbOb, CURLOPT_HEADER, $W3OQX); goto XmUAd; tB6HO: $jq2n1 = array(); goto sn38F; pPpTB: $jq2n1['code'] = curl_getinfo($lQbOb, CURLINFO_HTTP_CODE); goto V6wJx; Q0UZJ: if (!empty($mH3Yd['header'])) { foreach ($mH3Yd['header'] as $dKmL2 => $yFWLi) { $xRKal[] = "{$dKmL2}:{$yFWLi}"; } } goto cQMxF; Vkn3O: if (!isset($mH3Yd['userAgent'])) { $mH3Yd['userAgent'] = self::defaultUserAgent(); } goto GOHSs; kGB8t: $xRKal = array(); goto Q0UZJ; QDzdw: curl_close($lQbOb); goto qOPub; sn38F: $jq2n1['code'] = 0; goto BFUFq; J5TOM: if (!empty($mH3Yd['returnHeader'])) { $W3OQX = true; } goto InPa2; GOHSs: if (isset($mH3Yd['userAgentAppend'])) { $mH3Yd['userAgent'] .= ' ' . $mH3Yd['userAgentAppend']; } goto ZPbED; f82ge: $lQbOb = curl_init($ikc2A); goto wm_Nm; ZPbED: if (!empty($mH3Yd['userAgent'])) { curl_setopt($lQbOb, CURLOPT_USERAGENT, $mH3Yd['userAgent']); } goto X4OIm; BFUFq: $jq2n1['body'] = null; goto zPiWK; InPa2: if (!isset($mH3Yd['method'])) { $mH3Yd['method'] = 'get'; } goto e8So8; Yb7uh: curl_setopt($lQbOb, CURLOPT_TIMEOUT, $mH3Yd['timeout']); goto WyhUm; zTLh7: if (!empty($mH3Yd['debugFile'])) { file_put_contents($mH3Yd['debugFile'], '

' . $XChuh, FILE_APPEND); } goto pPpTB; zPiWK: if ($W3OQX) { $jq2n1['header'] = array(); $jq2n1['headerMap'] = array(); } goto hTBqb; yz2X2: if (!empty($mH3Yd['socks5'])) { curl_setopt($lQbOb, CURLOPT_PROXYTYPE, CURLPROXY_SOCKS5); curl_setopt($lQbOb, CURLOPT_PROXY, $mH3Yd['socks5']); } else { if (!empty($mH3Yd['http_proxy'])) { curl_setopt($lQbOb, CURLOPT_PROXYTYPE, CURLPROXY_HTTP); curl_setopt($lQbOb, CURLOPT_PROXY, $mH3Yd['http_proxy']); } } goto Vkn3O; q0WvJ: if (0 === $jq2n1['code']) { $jq2n1['error'] = curl_error($lQbOb); } goto QDzdw; X4OIm: $XChuh = curl_exec($lQbOb); goto zTLh7; BuzKI: switch (strtolower($mH3Yd['method'])) { case 'post': goto QwZRe; B8RV_: curl_setopt($lQbOb, CURLOPT_POSTFIELDS, $kKcR8); goto v9osb; v9osb: break; goto yo1_z; QwZRe: curl_setopt($lQbOb, CURLOPT_POST, true); goto B8RV_; yo1_z: case 'put': goto vd78Y; eJq8G: break; goto sIa1L; vd78Y: curl_setopt($lQbOb, CURLOPT_CUSTOMREQUEST, 'PUT'); goto QYOlV; QYOlV: curl_setopt($lQbOb, CURLOPT_POSTFIELDS, $kKcR8); goto eJq8G; sIa1L: case 'delete': goto QGqzC; QGqzC: curl_setopt($lQbOb, CURLOPT_CUSTOMREQUEST, 'DELETE'); goto VQzPa; cFCHg: break; goto FP6w8; VQzPa: curl_setopt($lQbOb, CURLOPT_POSTFIELDS, $kKcR8); goto cFCHg; FP6w8: } goto ZCqKG; hTBqb: if ($mH3Yd['method'] == 'get') { if (!empty($kKcR8)) { $ikc2A = $ikc2A . '?' . http_build_query($kKcR8); } } goto f82ge; fVtqm: } public static function proxyRequest($CKx4X, $ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto e51fl; e51fl: $Q7eHq = $mH3Yd; goto dfcTn; dfcTn: $Q7eHq['url'] = $ikc2A; goto UOx18; x34Lx: return $N19iJ; goto ScnkF; UOx18: $Q7eHq['param'] = $kKcR8; goto YZQ2e; uxugW: $N19iJ = @base64_decode($N19iJ); goto sFh90; YZQ2e: $ikc2A = "{$CKx4X}?package=" . urlencode(base64_encode(SerializeUtil::jsonEncode($Q7eHq))); goto ztytu; sFh90: $N19iJ = @unserialize($N19iJ); goto x34Lx; ztytu: $N19iJ = self::getRaw($ikc2A); goto uxugW; ScnkF: } public static function proxyCommon($CKx4X, $Q7eHq) { goto vdMCK; BLJkZ: $N19iJ = @unserialize($N19iJ); goto OF91w; EFAcD: $N19iJ = self::getRaw($ikc2A); goto nmJJS; OF91w: return $N19iJ; goto YjqYD; vdMCK: $ikc2A = "{$CKx4X}?package=" . urlencode(base64_encode(SerializeUtil::jsonEncode($Q7eHq))); goto EFAcD; nmJJS: $N19iJ = @base64_decode($N19iJ); goto BLJkZ; YjqYD: } public static function postRaw($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto QT_4M; Hj0sI: if (!empty($xRKal)) { curl_setopt($lQbOb, CURLOPT_HTTPHEADER, $xRKal); } goto K_UUA; cM08t: if (StrUtil::startWith($ikc2A, 'https://')) { curl_setopt($lQbOb, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($lQbOb, CURLOPT_SSL_VERIFYHOST, false); } goto NIJ4M; EF_sT: if (!isset($mH3Yd['userAgent'])) { $mH3Yd['userAgent'] = self::defaultUserAgent(); } goto QNh8T; q1wU7: if (defined('CURLOPT_IPRESOLVE') && defined('CURL_IPRESOLVE_V4')) { curl_setopt($lQbOb, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4); } goto cM08t; QNh8T: if (!empty($mH3Yd['userAgent'])) { curl_setopt($lQbOb, CURLOPT_USERAGENT, $mH3Yd['userAgent']); } goto XkNZw; Wxt2Z: curl_setopt($lQbOb, CURLOPT_HEADER, false); goto Hj0sI; ZdLw0: curl_close($lQbOb); goto T6TCS; JSUXQ: curl_setopt($lQbOb, CURLOPT_POSTFIELDS, $kKcR8); goto EF_sT; vwsWd: if (!empty($mH3Yd['header'])) { foreach ($mH3Yd['header'] as $dKmL2 => $yFWLi) { $xRKal[] = "{$dKmL2}:{$yFWLi}"; } } goto fYjqB; K_UUA: curl_setopt($lQbOb, CURLOPT_RETURNTRANSFER, 1); goto LKVBu; XkNZw: $BEW34 = curl_exec($lQbOb); goto ZdLw0; Am0M0: $xRKal = array(); goto vwsWd; QT_4M: if (empty($mH3Yd['timeout'])) { $mH3Yd['timeout'] = 30; } goto Am0M0; LKVBu: curl_setopt($lQbOb, CURLOPT_TIMEOUT, $mH3Yd['timeout']); goto Vnnbk; T6TCS: return $BEW34; goto XWz8a; fYjqB: $lQbOb = curl_init(); goto qSmwn; NIJ4M: curl_setopt($lQbOb, CURLOPT_POST, true); goto JSUXQ; qSmwn: curl_setopt($lQbOb, CURLOPT_URL, $ikc2A); goto Wxt2Z; Vnnbk: curl_setopt($lQbOb, CURLOPT_REFERER, $ikc2A); goto q1wU7; XWz8a: } public static function getRaw($ikc2A, $kKcR8 = array(), $mH3Yd = array()) { goto Ev8az; cNgm_: if (StrUtil::startWith($ikc2A, 'https://')) { curl_setopt($lQbOb, CURLOPT_SSL_VERIFYPEER, false); curl_setopt($lQbOb, CURLOPT_SSL_VERIFYHOST, false); } goto E7tkC; NqjvK: if (defined('CURLOPT_IPRESOLVE') && defined('CURL_IPRESOLVE_V4')) { curl_setopt($lQbOb, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4); } goto cNgm_; vsaLm: curl_setopt($lQbOb, CURLOPT_RETURNTRANSFER, 1); goto h9wrM; h9wrM: curl_setopt($lQbOb, CURLOPT_TIMEOUT, $mH3Yd['timeout']); goto UOlhu; E7tkC: if (!isset($mH3Yd['userAgent'])) { $mH3Yd['userAgent'] = self::defaultUserAgent(); } goto gWzkS; UOlhu: curl_setopt($lQbOb, CURLOPT_REFERER, $ikc2A); goto NqjvK; gX8tL: return $BEW34; goto X2ucB; CucSK: $lQbOb = curl_init(); goto CkKNN; PtdLg: if (200 != $k9D4c) { return null; } goto gX8tL; He8kP: $tTE4w = curl_getinfo($lQbOb, CURLINFO_CONTENT_TYPE); goto xEN1P; VMR0l: curl_setopt($lQbOb, CURLOPT_HEADER, false); goto LdjV3; CkKNN: curl_setopt($lQbOb, CURLOPT_URL, $ikc2A); goto VMR0l; gMq78: $BEW34 = curl_exec($lQbOb); goto QXVEU; gWzkS: if (!empty($mH3Yd['userAgent'])) { curl_setopt($lQbOb, CURLOPT_USERAGENT, $mH3Yd['userAgent']); } goto gMq78; Ev8az: if (empty($mH3Yd['timeout'])) { $mH3Yd['timeout'] = 30; } goto HkFNI; XcIw5: if (!empty($mH3Yd['header'])) { foreach ($mH3Yd['header'] as $dKmL2 => $yFWLi) { $xRKal[] = "{$dKmL2}:{$yFWLi}"; } } goto CucSK; WXcSk: if (!empty($mH3Yd['returnRaw'])) { $MbVsF = FileUtil::mimeToExt($tTE4w); return array('httpCode' => $k9D4c, 'contentType' => $tTE4w, 'ext' => $MbVsF, 'body' => $BEW34); } goto PtdLg; xEN1P: curl_close($lQbOb); goto WXcSk; HkFNI: if (!empty($kKcR8)) { $ikc2A = $ikc2A . '?' . http_build_query($kKcR8); } goto TGo27; TGo27: $xRKal = array(); goto XcIw5; LdjV3: if (!empty($xRKal)) { curl_setopt($lQbOb, CURLOPT_HTTPHEADER, $xRKal); } goto vsaLm; QXVEU: $k9D4c = curl_getinfo($lQbOb, CURLINFO_HTTP_CODE); goto He8kP; X2ucB: } public static function defaultUserAgent() { goto YSh6V; eYWNf: return $zm1Wf; goto XRI7L; YSh6V: $zm1Wf = 'MSCore/' . modstart_version() . ' PHP/' . PHP_VERSION . ' OS/' . PHP_OS; goto uLo8Q; KklVr: if (!empty($uv26e)) { $zm1Wf = implode('/', $uv26e) . ' ' . $zm1Wf; } goto eYWNf; uLo8Q: $uv26e = array(); goto F5sFt; F5sFt: if (class_exists(\App\Constant\AppConstant::class)) { if (defined('\\App\\Constant\\AppConstant::APP')) { $uv26e[] = strtoupper(\App\Constant\AppConstant::APP); } if (defined('\\App\\Constant\\AppConstant::VERSION')) { $uv26e[] = \App\Constant\AppConstant::VERSION; } } goto KklVr; XRI7L: } public static function mockUserAgent() { return 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'; } }