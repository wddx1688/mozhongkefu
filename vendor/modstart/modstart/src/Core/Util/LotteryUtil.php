<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Util; class LotteryUtil { public static function fetchPoll(array $JjvTh) { goto VyRZg; MO6rk: foreach ($JjvTh as $DUr2V) { goto XbEgz; R0WLf: if ($I3hy7 <= 0) { continue; } goto lyWlC; ZIScB: if ($kOFY1 > 10000) { throw new \Exception('bad lottery pool 10000'); } goto TuuA_; lyWlC: for ($qsK6T = 0; $qsK6T < $I3hy7; $qsK6T++) { $bx4aO[$kOFY1++] = $DUr2V['id']; } goto ZIScB; XbEgz: $I3hy7 = intval(bcmul($DUr2V['rate'], 100, 2)); goto R0WLf; TuuA_: } goto c09TX; zGhGd: return $bx4aO[$kOFY1]; goto PK1nH; eBaa6: $kOFY1 = rand(0, 9999); goto zGhGd; VyRZg: $bx4aO = array(); goto UqFYz; UqFYz: $kOFY1 = 0; goto MO6rk; c09TX: while ($kOFY1 < 10000) { $bx4aO[$kOFY1++] = null; } goto eBaa6; PK1nH: } public static function randomMoneyInRange($ubqta, $FROwv) { $JsG5m = rand(intval(bcmul($ubqta, 100, 2)), intval(bcmul($FROwv, 100, 2))); return bcdiv($JsG5m, 100, 2); } private static function generate($SIPLh, $BDbmq, $nx179 = null) { goto v5M3q; v5M3q: $xtWCf = array('code' => $SIPLh, 'msg' => $BDbmq, 'data' => $nx179); goto S7U13; o_Erq: return $xtWCf; goto nKmFX; S7U13: if (null === $nx179) { unset($xtWCf['data']); } goto o_Erq; nKmFX: } public static function money($DfW2Z, $eI1Ye, $L32Hm, $uxZCM) { goto A46mT; niYKZ: $V15Ad = $Pm92r - $ubqta * $eI1Ye; goto bOsio; ZZIZE: if ($eI1Ye < 1 || $eI1Ye > 100000) { return self::generate(-1, '数量范围为 1-100000'); } goto RarHm; CCf73: for ($qsK6T = 0, $QymTl = $FROwv - $ubqta; $qsK6T < $eI1Ye; $qsK6T++) { if ($V15Ad > 0) { goto g8RVE; g8RVE: $muOjE = rand(0, $QymTl); goto UQ9VT; DPSyR: $V15Ad -= $muOjE; goto EZALj; UQ9VT: if ($muOjE > $V15Ad) { $muOjE = $V15Ad; } goto DPSyR; EZALj: } else { $muOjE = 0; } $ej2Gz[] = $ubqta + $muOjE; } goto xB_Ul; mgzvN: if ($Pm92r < $ubqta * $eI1Ye) { return self::generate(-1, '金额最少为' . sprintf('%0.2f', bcdiv($ubqta * $eI1Ye, 100, 2))); } goto uOOU7; moAL9: $Pm92r = bcdiv(array_sum($ej2Gz), 100, 2); goto S3bUi; S3bUi: foreach ($ej2Gz as &$ULJ0H) { $ULJ0H = bcdiv($ULJ0H, 100, 2); } goto gO_yT; A46mT: $ubqta = intval(bcmul($L32Hm, 100, 2)); goto aiuAb; gWqJ2: return self::generate(0, null, array('total' => $Pm92r, 'min' => bcdiv($ubqta, 100, 2), 'max' => bcdiv($FROwv, 100, 2), 'number' => $eI1Ye, 'moneys' => $ej2Gz)); goto VVQ3f; bOsio: $ej2Gz = array(); goto CCf73; aiuAb: $FROwv = intval(bcmul($uxZCM, 100, 2)); goto ksmo8; gO_yT: shuffle($ej2Gz); goto gWqJ2; ENmqv: $eI1Ye = intval($eI1Ye); goto mgzvN; RarHm: if ($Pm92r < 1 || $Pm92r > 1000000 * 100) { return self::generate(-1, '金额范围为 0.01-1000000.00'); } goto niYKZ; ksmo8: $Pm92r = intval(bcmul($DfW2Z, 100, 2)); goto ENmqv; xB_Ul: if ($V15Ad > 0) { foreach ($ej2Gz as &$ULJ0H) { goto VT5qR; Pa4UY: if (!$QymTl) { continue; } goto bWo9X; VT5qR: $QymTl = $FROwv - $ULJ0H; goto Pa4UY; bWo9X: if ($QymTl <= $V15Ad) { $ULJ0H += $QymTl; $V15Ad -= $QymTl; } else { goto E3Kq4; E3Kq4: $ULJ0H += $V15Ad; goto vhxUt; ReQ83: break; goto fj8b0; vhxUt: $V15Ad = 0; goto ReQ83; fj8b0: } goto mYqpj; mYqpj: } } goto moAL9; uOOU7: if ($Pm92r > $FROwv * $eI1Ye) { return self::generate(-1, '金额最多为' . sprintf('%0.2f', bcdiv($FROwv * $eI1Ye, 100, 2))); } goto ZZIZE; VVQ3f: } public static function next($DfW2Z, $eI1Ye, $L32Hm = null, $uxZCM = null) { goto kBh9e; NEHQn: return self::generate(0, null, array('money' => $nMi2c['data']['moneys'][0])); goto gay07; EWcAV: if (null === $uxZCM) { goto y24Dy; FFfI4: $uxZCM = bcdiv($uxZCM, 100, 2); goto OogXd; y24Dy: $Pm92r = bcmul($DfW2Z, 100, 2); goto AwOGS; AwOGS: $uxZCM = max(intval($Pm92r / $eI1Ye * 2), 1); goto FFfI4; OogXd: } goto CPDK8; gSQ0h: if ($nMi2c['code']) { return self::generate(-1, $nMi2c['msg']); } goto NEHQn; CPDK8: $nMi2c = self::money($DfW2Z, $eI1Ye, $L32Hm, $uxZCM); goto gSQ0h; kBh9e: if (null === $L32Hm) { goto nw6ia; nw6ia: $Pm92r = bcmul($DfW2Z, 100, 2); goto Y94qq; Y94qq: $L32Hm = max(intval($Pm92r / $eI1Ye / 2), 1); goto R_ldt; R_ldt: $L32Hm = bcdiv($L32Hm, 100, 2); goto ghToD; ghToD: } goto EWcAV; gay07: } public static function lottery(array $JjvTh) { goto aQkNI; kxgsR: while ($kOFY1 < 100) { $bx4aO[$kOFY1++] = null; } goto okKfx; sVc0v: $kOFY1 = 0; goto NBnY3; NBnY3: foreach ($JjvTh as $DUr2V) { for ($qsK6T = 0; $qsK6T < $DUr2V['rate']; $qsK6T++) { $bx4aO[$kOFY1++] = $DUr2V['id']; } if ($kOFY1 > 100) { throw new \Exception('bad lottery pool'); } } goto kxgsR; okKfx: $kOFY1 = rand(0, 99); goto G6Ssi; aQkNI: $bx4aO = array(); goto sVc0v; G6Ssi: return $bx4aO[$kOFY1]; goto mwDDo; mwDDo: } public static function preciseLottery(array $JjvTh) { goto HNjew; Dgw12: foreach ($JjvTh as $DUr2V) { goto cSI0Z; Mlv3l: if ($kOFY1 > 10000) { throw new \Exception('bad lottery pool 10000'); } goto FwZ2u; m0CZU: for ($qsK6T = 0; $qsK6T < $I3hy7; $qsK6T++) { $bx4aO[$kOFY1++] = $DUr2V['id']; } goto Mlv3l; cSI0Z: $I3hy7 = intval(bcmul($DUr2V['rate'], 100, 2)); goto m0CZU; FwZ2u: } goto sz3v0; sz3v0: while ($kOFY1 < 10000) { $bx4aO[$kOFY1++] = null; } goto gI2q0; P1wOk: return $bx4aO[$kOFY1]; goto acKlf; gI2q0: $kOFY1 = rand(0, 9999); goto P1wOk; SQXjZ: $kOFY1 = 0; goto Dgw12; HNjew: $bx4aO = array(); goto SQXjZ; acKlf: } public static function probability($Zxaam) { return rand(0, 99) < $Zxaam; } }