<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace ModStart\Core\Util; use Illuminate\Support\Str; use ModStart\Core\Assets\AssetsUtil; use ModStart\Misc\Html\Purifier; class HtmlUtil { public static function replaceImageSrcToLazyLoad($N19iJ, $A7qE2 = 'data-src', $vkrVZ = false) { goto ZwoRR; ZwoRR: preg_match_all('/(<img.*?)src="(.*?)"(.*?>)/i', $N19iJ, $jRzIK); goto nKKvG; nKKvG: if ($vkrVZ) { foreach ($jRzIK[0] as $dKmL2 => $yFWLi) { $N19iJ = str_replace($yFWLi, $jRzIK[1][$dKmL2] . $A7qE2 . '="' . AssetsUtil::fix($jRzIK[2][$dKmL2]) . '"' . $jRzIK[3][$dKmL2], $N19iJ); } } else { foreach ($jRzIK[0] as $dKmL2 => $yFWLi) { $N19iJ = str_replace($yFWLi, $jRzIK[1][$dKmL2] . $A7qE2 . '="' . AssetsUtil::fix($jRzIK[2][$dKmL2]) . '"' . $jRzIK[3][$dKmL2], $N19iJ); } } goto APD9O; APD9O: return $N19iJ; goto gqQWy; gqQWy: } public static function replaceImageSrcToFull($N19iJ, $vkrVZ = false, $whJLa = null) { goto Xmn7D; Xmn7D: preg_match_all('/(<img.*?)src="(.*?)"(.*?>)/i', $N19iJ, $jRzIK); goto ciMV5; l8MSs: return $N19iJ; goto CUMca; ciMV5: foreach ($jRzIK[0] as $dKmL2 => $yFWLi) { if ($whJLa) { $N19iJ = str_replace($yFWLi, $jRzIK[1][$dKmL2] . 'src="' . AssetsUtil::fixFullWithCdn($jRzIK[2][$dKmL2], $whJLa) . '"' . $jRzIK[3][$dKmL2], $N19iJ); } else { if ($vkrVZ) { $N19iJ = str_replace($yFWLi, $jRzIK[1][$dKmL2] . 'src="' . AssetsUtil::fixFull($jRzIK[2][$dKmL2]) . '"' . $jRzIK[3][$dKmL2], $N19iJ); } else { $N19iJ = str_replace($yFWLi, $jRzIK[1][$dKmL2] . 'src="' . AssetsUtil::fixCurrentDomain($jRzIK[2][$dKmL2]) . '"' . $jRzIK[3][$dKmL2], $N19iJ); } } } goto l8MSs; CUMca: } public static function recordsReplaceImageSrcToFull(&$nQYo_, $cANPj, $vkrVZ = false, $whJLa = null) { foreach ($nQYo_ as $dKmL2 => $yFWLi) { $nQYo_[$dKmL2][$cANPj] = self::replaceImageSrcToFull($yFWLi[$cANPj], $vkrVZ, $whJLa); } } public static function extractTextAndImages($N19iJ) { goto s_dEU; GpHyL: $Mwn80['text'] = $ZIfTd; goto vyz2T; H7jbm: return $Mwn80; goto nSRvO; vyz2T: preg_match_all('/<img.*?src="(.*?)".*?>/i', $N19iJ, $jRzIK); goto A_zO4; s_dEU: $Mwn80 = array('text' => '', 'images' => array()); goto qvBUI; qvBUI: $ZIfTd = preg_replace('/<[^>]+>/', '', $N19iJ); goto GpHyL; A_zO4: if (!empty($jRzIK[1])) { $Mwn80['images'] = $jRzIK[1]; } goto H7jbm; nSRvO: } public static function cover($N19iJ) { goto vAxSE; vAxSE: preg_match_all('/<img.*?src="(.*?)".*?>/i', $N19iJ, $jRzIK); goto kLLa_; eARLL: return null; goto QtiTq; kLLa_: if (!empty($jRzIK[1][0])) { return $jRzIK[1][0]; } goto eARLL; QtiTq: } public static function text($N19iJ, $d5BqU = null) { goto uNA2z; U8SMm: return str_replace(array('&nbsp;'), array(' '), $ZIfTd); goto c30KZ; uNA2z: $ZIfTd = preg_replace('/<[^>]+>/', '', $N19iJ); goto yihmi; yihmi: if (null !== $d5BqU) { $ZIfTd = Str::limit($ZIfTd, $d5BqU); } goto U8SMm; c30KZ: } public static function filter($N19iJ) { if (empty($N19iJ)) { return $N19iJ; } return Purifier::cleanHtml($N19iJ); } public static function filter2($N19iJ) { if (empty($N19iJ)) { return $N19iJ; } return Purifier::cleanHtml($N19iJ); } public static function text2html($ZIfTd, $IT8O_ = true) { goto tdlwR; jg7yo: return '<p>' . $ZIfTd . '</p>'; goto x2CsP; tdlwR: if (empty($ZIfTd)) { return ''; } goto PUzkz; eBgF2: $ZIfTd = str_replace('', '', $ZIfTd); goto QhS3G; QhS3G: $ZIfTd = str_replace('
', '</p><p>', $ZIfTd); goto icdPC; icdPC: $ZIfTd = str_replace('<p></p>', '<p>&nbsp;</p>', $ZIfTd); goto jg7yo; PUzkz: if ($IT8O_) { $ZIfTd = htmlspecialchars($ZIfTd, ENT_QUOTES, 'UTF-8', false); } goto eBgF2; x2CsP: } public static function text2htmlSimpleRich($ZIfTd, $IT8O_ = true) { goto nTyGp; f8XnW: return $N19iJ; goto CEccE; jw5zh: $N19iJ = preg_replace('|([\\w\\d]*)\\s?(https?://([\\d\\w\\.-]+\\.[\\w\\.]{2,6})[^\\s\\]\\[\\<\\>]*/?)|i', '<a href="$2" target="_blank">$0</a>', $N19iJ); goto f8XnW; nTyGp: $N19iJ = self::text2html($ZIfTd, $IT8O_); goto jw5zh; CEccE: } public static function html2text($ZIfTd) { return str_replace(array('</p>', '<p>'), array('
', ''), $ZIfTd); } public static function workCount($N19iJ) { goto cXYYw; cXYYw: $N19iJ = preg_replace('/<[^>]+>/', '^', $N19iJ); goto HDRpB; xNOBG: $N19iJ = preg_replace('/[^\\x{4e00}-\\x{9fa5}]+/u', '', $N19iJ); goto W63YU; ksvj3: return $SzHab + $skjW8; goto mOvh5; W63YU: $skjW8 = mb_strlen($N19iJ, 'utf-8'); goto ksvj3; cx5tj: $N19iJ = str_replace('^', '', $N19iJ); goto xNOBG; smOdy: $SzHab = count($jRzIK[0]); goto cx5tj; HDRpB: preg_match_all('/[a-z0-9]+/i', $N19iJ, $jRzIK); goto smOdy; mOvh5: } }