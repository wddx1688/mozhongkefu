(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{143:function(e,t,i){"use strict";!function(s){i.d(t,"a",function(){return a});const a={scrollToBottomTimer:null,scrollChatMessagesToBottom(t){void 0===t&&(t=400),setTimeout(()=>{const e=s("#ChatMessages");a.scrollToBottomTimer&&clearTimeout(a.scrollToBottomTimer),a.scrollToBottomTimer=setTimeout(()=>{e.stop().animate({scrollTop:e.prop("scrollHeight")},t),a.scrollToBottomTimer=null},0<t?100:0)},0)}}}.call(this,i(22))},148:function(e,t,s){"use strict";s.d(t,"a",function(){return c}),s.d(t,"b",function(){return l});var i=s(18),r=s(6);let a=s(325);a.default&&(a=a.default),a.format||(a=a.format);const n={DAY_MS:864e5,MONTH_MS:2592e6,FORMAT_DATE:"YYYY-MM-DD",FORMAT_TIME:"HH:mm:ss",FORMAT_DATETIME:"YYYY-MM-DD HH:mm:ss",FORMAT_TIME_HM:"HH:mm",timestamp:()=>(new Date).getTime(),timestampSecond:()=>parseInt(n.timestamp()/1e3),date:()=>a.format(new Date,n.FORMAT_DATE),time:()=>a.format(new Date,n.FORMAT_TIME),datetime:()=>a.format(new Date,n.FORMAT_DATETIME),stringDatetime:()=>a.format(new Date,"YYYYMMDD_HHmmss"),format:(e,t)=>("string"==typeof e&&(e=new Date(e)),a.format(e,t)),formatDate:e=>n.format(e,n.FORMAT_DATE),formatDatetime:e=>n.format(e,n.FORMAT_DATETIME),formatTimestamp(e,t){let s=new Date;return s.setTime(e),n.format(s,t)},parse:(e,t)=>a.parse(e,t),parseDatetime:e=>a.parse(e,n.FORMAT_DATETIME)};var t=s(71),o=s.n(t);const l={ConnectStatus:{Connected:1,Disconnected:2}},c=function(e){this.option=Object.assign({token:"",wsServer:"",apiServer:"",onSuccess:null,onError:null,tickInterval:3e4,onTick:null},e),this.client=null,this.listeners={},this.tickTimer=null,this.apiAxios=o.a.create({baseURL:"",timeout:6e4}),this.apiAxios.interceptors.request.use(e=>(e.baseURL=this.option.apiServer,e.headers["Content-Type"]="application/json",e.headers["is-ajax"]=!0,e.headers["im-server-token"]=this.option.token,e),e=>{Promise.reject(e)}),this.apiAxios.interceptors.response.use(e=>e.data,e=>Promise.reject(e)),this.initDefault=()=>{var e=window.location,t="https:"===e.protocol?"wss:":"ws:",s=e.host,e=window.__msRoot+"im_server";this.option.wsServer=`${t}//${s}${e}`,this.option.apiServer="/api/im_server/"},this.connect=e=>{this.option=Object.assign(this.option,e);const t=()=>{this.client=null,setTimeout(()=>{this.connect()},5e3)};this.client=new WebSocket(`${this.option.wsServer}?token=${this.option.token}`),this.client.onopen=e=>{setTimeout(()=>{this.callListener("_connectChange",l.ConnectStatus.Connected),this.option.onSuccess&&this.option.onSuccess(),this.tickTimer&&clearInterval(this.tickTimer),this.tickTimer=setInterval(()=>{this.option.onTick&&this.option.onTick()},this.option.tickInterval),this.option.onTick&&this.option.onTick()},1e3)},this.client.onmessage=e=>{const t=JSON.parse(e.data);if(i.b.REQUEST.value===t.type)for(let e=0;e<this.requestQueue.length;e++)if(this.requestQueue[e].payload.data.id===t.data.id&&this.requestQueue[e].payload.data.type===t.data.type){const s=this.requestQueue.splice(e,1);delete t.data.id,delete t.data.type,"code"in t.data?0===t.data.code?s[0].cb&&s[0].cb(t.data.data):s[0].errorCB?s[0].errorCB(t.data.msg):this.option.onError&&this.option.onError(t.data.msg):s[0].errorCB?s[0].errorCB("错误返回："+JSON.stringify(t.data)):this.option.onError&&this.option.onError("错误返回："+JSON.stringify(t.data));break}this.callListener(t.type,t.data)},this.client.onerror=e=>(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),!1),this.client.onclose=e=>{this.callListener("_connectChange",l.ConnectStatus.Disconnected),t()}},this.requestQueue=[],this.request=(e,t,s,a)=>{t={type:i.b.REQUEST.value,data:{id:r.d.randomString(10),type:e,data:t}};this.requestQueue.push({payload:t,cb:s,errorCB:a,time:n.timestamp()}),this.client.send(JSON.stringify(t))},this.apiRequest=(e,t,s,a)=>{this.apiAxios.post(e,JSON.stringify(t)).then(e=>{let t=!1;"code"in e?0===e.code?s&&s(e):(a&&!0===a(e.msg)&&(t=!0),t||this.option.onError&&this.option.onError(e.msg)):(a&&!0===a("错误返回："+JSON.stringify(e))&&(t=!0),t||this.option.onError&&this.option.onError("错误返回："+JSON.stringify(e)))}).catch(e=>{a?a("错误返回："+e):this.option.onError&&this.option.onError("错误返回："+e)})},this.send=(e,t)=>{this.client.send(JSON.stringify(e)),t&&t()},this.sendMsg=(e,t,s)=>{this.send({type:e,data:t},s)},this.sendTalk=(e,t)=>{this.send({type:i.b.TALK.value,data:{chatType:i.a.SERVICE.value,...e}},t)},this.addListener=(e,t)=>{e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},this.removeListener=(t,s)=>{if(t in this.listeners)for(let e=0;e<this.listeners[t].length;e++)if(this.listeners[t][e]===s){this.listeners[t].splice(e,1);break}},this.callListener=(e,t)=>{e in this.listeners&&this.listeners[e].forEach(e=>{e(t)})},this.addCustomListener=(e,t)=>{this.addListener("custom."+e,t)},this.removeCustomListener=(e,t)=>{this.removeListener("custom."+e,t)},this.callCustomListener=(e,t)=>{this.callListener("custom."+e,t)},this.addTalkListener=e=>{this.addListener(i.b.TALK.value,e)},this.addPushListener=e=>{this.addListener(i.b.PUSH.value,e)},this.onPush=(t,s)=>{this.addPushListener(e=>{e.type===t&&s(e.data)})},this.onConnectChange=e=>{this.addListener("_connectChange",e)},this.doUnreadClear=(e,t)=>{this.sendMsg(i.b.UNREAD_CLEAR.value,{chatType:e,toId:t})},this.initDefault()}},18:function(e,t,s){"use strict";s.d(t,"b",function(){return a}),s.d(t,"f",function(){return i}),s.d(t,"a",function(){return r}),s.d(t,"d",function(){return n}),s.d(t,"c",function(){return o}),s.d(t,"e",function(){return l});const a={PING:{key:"PING",value:"ping",name:"PING"},PONG:{key:"PONG",value:"pong",name:"PONG"},ERROR:{key:"ERROR",value:"error",name:"ERROR"},USER_ONLINE:{key:"USER_ONLINE",value:"userOnline",name:"USER_ONLINE"},USER_OFFLINE:{key:"USER_OFFLINE",value:"userOffline",name:"USER_OFFLINE"},TALK:{key:"TALK",value:"talk",name:"TALK"},RECALL:{key:"RECALL",value:"recall",name:"RECALL"},INPUT:{key:"INPUT",value:"input",name:"INPUT"},UNREAD_CLEAR:{key:"UNREAD_CLEAR",value:"unreadClear",name:"UNREAD_CLEAR"},REQUEST:{key:"REQUEST",value:"request",name:"REQUEST"},PUSH:{key:"PUSH",value:"push",name:"PUSH"}},i={TEXT:{key:"TEXT",value:1,name:"文本"},IMAGE:{key:"IMAGE",value:2,name:"图片"},NOTICE:{key:"NOTICE",value:100,name:"通知"}},r={SINGLE:{key:"SINGLE",value:1,name:"私聊"},GROUP:{key:"GROUP",value:2,name:"群聊"},SERVICE:{key:"SERVICE",value:3,name:"客服"}},n={ServiceRequest:"ServiceRequest",ServiceQueueList:"ServiceQueueList",ServiceProcessingList:"ServiceProcessingList",ServiceProcessedList:"ServiceProcessedList",ServiceProcessingRequest:"ServiceProcessingRequest"},o={ServiceQueueList:"ServiceQueueList",ServiceProcessingList:"ServiceProcessingList",ServiceProcessedList:"ServiceProcessedList",ServiceUpdate:"ServiceUpdate",UnreadUpdate:"UnreadUpdate"},l={QUEUE:"queue",OFFLINE:"offline",PROCESSING:"processing",PROCESSED:"processed"}},303:function(e,t,s){"use strict";var a=s(8),a=s.n(a)()(function(e){return e[1]});a.push([e.i,".pb-chat-msg-records {\n  padding: 1rem 0;\n}\n.pb-chat-msg-records .msg-record {\n  display: flex;\n  padding: 0.25rem 0.5rem;\n}\n.pb-chat-msg-records .msg-record .msg-record-notice {\n  flex-grow: 1;\n  text-align: center;\n}\n.pb-chat-msg-records .msg-record .msg-record-notice .text {\n  display: inline-block;\n  background: #CCC;\n  color: #FFF;\n  border-radius: 0.2rem;\n  padding: 0 0.2rem;\n}\n.pb-chat-msg-records .msg-record.right {\n  flex-direction: row-reverse;\n}\n.pb-chat-msg-records .msg-record.right .msg-record-avatar {\n  text-align: right;\n}\n.pb-chat-msg-records .msg-record.right .msg-record-body {\n  text-align: right;\n}\n.pb-chat-msg-records .msg-record .msg-record-avatar {\n  width: 50px;\n}\n.pb-chat-msg-records .msg-record .msg-record-avatar a {\n  display: inline-block;\n  width: 40px;\n  height: 40px;\n  background: #FFF no-repeat center;\n  background-size: cover;\n  border-radius: 50%;\n  box-shadow: rgba(0, 0, 0, 0.12) 0px 3px 10px 0px;\n}\n.pb-chat-msg-records .msg-record .msg-record-body {\n  flex-grow: 1;\n}\n.pb-chat-msg-records .msg-record.right .text-item {\n  border-radius: 20px 5px 20px 20px;\n  background: #6071E5;\n  color: #FFF;\n  margin-right: 0px;\n}\n.pb-chat-msg-records .msg-record.right .text-item p a {\n  color: #FFF;\n}\n.pb-chat-msg-records .msg-record .text-item {\n  background-color: #fff;\n  box-shadow: rgba(0, 0, 0, 0.12) 0px 3px 10px 0px;\n  border-radius: 5px 20px 20px 20px;\n  display: inline-block;\n  padding: 10px;\n  word-break: break-all;\n  margin-bottom: 10px;\n}\n.pb-chat-msg-records .msg-record .text-item p {\n  margin: 0;\n  padding: 0;\n  line-height: 20px;\n  text-align: justify;\n}\n.pb-chat-msg-records .msg-record .text-item p a {\n  text-decoration: underline;\n}\n.pb-chat-msg-records .msg-record .image-item a img {\n  max-width: 150px;\n  max-height: 150px;\n  border-radius: 10px;\n}\n",""]),t.a=a},315:function(e,t,s){"use strict";s.d(t,"a",function(){return i});var a=s(18);const i={toChatMsgTalk(e,t){switch(e){case"text":return{talkType:a.f.TEXT.value,text:t};case"image":return{talkType:a.f.IMAGE.value,url:t}}}}},316:function(e,t,s){"use strict";var a=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"pb-chat-msg-records"},[a("div",{staticClass:"tw-text-center"},[s.hasMore?a("a",{staticClass:"ub-text-muted",attrs:{href:"javascript:;"},on:{click:s.doLoadMore}},[a("i",{staticClass:"iconfont icon-angle-up"}),s._v("\n            加载更多\n        ")]):s._e(),s._v(" "),0<s.records.length&&!s.hasMore?a("span",{staticClass:"ub-text-muted"},[s._v("\n            没有更多消息了~\n        ")]):s._e()]),s._v(" "),s._l(s.records,function(e,t){return a("div",[e.talkType===s.ImTalkType.NOTICE.value?a("div",{staticClass:"msg-record"},[a("NoticeItem",{attrs:{record:e}})],1):a("div",{staticClass:"msg-record",class:e.position},[e.user.avatar?a("div",{staticClass:"msg-record-avatar"},[a("a",{style:{backgroundImage:"url("+e.user.avatar+")"},attrs:{href:"javascript:;"}})]):s._e(),s._v(" "),a("div",{staticClass:"msg-record-body"},[e.talkType===s.ImTalkType.TEXT.value?a("TextItem",{attrs:{record:e}}):e.talkType===s.ImTalkType.IMAGE.value?a("ImageItem",{attrs:{record:e}}):a("div",{staticClass:"text-item"},[a("p",[s._v("未知消息 Talk="+s._s(e.talkType))])])],1)])])})],2)};a._withStripped=!0;var i=s(18),r=function(){var s=this,e=s.$createElement,a=s._self._c||e;return s.record&&s.record.content&&s.record.content.text?a("div",{staticClass:"text-item"},s._l(s.record.content.text.split("\n"),function(e,t){return a("p",{domProps:{innerHTML:s._s(s.processText(e))}})}),0):s._e()};r._withStripped=!0;const n=s(319),o=s(323),l=s(324);var c={name:"TextItem",props:{record:{type:Object,default:()=>({})}},methods:{processText(e){let t=n(o(e));return t=t.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a target="_blank" href="$&">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a target="_blank" href="http://$2">$2</a>'),t=l.replaceText(t),t}}},d=s(3),u=Object(d.a)(c,r,[],!1,null,null,null);u.options.__file="ImServer/resources/asset/src/components/ChatMsg/Item/TextItem.vue";var v=u.exports,c=function(){var e=this.$createElement,e=this._self._c||e;return this.record&&this.record.content&&this.record.content.url?e("div",{staticClass:"image-item"},[e("a",{attrs:{target:"_blank",href:this.record.content.url}},[e("img",{attrs:{src:this.record.content.url}})])]):this._e()};c._withStripped=!0;r={name:"ImageItem",props:{record:{type:Object,default:()=>({})}}},u=Object(d.a)(r,c,[],!1,null,null,null);u.options.__file="ImServer/resources/asset/src/components/ChatMsg/Item/ImageItem.vue";r=u.exports,c=function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"msg-record-notice"},[e("div",{staticClass:"text"},[this._v(this._s(this.record.content.text))])])};c._withStripped=!0;u={name:"NoticeItem",props:{record:{type:Object,default:()=>({})}}},c=Object(d.a)(u,c,[],!1,null,null,null);c.options.__file="ImServer/resources/asset/src/components/ChatMsg/Item/NoticeItem.vue";r={name:"ChatMsgRecordsView",components:{NoticeItem:c.exports,ImageItem:r,TextItem:v},props:{hasMore:{type:Boolean,default:!0},records:{type:Array,default:()=>[]}},data:()=>({ImTalkType:i.f}),computed:{minId(){let t=-1;return this.records.forEach(e=>{t=-1===t?e.id:Math.min(e.id,t)}),t}},methods:{doLoadMore(){this.$emit("on-load-more",{minId:this.minId,maxId:-1})}}},v=s(7),v=s.n(v),s=s(303),v()(s.a,{insert:"head",singleton:!1}),s.a.locals,a=Object(d.a)(r,a,[],!1,null,null,null);a.options.__file="ImServer/resources/asset/src/components/ChatMsg/ChatMsgRecordsView.vue",t.a=a.exports},317:function(e,t,s){"use strict";var a=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"pb-text-editor"},[a("div",{staticClass:"tw-bg-white tw-rounded tw-border tw-border-solid tw-border-gray-100"},[a("div",{staticClass:"tw-flex tw-border-0 tw-border-b tw-border-solid tw-border-gray-100 tw-m-1"},[a("div",{staticClass:"tw-flex tw-items-center tw-justify-center"},[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click"},model:{value:s.emotionVisible,callback:function(e){s.emotionVisible=e},expression:"emotionVisible"}},[a("a",{staticClass:"tw-text-gray-400 tw-px-2",attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[a("i",{staticClass:"iconfont icon-smile",staticStyle:{"font-size":"0.8rem"}})]),s._v(" "),a("div",{staticStyle:{"max-width":"400px"}},s._l(s.emotions,function(e,t){return a("div",s._l(e.list,function(t,e){return a("div",{staticClass:"tw-rounded tw-cursor-pointer tw-inline-block tw-border-solid tw-border tw-border-white hover:tw-border-gray-200",on:{click:function(e){return s.doEmotionSelect(t)}}},[a("img",{staticClass:"tw-h-6 tw-w-6",attrs:{src:t.url}})])}),0)}),0)])],1),s._v(" "),a("div",{staticClass:"tw-flex tw-items-center tw-justify-center"},[a("el-upload",{ref:"imageUpload",attrs:{limit:1,"show-file-list":!1,data:{action:"uploadDirectRaw"},"on-success":s.onImageFinish,action:s.imageUploadUrl}},[a("a",{staticClass:"tw-text-gray-400 tw-px-2",attrs:{href:"javascript:;"}},[a("i",{staticClass:"iconfont icon-image",staticStyle:{"font-size":"0.8rem"}})])])],1)]),s._v(" "),a("div",{staticClass:"tw-p-1"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:s.text,expression:"text"}],staticClass:"tw-border tw-border-transparent tw-w-full tw-flex tw-items-center hover:tw-bg-transparent hover:tw-border-transparent",staticStyle:{resize:"none"},attrs:{rows:"3",placeholder:"输入消息发送"},domProps:{value:s.text},on:{keypress:s.onTextareaKeyPress,input:function(e){e.target.composing||(s.text=e.target.value)}}})]),s._v(" "),a("div",{staticClass:"tw-py-1 tw-border-0 tw-border-t tw-border-solid tw-border-gray-100"},[a("div",{staticClass:"ub-text-right tw-p-1"},[a("el-dropdown",{attrs:{"split-button":""},on:{command:s.onSendKeyChange,click:s.doTextSend}},["button"===s.sendKeyTypeValue?[s._v("发送")]:s._e(),s._v(" "),s._l(s.SendKeyType,function(e,t){return"button"!==s.sendKeyTypeValue&&e.value===s.sendKeyTypeValue?a("span",[s._v("\n                            "+s._s(e.name)+"发送\n                        ")]):s._e()}),s._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},s._l(s.SendKeyType,function(e,t){return a("el-dropdown-item",{key:t,attrs:{command:e.value}},[s._v("\n                            "+s._s(e.name)+"发送\n                        ")])}),1)],2)],1)])]),s._v(" "),a("el-dialog",{attrs:{visible:s.imageVisible,"append-to-body":"",width:"50%"},on:{"update:visible":function(e){s.imageVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"},[s._v("\n            发送图片\n        ")]),s._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){s.imageVisible=!1}}},[s._v("取消")]),s._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:s.doImageSend}},[s._v("发送")])],1),s._v(" "),a("div",[a("img",{staticClass:"tw-rounded tw-w-full",attrs:{src:s.imageUrl}})])])],1)};a._withStripped=!0;const i=s(318),r={base:[{key:"[微笑]",val:"01"},{key:"[撇嘴]",val:"02"},{key:"[色]",val:"03"},{key:"[发呆]",val:"04"},{key:"[得意]",val:"05"},{key:"[流泪]",val:"06"},{key:"[害羞]",val:"07"},{key:"[闭嘴]",val:"08"},{key:"[睡]",val:"09"},{key:"[大哭]",val:"10"},{key:"[尴尬]",val:"11"},{key:"[发怒]",val:"12"},{key:"[调皮]",val:"13"},{key:"[呲牙]",val:"14"},{key:"[惊讶]",val:"15"},{key:"[难过]",val:"16"},{key:"[酷]",val:"17"},{key:"[冷汗]",val:"18"},{key:"[抓狂]",val:"19"},{key:"[吐]",val:"20"},{key:"[偷笑]",val:"21"},{key:"[愉快]",val:"22"},{key:"[白眼]",val:"23"},{key:"[傲慢]",val:"24"},{key:"[饥饿]",val:"25"},{key:"[困]",val:"26"},{key:"[惊恐]",val:"27"},{key:"[流汗]",val:"28"},{key:"[憨笑]",val:"29"},{key:"[悠闲]",val:"30"},{key:"[奋斗]",val:"31"},{key:"[咒骂]",val:"32"},{key:"[疑问]",val:"33"},{key:"[嘘]",val:"34"},{key:"[晕]",val:"35"},{key:"[疯了]",val:"36"},{key:"[衰]",val:"37"},{key:"[骷髅]",val:"38"},{key:"[敲打]",val:"39"},{key:"[再见]",val:"40"},{key:"[擦汗]",val:"41"},{key:"[抠鼻]",val:"42"},{key:"[鼓掌]",val:"43"},{key:"[糗大了]",val:"44"},{key:"[坏笑]",val:"45"},{key:"[左哼哼]",val:"46"},{key:"[右哼哼]",val:"47"},{key:"[哈欠]",val:"48"},{key:"[鄙视]",val:"49"},{key:"[委屈]",val:"50"},{key:"[快哭了]",val:"51"},{key:"[阴险]",val:"52"},{key:"[亲亲]",val:"53"},{key:"[吓]",val:"54"},{key:"[可怜]",val:"55"},{key:"[菜刀]",val:"56"},{key:"[西瓜]",val:"57"},{key:"[啤酒]",val:"58"},{key:"[篮球]",val:"59"},{key:"[乒乓]",val:"60"},{key:"[咖啡]",val:"61"},{key:"[饭]",val:"62"},{key:"[猪头]",val:"63"},{key:"[玫瑰]",val:"64"},{key:"[凋谢]",val:"65"},{key:"[嘴唇]",val:"66"},{key:"[爱心]",val:"67"},{key:"[心碎]",val:"68"},{key:"[蛋糕]",val:"69"},{key:"[闪电]",val:"70"},{key:"[炸弹]",val:"71"},{key:"[刀]",val:"72"},{key:"[足球]",val:"73"},{key:"[瓢虫]",val:"74"},{key:"[便便]",val:"75"},{key:"[月亮]",val:"76"},{key:"[太阳]",val:"77"},{key:"[礼物]",val:"78"},{key:"[拥抱]",val:"79"},{key:"[强]",val:"80"},{key:"[弱]",val:"81"},{key:"[握手]",val:"82"},{key:"[胜利]",val:"83"},{key:"[抱拳]",val:"84"},{key:"[勾引]",val:"85"},{key:"[拳头]",val:"86"},{key:"[差劲]",val:"87"},{key:"[爱你]",val:"88"},{key:"[NO]",val:"89"},{key:"[OK]",val:"90"},{key:"[爱情]",val:"91"},{key:"[飞吻]",val:"92"},{key:"[跳跳]",val:"93"},{key:"[发抖]",val:"94"},{key:"[怄火]",val:"95"},{key:"[转圈]",val:"96"},{key:"[磕头]",val:"97"},{key:"[回头]",val:"98"},{key:"[跳绳]",val:"99"},{key:"[投降]",val:"100"},{key:"[激动]",val:"101"},{key:"[乱舞]",val:"102"},{key:"[献吻]",val:"103"},{key:"[左太极]",val:"104"},{key:"[右太极]",val:"105"}]},n={emotions:()=>{let e=[];for(const t in r)e.push({name:t,list:r[t].map(e=>(e.url=n.cdn()+"asset/image/emotion/"+e.val+"@2x.png",e))});return e},cdn:()=>window.__msCDN,text:e=>(e=(e="<p>"+(e=i.specialchars(e)).replace(/\n/g,"</p><p>")+"</p>").replace(/\[(.*?)\]/,function(e){for(var t=0;t<r.base.length;t++)if(r.base[t].key===e){r.base[t].key;const e=r.base[t].val;return'<img class="ub-emotion" src="'+n.cdn()+"asset/image/emotion/"+e+'@2x.png" />'}return e})).replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a target="_blank" href="$&">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a target="_blank" href="http://$2">$2</a>')};var o=s(72),l=s(73),l={name:"TextEditor",components:{UploadButton:o.a,ImageSelector:l.a},props:{imageUploadUrl:{type:String,default:"/api/member_data/file_manager/image"},sendKeyType:{type:String,default:"button"}},data:()=>({SendKeyType:[{value:"button",name:"按钮"},{value:"enter",name:"Enter"},{value:"ctrl_enter",name:"Ctrl+Enter"}],sendKeyTypeValue:"",emotions:n.emotions(),emotionVisible:!1,imageVisible:!1,imageUrl:"",text:""}),watch:{sendKeyType:{handler(e,t){this.sendKeyTypeValue=e},immediate:!0}},methods:{onImageFinish(e,t,s){this.$refs.imageUpload.clearFiles(),e.code?this.$dialog.tipError(e.msg):(this.imageUrl=e.data.fullPath,this.imageVisible=!0)},doImageSend(){this.imageVisible=!1,this.$emit("on-send","image",this.imageUrl)},doTextSend(){this.text?this.$emit("on-send","text",this.text):this.$dialog.tipError("请输入内容")},doClear(){this.text=""},doEmotionSelect(e){this.text+=e.key,this.emotionVisible=!1},onSendKeyChange(e){this.sendKeyTypeValue=e,this.$emit("on-send-key-type-change",e)},onTextareaKeyPress(e){switch(this.sendKeyTypeValue){case"button":break;case"enter":13===e.keyCode&&(this.doTextSend(),e.preventDefault());break;case"ctrl_enter":13===e.keyCode&&e.ctrlKey&&(this.doTextSend(),e.preventDefault())}}}},s=s(3),a=Object(s.a)(l,a,[],!1,null,null,null);a.options.__file="vendor/modstart/modstart/resources/asset/src/svue/components/TextEditor.vue",t.a=a.exports},318:function(e,t,s){!function(n){const i=s(80);var a={specialchars:function(e){var t=[];if(!e)return"";if(0==e.length)return"";for(var s=0;s<e.length;s++)switch(e.substr(s,1)){case"<":t.push("&lt;");break;case">":t.push("&gt;");break;case"&":t.push("&amp;");break;case" ":t.push("&nbsp;");break;case'"':t.push("&quot;");break;default:t.push(e.substr(s,1))}return t.join("")},text2html:function(e){return"<p>"+(e=a.specialchars(e)).replace(/\n/g,"</p><p>")+"</p>"},text2paragraph:function(e){return"<p>"+e.replace(/\n/g,"</p><p>")+"</p>"},urlencode:function(e){return e=(e+"").toString(),encodeURIComponent(e).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A").replace(/%20/g,"+")},randomString:function(e){e=e||16;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=t.length,a="",i=0;i<e;i++)a+=t.charAt(Math.floor(Math.random()*s));return a},getRootWindow:function(){for(var e=window;e.self!==e.parent;)e=e.parent;return e},fixPath:function(e,t){return t=t||"",e?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e:(0===e.indexOf("/")||(e="/"+e),(t=t&&t.lastIndexOf("/")==t.length-1?t.substr(0,t.length-1):t)+e):""},fixFullPath:function(e){var t=window.location.protocol+"//"+window.location.host+"/";return a.fixPath(e,t)},objectValue:function(e,t,s){return"string"==typeof t?a.objectValue(e,t.split("."),s):1==t.length&&void 0!==s?e[t[0]]=s:0==t.length?e:(/^\d+$/.test(t[0])&&(t[0]=parseInt(t[0])),a.objectValue(e[t[0]],t.slice(1),s))},fullscreen:{enter:function(e){var t=document.documentElement;t.requestFullscreen?(t.requestFullscreen(),setTimeout(function(){e&&e()},1e3)):t.mozRequestFullScreen?(t.mozRequestFullScreen(),setTimeout(function(){e&&e()},1e3)):t.webkitRequestFullScreen?(t.webkitRequestFullScreen(),setTimeout(function(){e&&e()},1e3)):elem.msRequestFullscreen&&(elem.msRequestFullscreen(),setTimeout(function(){e&&e()},1e3))},exit:function(e){document.exitFullscreen?(document.exitFullscreen(),setTimeout(function(){e&&e()},1e3)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),setTimeout(function(){e&&e()},1e3)):document.webkitCancelFullScreen?(document.webkitCancelFullScreen(),setTimeout(function(){e&&e()},1e3)):document.msExitFullscreen&&(document.msExitFullscreen(),setTimeout(function(){e&&e()},1e3))},isFullScreen:function(){return document.exitFullscreen?document.fullscreen:document.mozCancelFullScreen?document.mozFullScreen:document.webkitCancelFullScreen?document.webkitIsFullScreen:!!document.msExitFullscreen&&document.msFullscreenElement},trigger:function(e){a.fullscreen.isFullScreen()?a.fullscreen.exit(function(){e&&e("exit")}):a.fullscreen.enter(function(){e&&e("enter")})}},scrollTo:function(e,t){var s,a,i,r=n(e);r.length?(s=r.offset().top,t?(a=n(t),r.length?(i=a.offset().top,r=a.scrollTop(),a.stop().animate({scrollTop:r+s-i},200)):console.warn("Util.scroll container=( "+t+" ) not found")):n("html,body").stop().animate({scrollTop:s},200)):console.warn("Util.scroll target=( "+e+" ) not found")},setStyleContent:function(e,t){let s=document.getElementById(e);s||(s=document.createElement("style"),s.type="text/css",s.id=e,document.getElementsByTagName("head")[0].appendChild(s),s=document.getElementById(e)),s.innerHTML=t},loadScript:function(e,t){let s="s_"+i(e),a=document.getElementById(s);a?t&&t({isNew:!1}):(a=document.createElement("script"),a.id=s,a.src=e,a.onload=()=>{t&&t({isNew:!0})},document.getElementsByTagName("head")[0].appendChild(a))},loadStylesheet:function(e,t){let s="s_"+i(e),a=document.getElementById(s);a?t&&t({isNew:!1}):(a=document.createElement("link"),a.id=s,a.rel="stylesheet",a.type="text/css",a.href=e,a.onload=()=>{t&&t({isNew:!0})},document.getElementsByTagName("head")[0].appendChild(a))},md5:function(e){return i(e)},iframeMessage:{queue:[],serve:{},win:{recv:null,send:null},mount:function(e,t){MS.util.iframeMessage.win.recv!==e&&e.addEventListener("message",function(e){if(e.data&&e.data.group&&e.data.id){for(var t,s=0;s<MS.util.iframeMessage.queue.length;s++)if(MS.util.iframeMessage.queue[s].id===e.data.id)return MS.util.iframeMessage.queue[s].cb(e.data.data),void MS.util.iframeMessage.queue.splice(s,1);e.data.group,e.data,MS.util.iframeMessage.serve&&(t=e.data,MS.util.iframeMessage.serve[t.group](t.action,t.data,function(e){MS.util.iframeMessage.safeSend({id:t.id,group:t.group,data:e})}))}},!1),MS.util.iframeMessage.win.recv=e,MS.util.iframeMessage.win.send=t},safeSend(e){MS.util.iframeMessage.win.send?MS.util.iframeMessage.win.send.postMessage(e,"*"):setTimeout(function(){MS.util.iframeMessage.safeSend(e)},100)},server:function(e,t){MS.util.iframeMessage.serve[e]=t},rpc:function(e,t,s,a){a=a||null;s={id:window.MS.util.randomString(10),expire:(new Date).getTime()+6e4,group:e,action:t,data:s,cb:a};a&&MS.util.iframeMessage.queue.push(s),MS.util.iframeMessage.win.send.postMessage(JSON.parse(JSON.stringify(s)),"*")}}},t=-1;a.getNextMaxZIndex=function(){return-1===t&&n("*").each(function(){var e=parseInt(n(this).css("z-index"));0<e&&t<e&&(t=e)}),++t},e.exports=a}.call(this,s(22))},324:function(e,t){const a={records:[{key:"[微笑]",val:"01"},{key:"[撇嘴]",val:"02"},{key:"[色]",val:"03"},{key:"[发呆]",val:"04"},{key:"[得意]",val:"05"},{key:"[流泪]",val:"06"},{key:"[害羞]",val:"07"},{key:"[闭嘴]",val:"08"},{key:"[睡]",val:"09"},{key:"[大哭]",val:"10"},{key:"[尴尬]",val:"11"},{key:"[发怒]",val:"12"},{key:"[调皮]",val:"13"},{key:"[呲牙]",val:"14"},{key:"[惊讶]",val:"15"},{key:"[难过]",val:"16"},{key:"[酷]",val:"17"},{key:"[冷汗]",val:"18"},{key:"[抓狂]",val:"19"},{key:"[吐]",val:"20"},{key:"[偷笑]",val:"21"},{key:"[愉快]",val:"22"},{key:"[白眼]",val:"23"},{key:"[傲慢]",val:"24"},{key:"[饥饿]",val:"25"},{key:"[困]",val:"26"},{key:"[惊恐]",val:"27"},{key:"[流汗]",val:"28"},{key:"[憨笑]",val:"29"},{key:"[悠闲]",val:"30"},{key:"[奋斗]",val:"31"},{key:"[咒骂]",val:"32"},{key:"[疑问]",val:"33"},{key:"[嘘]",val:"34"},{key:"[晕]",val:"35"},{key:"[疯了]",val:"36"},{key:"[衰]",val:"37"},{key:"[骷髅]",val:"38"},{key:"[敲打]",val:"39"},{key:"[再见]",val:"40"},{key:"[擦汗]",val:"41"},{key:"[抠鼻]",val:"42"},{key:"[鼓掌]",val:"43"},{key:"[糗大了]",val:"44"},{key:"[坏笑]",val:"45"},{key:"[左哼哼]",val:"46"},{key:"[右哼哼]",val:"47"},{key:"[哈欠]",val:"48"},{key:"[鄙视]",val:"49"},{key:"[委屈]",val:"50"},{key:"[快哭了]",val:"51"},{key:"[阴险]",val:"52"},{key:"[亲亲]",val:"53"},{key:"[吓]",val:"54"},{key:"[可怜]",val:"55"},{key:"[菜刀]",val:"56"},{key:"[西瓜]",val:"57"},{key:"[啤酒]",val:"58"},{key:"[篮球]",val:"59"},{key:"[乒乓]",val:"60"},{key:"[咖啡]",val:"61"},{key:"[饭]",val:"62"},{key:"[猪头]",val:"63"},{key:"[玫瑰]",val:"64"},{key:"[凋谢]",val:"65"},{key:"[嘴唇]",val:"66"},{key:"[爱心]",val:"67"},{key:"[心碎]",val:"68"},{key:"[蛋糕]",val:"69"},{key:"[闪电]",val:"70"},{key:"[炸弹]",val:"71"},{key:"[刀]",val:"72"},{key:"[足球]",val:"73"},{key:"[瓢虫]",val:"74"},{key:"[便便]",val:"75"},{key:"[月亮]",val:"76"},{key:"[太阳]",val:"77"},{key:"[礼物]",val:"78"},{key:"[拥抱]",val:"79"},{key:"[强]",val:"80"},{key:"[弱]",val:"81"},{key:"[握手]",val:"82"},{key:"[胜利]",val:"83"},{key:"[抱拳]",val:"84"},{key:"[勾引]",val:"85"},{key:"[拳头]",val:"86"},{key:"[差劲]",val:"87"},{key:"[爱你]",val:"88"},{key:"[NO]",val:"89"},{key:"[OK]",val:"90"},{key:"[爱情]",val:"91"},{key:"[飞吻]",val:"92"},{key:"[跳跳]",val:"93"},{key:"[发抖]",val:"94"},{key:"[怄火]",val:"95"},{key:"[转圈]",val:"96"},{key:"[磕头]",val:"97"},{key:"[回头]",val:"98"},{key:"[跳绳]",val:"99"},{key:"[投降]",val:"100"},{key:"[激动]",val:"101"},{key:"[乱舞]",val:"102"},{key:"[献吻]",val:"103"},{key:"[左太极]",val:"104"},{key:"[右太极]",val:"105"}],replaceText:function(e){for(var t=0;t<a.records.length;t++){var s='<img src="'+window.__msCDN+"asset/image/emotion/"+a.records[t].val+'@2x.png" height="20" style="vertical-align:middle;" />';e=e.replaceAll(a.records[t].key,s)}return e}};e.exports=a},350:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"pb-staff-workbench tw-flex tw-flex-col ub-bg-primary",staticStyle:{height:"100vh"}},[t("Header",{attrs:{chat:e.chat}}),e._v(" "),t("div",{staticClass:"tw-flex-grow tw-bg-white tw-flex",staticStyle:{height:"calc(100vh - 64px)"}},[t("Conversation",{attrs:{chat:e.chat},on:{"on-service-change":e.onServiceChange}}),e._v(" "),t("ChatArea",{ref:"chatArea",attrs:{chat:e.chat}}),e._v(" "),t("ChatPanel",{ref:"chatPanel",attrs:{chat:e.chat}})],1),e._v(" "),e.$store.state.staff.setting.connectionStatus===e.ImServerConstant.ConnectStatus.Disconnected?t("div",{staticStyle:{background:"rgba(0,0,0,0.5)",color:"#FFF",position:"fixed",top:"0",left:"0",right:"0",bottom:"0","text-align":"center","padding-top":"5rem"}},[e._v("\n        连接已断开，请刷新重试\n    ")]):e._e(),e._v(" "),t("PageNotice",{ref:"pageNotice",attrs:{sound:e.$url.cdn("vendor/LiveChat/res/audio/new_message.mp3")}})],1)},i=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"tw-flex tw-p-4"},[e("div",{staticClass:"tw-flex",staticStyle:{height:"30px"}},[e("div",{staticClass:"tw-mr-2",staticStyle:{"line-height":"30px","vertical-align":"middle"}},[e("el-avatar",{staticClass:"tw-cursor-pointer",attrs:{size:"small",src:t.$store.state.staff.user.avatar}})],1),t._v(" "),e("div",{staticClass:"tw-text-white tw-mr-2 tw-cursor-pointer",staticStyle:{"line-height":"30px","vertical-align":"middle"}},[t._v("\n            "+t._s(t.$store.state.staff.user.nickname)+"\n        ")]),t._v(" "),e("div",{staticClass:"tw-text-white tw-cursor-pointer tw-mr-2",staticStyle:{"line-height":"30px","vertical-align":"middle"}},[e("el-dropdown",[e("div",{staticClass:"el-dropdown-link tw-text-white"},[t.$store.state.staff.user.chatStatus===t.AccountChatStatus.Online?e("span",[e("i",{staticClass:"iconfont icon-dot ub-text-success"}),t._v("\n                        在线\n                    ")]):t._e(),t._v(" "),t.$store.state.staff.user.chatStatus===t.AccountChatStatus.Offline?e("span",[e("i",{staticClass:"iconfont icon-dot ub-text-muted"}),t._v("\n                        离线\n                    ")]):t._e(),t._v(" "),e("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t._v(" "),e("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e("el-dropdown-item",{nativeOn:{click:function(e){return t.doChangeChatStatus(t.AccountChatStatus.Online)}}},[e("i",{staticClass:"iconfont icon-dot ub-text-success"}),t._v("\n                        在线\n                    ")]),t._v(" "),e("el-dropdown-item",{nativeOn:{click:function(e){return t.doChangeChatStatus(t.AccountChatStatus.Offline)}}},[e("i",{staticClass:"iconfont icon-dot ub-text-muted"}),t._v("\n                        下线\n                    ")])],1)],1)],1)]),t._v(" "),e("div",{staticClass:"tw-flex-grow tw-text-right"},[e("el-button",{on:{click:t.doLogout}},[t._v("\n            退出登录\n        ")])],1)])};i._withStripped=a._withStripped=!0;var r=s(20),n=s(144),o=s(148),l=s(18),c=s(143);s(22);const d=function(e,s){this.imServer=new o.a,this.onNewMessage=e=>{this.imServer.addCustomListener("NewMessage",e)},this.imServer.addTalkListener(e=>{e.chatType===l.a.SERVICE.value&&(e.toId===s.$store.state.staff.chat.service.id&&(this.imServer.doUnreadClear(l.a.SERVICE.value,e.toId),s.$store.commit("STAFF_APPEND_CHAT_MESSAGE_RECORD",e),c.a.scrollChatMessagesToBottom()),e.userId!==s.$store.state.staff.setting.imUserId&&this.imServer.callCustomListener("NewMessage",e))}),this.imServer.onPush(l.c.UnreadUpdate,e=>{e.chatType===l.a.SERVICE.value&&s.$store.commit("STAFF_SERVICE_UNREAD_UPDATE",e)}),this.imServer.onPush(l.c.ServiceUpdate,e=>{s.$store.commit("STAFF_SERVICE_UPDATE",e)}),this.imServer.onPush(l.c.ServiceQueueList,e=>{s.$store.commit("STAFF_SET_SERVICE_QUEUE",e)}),this.imServer.onPush(l.c.ServiceProcessingList,e=>{s.$store.commit("STAFF_SET_SERVICE_PROCESSING",e)}),this.imServer.onPush(l.c.ServiceProcessedList,e=>{s.$store.commit("STAFF_SET_SERVICE_PROCESSED",e)}),this.imServer.onConnectChange(e=>{s.$store.commit("STAFF_SET_SETTING",{connectionStatus:e})}),this.doServiceProcessing=e=>{this.imServer.request(l.d.ServiceProcessingRequest,{serviceId:e})},this.doServiceQueueList=e=>{this.imServer.request(l.d.ServiceQueueList,{page:s.$store.state.staff.queue.page,pageSize:s.$store.state.staff.queue.pageSize})},this.doServiceProcessingList=e=>{this.imServer.request(l.d.ServiceProcessingList,{page:s.$store.state.staff.processing.page,pageSize:s.$store.state.staff.processing.pageSize})},this.doServiceProcessedList=e=>{this.imServer.request(l.d.ServiceProcessedList,{page:s.$store.state.staff.processed.page,pageSize:s.$store.state.staff.processed.pageSize})},this.doSyncChatStatus=()=>{this.imServer.request("AccountChatStatusSet",{chatStatus:s.$store.state.staff.user.chatStatus})},this.sendTalk=(e,t)=>{this.imServer.sendTalk({toId:s.$store.state.staff.chat.service.id,...e},t)},this.init=()=>{s.$api.post("init",{},e=>{s.$store.commit("STAFF_SET_SETTING",e.data),this.imServer.connect({token:e.data.token,onSuccess:()=>{this.doServiceQueueList(),this.doServiceProcessingList(),this.doServiceProcessedList()},onTick:()=>{this.doSyncChatStatus()},onError:e=>{s.$dialog.tipError(e)}})})}};var u={name:"Header",props:{chat:{type:d,default:()=>null}},data:()=>({AccountChatStatus:n.a}),methods:{doChangeChatStatus(e){this.$store.commit("STAFF_SET_USER",{chatStatus:e}),this.chat.doSyncChatStatus()},doLogout(){this.$dialog.confirm("确定退出？",()=>{this.$dialog.loadingOn(),this.$api.post("logout",{},e=>{this.$dialog.loadingOff(),r.a.$emit("UpdateApp",()=>{window.location.reload()})},e=>{this.$dialog.loadingOff()})})}}},v=s(3),h=Object(v.a)(u,i,[],!1,null,"72fbb5c3",null);h.options.__file="src/pages/Staff/Components/Header.vue";var m=h.exports,p=function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("div",{staticClass:"tw-flex tw-flex-col",staticStyle:{width:"300px","border-right":"1px solid #EEE",height:"100%"}},[s._e(),s._v(" "),0<s.$store.state.staff.queue.records.length?a("div",{staticClass:"tw-p-2 tw-flex-shrink-0",staticStyle:{"max-height":"150px",overflow:"auto"}},s._l(s.$store.state.staff.queue.records,function(t,e){return a("div",{key:e,staticClass:"tw-p-2 tw-shadow-lg tw-bg-yellow-50 tw-rounded-lg tw-flex tw-justify-between tw-items-center tw-mb-2"},[a("div",{staticClass:"tw-flex"},[a("div",{staticClass:"tw-mr-4"},[a("div",{staticClass:"ub-cover-1-1 tw-shadow tw-w-4 tw-h-4 tw-rounded-full",style:{"background-image":"url("+t._creatorUser.avatar+")"}})]),s._v(" "),a("div",[a("div",{staticClass:"tw-font-bold tw-text-gray-700"},[s._v(s._s(t._creatorUser.nickname))])])]),s._v(" "),a("a",{staticClass:"btn btn-primary-line btn-round",attrs:{href:"javascript:;"},on:{click:function(e){return s.chat.doServiceProcessing(t.id)}}},[s._v("\n                接待\n            ")])])}),0):s._e(),s._v(" "),a("div",{staticClass:"ub-nav-tab tw-w-full tw-flex"},[a("a",{staticClass:"tw-flex-grow tw-text-center",class:{active:"processing"===s.type},attrs:{href:"javascript:;"},on:{click:function(e){s.type="processing"}}},[s._v("会话中")]),s._v(" "),a("a",{staticClass:"tw-flex-grow tw-text-center",class:{active:"processed"===s.type},attrs:{href:"javascript:;"},on:{click:function(e){s.type="processed"}}},[s._v("已完成")])]),s._v(" "),a("div",{staticClass:"tw-flex-grow tw-overflow-auto"},[0===s.records.length?a("div",[s._m(0)]):s._e(),s._v(" "),s._l(s.records,function(t,e){return a("div",[a("div",{staticClass:"tw-flex tw-flex-col"},[a("div",{staticClass:"tw-relative tw-flex tw-flex-row tw-items-center tw-p-4 tw-cursor-pointer hover:tw-bg-gray-200",class:{"tw-bg-gray-200":s.currentServiceId===t.id},on:{click:function(e){return s.doChangeService(t.id)}}},[a("div",{staticClass:"tw-absolute tw-text-xs tw-text-gray-500 tw-right-0 tw-top-0 tw-mr-4 tw-mt-3"},[a("TimeAgo",{attrs:{datetime:t.updateTime,autoUpdate:!0}})],1),s._v(" "),a("div",{staticClass:"tw-flex tw-items-center tw-justify-center tw-h-10 tw-w-10 tw-rounded-full tw-flex-shrink-0 ub-cover-1-1",style:{backgroundImage:"url("+t._creatorUser.avatar+")"}}),s._v(" "),a("div",{staticClass:"tw-flex tw-flex-col tw-flex-grow tw-ml-3"},[a("div",{staticClass:"tw-text-sm tw-font-medium"},[s._v(s._s(t._creatorUser.nickname))]),s._v(" "),a("div",{staticClass:"tw-text-xs tw-truncate tw-w-40"},[s._v(s._s(t.lastTalkText||"[无任何消息]"))])]),s._v(" "),a("div",{staticClass:"tw-flex-shrink-0 tw-ml-2 tw-self-end tw-mb-1"},[0<t._unreadTalkCount?a("span",{staticClass:"tw-flex tw-items-center tw-justify-center tw-h-5 tw-w-5 tw-bg-red-500 tw-text-white tw-text-xs tw-rounded-full"},[s._v(s._s(t._unreadTalkCount))]):s._e()])])])])})],2)])};p._withStripped=!0;u={name:"Conversation",props:{chat:{type:d,default:()=>null}},computed:{records(){return("processing"===this.type?this.$store.state.staff.processing:this.$store.state.staff.processed).records}},data:()=>({type:"processing",currentServiceId:null}),methods:{doChangeService(e){this.currentServiceId=e,this.$emit("on-service-change",e)}}},i=Object(v.a)(u,p,[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"ub-empty tw-my-20"},[e("div",{staticClass:"icon"},[e("div",{staticClass:"iconfont icon-empty-box"})]),this._v(" "),e("div",{staticClass:"text"},[this._v("暂无记录")])])}],!1,null,"53a67639",null);i.options.__file="src/pages/Staff/Components/Conversation.vue";h=i.exports,u=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"tw-flex-grow tw-h-full tw-overflow-hidden"},[0<e.$store.state.staff.chat.service.id?t("div",{staticClass:"tw-flex tw-flex-col tw-h-full"},[t("div",{staticClass:"tw-flex tw-p-4 tw-bg-white tw-shadow"},[t("div",{staticClass:"tw-flex",staticStyle:{height:"30px"}},[t("div",{staticClass:"tw-mr-2",staticStyle:{"line-height":"30px","vertical-align":"middle"}},[t("el-avatar",{staticClass:"tw-cursor-pointer",attrs:{size:"small",src:e.$store.state.staff.chat.creatorUser.avatar}})],1),e._v(" "),t("div",{staticClass:"tw-mr-2 tw-cursor-pointer",staticStyle:{"line-height":"30px","vertical-align":"middle"}},[e._v("\n                    "+e._s(e.$store.state.staff.chat.creatorUser.nickname)+"\n                ")])])]),e._v(" "),t("div",{staticClass:"tw-flex-grow tw-overflow-y-auto",attrs:{id:"ChatMessages"}},[t("ChatMsgRecordsView",{attrs:{records:e.$store.state.staff.chat.records,"has-more":e.$store.state.staff.chat.hasMore},on:{"on-load-more":e.onLoadMoreHistory}})],1),e._v(" "),t("div",{staticClass:"tw-items-center tw-border-solid tw-border-gray-200 tw-border-0 tw-border-t"},[t("TextEditor",{ref:"textEditor",attrs:{"image-upload-url":e.$url.api("live_chat/staff/upload/image"),"send-key-type":e.$store.state.chat.setting.msgSendKey},on:{"on-send":e.onMsgSend,"on-send-key-type-change":e.onSendKeyTypeChange}})],1)]):t("div",{staticClass:"tw-flex tw-flex-col tw-h-full tw-justify-center"},[e._m(0)])])};u._withStripped=!0;var f=s(315),p=s(317),i=s(316),p={name:"ChatArea",components:{TextEditor:p.a,ChatMsgRecordsView:i.a},props:{chat:{type:d,default:()=>null}},data:()=>({serviceId:0,scrollToBottomTimer:null}),methods:{doLoad(t){this.$dialog.loadingOn(),this.chat.imServer.apiRequest("service/get",{serviceId:t},e=>{this.serviceId=t,this.$store.commit("STAFF_SET_CHAT",Object.assign(e.data,{records:[],minId:-1,maxId:-1})),0<e.data.service._unreadTalkCount&&this.chat.imServer.doUnreadClear(l.a.SERVICE.value,t),this.chat.imServer.apiRequest("service/history",{serviceId:t},e=>{this.$dialog.loadingOff(),this.$store.commit("STAFF_SET_CHAT",{hasMore:0<e.data.records.length,...e.data}),c.a.scrollChatMessagesToBottom(0)},e=>{this.$dialog.loadingOff()})},e=>{this.$dialog.loadingOff()})},onMsgSend(e,t){this.chat.sendTalk(f.a.toChatMsgTalk(e,t),()=>{this.$refs.textEditor.doClear(),c.a.scrollChatMessagesToBottom()})},onSendKeyTypeChange(e){this.$store.commit("CHAT_SET_SETTING",{msgSendKey:e})},onLoadMoreHistory(e){this.$dialog.loadingOn(),this.chat.imServer.apiRequest("service/history",{serviceId:this.serviceId,...e},e=>{this.$dialog.loadingOff(),this.$store.commit("STAFF_PREPEND_CHAT_HISTORY",{records:e.data.records,hasMore:0<e.data.records.length})},e=>{this.$dialog.loadingOff()})}}},i=Object(v.a)(p,u,[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"ub-empty"},[e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont icon-empty-box"})]),this._v(" "),e("div",{staticClass:"text"},[this._v("\n                选择左侧客户开始接待\n            ")])])}],!1,null,null,null);i.options.__file="src/pages/Staff/Components/ChatArea.vue";p=i.exports,u=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticStyle:{width:"300px","border-left":"1px solid #EEE"}},[t.user.id<=0?e("div",{staticClass:"tw-flex tw-flex-col tw-h-full tw-justify-center"},[t._m(0)]):e("div",{staticClass:"ub-panel"},[e("div",{staticClass:"head"},[e("div",{staticClass:"more"},[e("a",{attrs:{href:"javascript:;"},on:{click:t.doServiceTransfer}},[e("i",{staticClass:"iconfont icon-direction-right"}),t._v("\n                    转接\n                ")]),t._v(" "),e("a",{staticClass:"ub-text-danger",attrs:{href:"javascript:;"},on:{click:t.doServiceProcessed}},[e("i",{staticClass:"iconfont icon-check"}),t._v("\n                    完成\n                ")])]),t._v(" "),e("div",{staticClass:"title"},[t._v("客户资料")])]),t._v(" "),e("div",{staticClass:"body"},[e("div",{staticClass:"ub-form vertical"},[e("div",{staticClass:"line"},[e("div",{staticClass:"label"},[t._v("信息")]),t._v(" "),e("div",{staticClass:"field"},[e("table",{staticClass:"ub-table mini border"},[e("tr",[e("td",[t._v("称呼")]),t._v(" "),e("td",[e("el-input",{on:{change:t.onNameChange},model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1)]),t._v(" "),e("tr",[e("td",[t._v("备注")]),t._v(" "),e("td",[e("el-input",{attrs:{type:"textarea"},on:{change:t.onRemarkChange},model:{value:t.user.remark,callback:function(e){t.$set(t.user,"remark",e)},expression:"user.remark"}})],1)])])])]),t._v(" "),e("div",{staticClass:"line"},[e("div",{staticClass:"label"},[t._v("来源")]),t._v(" "),e("div",{staticClass:"field"},[e("table",{staticClass:"ub-table mini border"},[e("tr",[e("td",{attrs:{width:"40"}},[t._v("渠道")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(t.user.channelTitle||"-")+"\n                                ")])]),t._v(" "),e("tr",[e("td",[t._v("IP")]),t._v(" "),e("td",[t._v("\n                                    "+t._s(t.user.ip)+"\n                                ")])])])])])])])]),t._v(" "),e("ServiceTransferDialog",{ref:"serviceTransferDialog",attrs:{chat:t.chat}})],1)};u._withStripped=!0;var g=s(6),i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-dialog",{attrs:{visible:t.visible,"append-to-body":""},on:{"update:visible":function(e){t.visible=e}}},[s("div",{attrs:{slot:"title"},slot:"title"},[t._v("\n        转接\n    ")]),t._v(" "),s("div",[s("div",{staticClass:"ub-form"},[s("div",{staticClass:"line"},[s("div",{staticClass:"label"},[t._v("客服")]),t._v(" "),s("div",{staticClass:"field"},[s("el-select",{model:{value:t.data.accountId,callback:function(e){t.$set(t.data,"accountId",e)},expression:"data.accountId"}},[s("el-option",{attrs:{value:0,label:"请选择"}}),t._v(" "),t._l(t.records,function(e,t){return s("el-option",{key:e.id,attrs:{label:e.nickname,value:e.id}})})],2)],1)]),t._v(" "),s("div",{staticClass:"line"},[s("div",{staticClass:"label"},[t._v(" ")]),t._v(" "),s("div",{staticClass:"field"},[s("el-button",{on:{click:t.doSubmit}},[t._v("确定转接")])],1)])])])])};i._withStripped=!0;s={name:"ServiceTransferDialog",props:{chat:{type:d,default:()=>null}},data:()=>({visible:!1,loading:!1,records:[],data:{accountId:0,serviceId:0}}),methods:{show(e){this.visible=!0,this.data.serviceId=e,this.$api.post("account/all",{},e=>{this.records=e.data.records})},doSubmit(){this.loading=!0,this.$api.post("service/transfer",this.data,e=>{this.loading=!1,this.chat.doServiceProcessingList(),this.chat.doServiceProcessedList(),this.$dialog.tipSuccess("操作成功"),this.visible=!1},e=>{this.loading=!1})}}},s=Object(v.a)(s,i,[],!1,null,"a2fc723c",null);s.options.__file="src/pages/Staff/Components/ServiceTransferDialog.vue";i=s.exports;const y={id:0,channelTitle:"",nickname:"",ip:"",name:"",remark:""};s={name:"ChatPanel",components:{ServiceTransferDialog:i},props:{chat:{type:d,default:()=>null}},data:()=>({serviceId:null,user:g.a.clone(y)}),methods:{doLoad(e){this.serviceId=e,this.user=g.a.clone(y),this.$api.post("service/user/get",{serviceId:e},e=>{g.a.assign(this.user,e.data.user)})},onNameChange(e){this.$api.post("service/user/save",{serviceId:this.serviceId,name:e},e=>{this.doLoad(this.serviceId)})},onRemarkChange(e){this.$api.post("service/user/save",{serviceId:this.serviceId,remark:e},e=>{this.doLoad(this.serviceId)})},doServiceProcessed(){this.$dialog.confirm("确定客户服务结单？",()=>{this.chat.imServer.apiRequest("service/processed",{serviceId:this.serviceId},e=>{this.chat.doServiceProcessingList(),this.chat.doServiceProcessedList(),this.$dialog.tipSuccess("操作成功")})})},doServiceTransfer(){this.$refs.serviceTransferDialog.show(this.serviceId)}}},i=Object(v.a)(s,u,[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"ub-empty"},[e("div",{staticClass:"icon"},[e("i",{staticClass:"iconfont icon-empty-box"})]),this._v(" "),e("div",{staticClass:"text"},[this._v("\n                选择左侧客户开始接待\n            ")])])}],!1,null,null,null);i.options.__file="src/pages/Staff/Components/ChatPanel.vue";s=i.exports,u=function(){var e=this.$createElement,e=this._self._c||e;return e("div",[e("audio",{ref:"audio",attrs:{src:this.sound}})])};u._withStripped=!0;i={name:"PageNotice",props:{sound:{type:String,default:""}},data:()=>({tipTimer:null,tipTimerCount:0,titleOld:null}),methods:{tip(e,t){this.doPageTitle(e,t),this.sound&&this.doPlaySound()},doClearTimer(){clearInterval(this.tipTimer),this.tipTimer=null,this.titleOld&&(window.document.title=this.titleOld),this.tipTimerCount=0},doPageTitle(e,t){t=t||"提醒",this.tipTimer&&this.doClearTimer(),this.titleOld=document.title,this.tipTimerCount=0,this.tipTimer=setInterval(()=>{this.tipTimerCount++,this.tipTimerCount%2==0?window.document.title="【"+t+"】"+e:window.document.title=""+e,6<this.tipTimerCount&&this.doClearTimer()},500)},doPlaySound(){let e=this.$refs.audio;if(e)try{e.pause(),e.play()}catch(e){}}}},u=Object(v.a)(i,u,[],!1,null,null,null);u.options.__file="vendor/modstart/modstart/resources/asset/src/svue/components/PageNotice.vue";u={name:"Index",components:{ChatPanel:s,ChatArea:p,Conversation:h,Header:m,PageNotice:u.exports},data:()=>({ImServerConstant:o.b,chat:null}),watch:{queueRecords(e){0<e.length&&this.$refs.pageNotice.tip("有新客户需要接待")}},computed:{queueRecords(){return this.$store.state.staff.queue.records.length}},mounted(){this.chat=new d(0,this),this.chat.onNewMessage(e=>{this.$refs.pageNotice.tip("有新消息需要回复","新消息")}),this.chat.init()},methods:{onServiceChange(e){this.$refs.chatArea.doLoad(e),this.$refs.chatPanel.doLoad(e)}}},a=Object(v.a)(u,a,[],!1,null,null,null);a.options.__file="src/pages/Staff/Index.vue",t.default=a.exports}}]);