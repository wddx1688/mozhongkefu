<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Log; use Illuminate\Support\Facades\Log; use ModStart\Core\Util\SerializeUtil; class Logger { private static function rotateLogPath($Jx_2I, $fK7yR, $mxDPB) { $zvKkI = date('Ymd'); return rtrim($mxDPB, '/') . '/' . $Jx_2I . ($fK7yR ? '_' . $fK7yR : '') . '_' . $zvKkI . '.log'; } private static function rotateLogPattern($Jx_2I, $fK7yR, $mxDPB) { return rtrim($mxDPB, '/') . '/' . $Jx_2I . ($fK7yR ? '_' . $fK7yR : '') . '_[0-9][0-9][0-9][0-9]*.log'; } private static function rotateLogClean($Jx_2I, $fK7yR, $NkgAY, $mxDPB) { goto BeSGa; i8Rml: foreach (array_slice($DBe0H, $NkgAY) as $n8fWJ) { Log::info('Vendor.LoggerClean - ' . $n8fWJ); @unlink($n8fWJ); } goto Cf8sQ; mcmep: if (empty($DBe0H)) { return; } goto bEw52; lFEaB: $DBe0H = glob($CzXk4); goto mcmep; BeSGa: $CzXk4 = self::rotateLogPattern($Jx_2I, $fK7yR, $mxDPB); goto lFEaB; bEw52: usort($DBe0H, function ($EnX8D, $ioTcP) { return strcmp($ioTcP, $EnX8D); }); goto i8Rml; Cf8sQ: } public static function rotateLog($Jx_2I, $fK7yR = null, $NkgAY = 7, $mxDPB = null) { goto jmnIY; jmnIY: if (null === $mxDPB) { $mxDPB = storage_path('logs'); } goto JwxVH; JwxVH: $eGUxe = self::rotateLogPath($Jx_2I, $fK7yR, $mxDPB); goto RNLWJ; RNLWJ: if (!file_exists($eGUxe)) { self::rotateLogClean($Jx_2I, $fK7yR, $NkgAY, $mxDPB); } goto lSUqF; lSUqF: return $eGUxe; goto qkQrZ; qkQrZ: } private static function write($n8fWJ, $mhShF, $qXO8j, $miOiF) { goto loKwQ; bP8Om: $z1qLT = '[' . sprintf('%05d', getmypid()) . '] ' . date('Y-m-d H:i:s') . " - {$qXO8j}" . ($miOiF ? " - {$miOiF}" : ''); goto hSMtM; S9xeq: @file_put_contents($b4r15, $z1qLT . '
', FILE_APPEND); goto csfXE; csfXE: return $z1qLT; goto OH3us; hSMtM: $b4r15 = self::rotateLog($n8fWJ, $mhShF); goto S9xeq; loKwQ: if (!is_string($miOiF)) { $miOiF = SerializeUtil::jsonEncode($miOiF); } goto bP8Om; OH3us: } public static function info($n8fWJ, $qXO8j, $miOiF = '') { return self::write($n8fWJ, 'info', $qXO8j, $miOiF); } public static function error($n8fWJ, $qXO8j, $miOiF = '') { return self::write($n8fWJ, 'error', $qXO8j, $miOiF); } }