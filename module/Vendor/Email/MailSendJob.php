<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Email; use Illuminate\Support\Facades\View; use ModStart\Core\Exception\BizException; use ModStart\Core\Job\BaseJob; use Module\Vendor\Log\Logger; use Module\Vendor\Provider\MailSender\AbstractMailSenderProvider; use Module\Vendor\Provider\MailSender\MailSenderProvider; class MailSendJob extends BaseJob { public $email; public $subject; public $template; public $templateData = array(); public $emailUserName = null; public $option = array(); public $module; public $html; public $type; private static function checkConfig() { $yHanX = app()->config->get('EmailSenderProvider'); BizException::throwsIfEmpty('邮箱发送未设置', $yHanX); } public static function createHtml($PcW1B, $UeeeP, $ZpNyF, $IinAz = null, $cD48i = array(), $nysIy = 0) { goto HgOdi; ejLn0: $Q10Sr->type = 'html'; goto Xsk5l; ptR0I: $Q10Sr->subject = $UeeeP; goto ddT0_; OBkjz: app('Illuminate\\Contracts\\Bus\\Dispatcher')->dispatch($Q10Sr); goto ozGgV; e_JHv: $Q10Sr->option = $cD48i; goto TiO0R; Xsk5l: $Q10Sr->email = $PcW1B; goto ptR0I; NAL3i: $Q10Sr->emailUserName = $IinAz; goto e_JHv; U2rSg: $Q10Sr = new static(); goto ejLn0; HgOdi: self::checkConfig(); goto U2rSg; TiO0R: if ($nysIy > 0) { $Q10Sr->delay($nysIy); } goto OBkjz; ddT0_: $Q10Sr->html = $ZpNyF; goto NAL3i; ozGgV: } public static function createModule($NS22k, $mPYOc, $PcW1B, $UeeeP, $NALde = array(), $IinAz = null, $cD48i = array(), $nysIy = 0) { self::create($PcW1B, $UeeeP, $mPYOc, $NALde, $IinAz, $cD48i, $nysIy, $NS22k); } public static function create($PcW1B, $UeeeP, $mPYOc, $NALde = array(), $IinAz = null, $cD48i = array(), $nysIy = 0, $NS22k = null) { goto NSwNL; NSwNL: self::checkConfig(); goto Z1U33; QQqk_: $Q10Sr->module = $NS22k; goto iRB0u; iRB0u: if ($nysIy > 0) { $Q10Sr->delay($nysIy); } goto UZmXY; PtbBx: $Q10Sr->template = $mPYOc; goto GRQuO; GRQuO: $Q10Sr->templateData = $NALde; goto xS3pj; I80Dy: $Q10Sr->email = $PcW1B; goto hrnB1; hrnB1: $Q10Sr->subject = $UeeeP; goto PtbBx; Z1U33: $Q10Sr = new static(); goto I80Dy; UZmXY: app('Illuminate\\Contracts\\Bus\\Dispatcher')->dispatch($Q10Sr); goto tJYY8; xS3pj: $Q10Sr->emailUserName = $IinAz; goto kxL_x; kxL_x: $Q10Sr->option = $cD48i; goto QQqk_; tJYY8: } public function handle() { goto MEzpo; aoe0k: Logger::info('Email', 'Start', $this->email . ' - ' . $this->subject . ' - ' . $this->template); goto gZ81Z; pIdhG: BizException::throwsIfEmpty('MailSendJob.HtmlEmpty', $ZpNyF); goto S0460; S0460: $FZUh3 = $X0c2E->send($this->email, $this->emailUserName, $this->subject, $ZpNyF); goto hW06K; hW06K: BizException::throwsIfResponseError($FZUh3); goto Tomls; gZ81Z: switch ($this->type) { case 'html': $ZpNyF = $this->html; break; default: goto xxumM; KhgLx: $ZpNyF = View::make($tURZC, $this->templateData)->render(); goto dDUfl; hc84D: if (null === $this->emailUserName) { $this->emailUserName = $this->email; } goto KhgLx; sZDmz: if (!view()->exists($tURZC)) { $tURZC = 'theme.' . modstart_config()->getWithEnv('siteTemplate', 'default') . '.mail.' . $this->template; if (!view()->exists($tURZC)) { $tURZC = 'theme.default.mail.' . $this->template; if (!view()->exists($tURZC)) { if ($this->module) { $tURZC = 'module::' . $this->module . '.View.mail.' . $this->template; } if (!view()->exists($tURZC)) { $tURZC = 'module::Vendor.View.mail.' . $this->template; } } } } goto Vg2ij; xxumM: $tURZC = $this->template; goto sZDmz; Vg2ij: if (!view()->exists($tURZC)) { throw new \Exception('mail view not found : ' . $tURZC); } goto hc84D; dDUfl: break; goto ne3DO; ne3DO: } goto pIdhG; uW4ji: $X0c2E = MailSenderProvider::get($yHanX); goto aoe0k; Tomls: Logger::info('Email', 'End', $this->email . ' - ' . $this->subject); goto a8hdH; MEzpo: $yHanX = app()->config->get('EmailSenderProvider'); goto uW4ji; a8hdH: } }