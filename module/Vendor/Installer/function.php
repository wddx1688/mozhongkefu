<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ goto QqoEk; bOEkm: define('INSTALL_LOCK_FILE', APP_PATH . '/storage/install.lock'); goto bXfKq; zJUta: function text_error($miOiF, $inYhe = null, $bWr4T = true) { if ($bWr4T) { error_counter(); } echo '<div class="ub-alert danger">× ' . $miOiF . ' ' . ($inYhe ? '<a target="_blank" href="' . $inYhe . '">解决办法</a>' : '') . '</div>'; } goto p5uVC; s8i5j: if (!defined('INSTALL_APP')) { define('INSTALL_APP', 'APP'); } goto gHkoP; pzcN6: if (class_exists(\App\Constant\AppConstant::class)) { goto bq0Xt; pdkHv: if (defined('\\App\\Constant\\AppConstant::APP_NAME')) { define('INSTALL_APP_NAME', \App\Constant\AppConstant::APP_NAME); } goto KMkIy; bq0Xt: if (defined('\\App\\Constant\\AppConstant::APP')) { define('INSTALL_APP', strtoupper(\App\Constant\AppConstant::APP)); } goto pdkHv; KMkIy: if (defined('\\App\\Constant\\AppConstant::VERSION')) { define('INSTALL_APP_VERSION', \App\Constant\AppConstant::VERSION); } goto rnjCb; rnjCb: } goto s8i5j; gmf17: function request_schema() { goto jW08Q; jW08Q: $XA9nm = 'http'; goto x2H4l; FeZ7O: return $XA9nm; goto qxG1A; x2H4l: if (is_https()) { $XA9nm = 'https'; } goto FeZ7O; qxG1A: } goto m2cm_; MnCTC: if (file_exists($DHPQB = APP_PATH . '/app/Constant/AppConstant.php')) { include $DHPQB; } goto uPax_; ZedPd: function text_success($miOiF) { echo '<div class="ub-alert success">√ ' . $miOiF . '</div>'; } goto zJUta; oO7jR: function error_counter($SuDVZ = 1) { goto oGWRL; IYdPF: $batrN += $SuDVZ; goto fx85z; fx85z: return $batrN; goto pG723; oGWRL: static $batrN = 0; goto IYdPF; pG723: } goto sHUXf; InTCW: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/EnvUtil.php'; goto qWXqX; sHUXf: function env_writable() { goto SxS6W; zwpwr: if (false === file_put_contents($n8fWJ, $n3GvS)) { return false; } goto yWpUK; exOwf: $n3GvS = @file_get_contents($n8fWJ); goto zwpwr; yWpUK: return true; goto EpFj1; SxS6W: $n8fWJ = APP_PATH . '/.env'; goto canZC; canZC: if (!file_exists($n8fWJ)) { goto LbuzU; LbuzU: if (false === file_put_contents($n8fWJ, '')) { @unlink($n8fWJ); return false; } goto tdI1P; M5_Zo: return true; goto Wh6O8; tdI1P: @unlink($n8fWJ); goto M5_Zo; Wh6O8: } goto exOwf; EpFj1: } goto lgNpb; V0lea: function request_is_post() { return !empty($_POST); } goto jp55J; QzApj: function get_env_config($Cc2wA, $yiNQ6 = '') { goto rrvTL; CxHOq: if (isset($ikNF5[$Cc2wA])) { foreach ($ikNF5[$Cc2wA] as $U8G_W) { $gghxW = @getenv($U8G_W); if (!empty($gghxW)) { return $gghxW; } } } goto Gs3OV; Gs3OV: $O97u0 = array('db_host' => 'DB_HOST', 'db_port' => 'DB_PORT', 'db_name' => 'DB_DATABASE', 'db_username' => 'DB_USERNAME', 'db_password' => 'DB_PASSWORD', 'db_prefix' => 'DB_PREFIX', 'admin_username' => 'ADMIN_USERNAME', 'admin_password' => 'ADMIN_PASSWORD'); goto tAAxf; rrvTL: static $inb3k = null; goto rV2T9; F3TSJ: $ikNF5 = array('db_host' => array('DB_HOST', 'MYSQL_HOST'), 'db_port' => array('DB_DATABASE', 'MYSQL_PORT'), 'db_name' => array('DB_DATABASE', 'MYSQL_DB'), 'db_username' => array('DB_USERNAME', 'MYSQL_USER'), 'db_password' => array('DB_PASSWORD', 'MYSQL_PASSWORD'), 'db_prefix' => array('DB_PREFIX'), 'admin_username' => array('ADMIN_USERNAME'), 'admin_password' => array('ADMIN_PASSWORD')); goto CxHOq; tAAxf: if (isset($O97u0[$Cc2wA])) { $gghxW = env($O97u0[$Cc2wA], null); if (!is_null($gghxW)) { return $gghxW; } } goto nMHXI; yNhCP: if (isset($inb3k[$Cc2wA])) { return $inb3k[$Cc2wA]; } goto F3TSJ; nMHXI: return $yiNQ6; goto zEsFS; rV2T9: if (null == $inb3k) { $inb3k = array(); if (!empty($na0Xk = glob(APP_PATH . '/env.*.json'))) { foreach ($na0Xk as $EwRcc) { $P2ylS = @json_decode(@file_get_contents($EwRcc), true); if (!empty($P2ylS)) { $inb3k = array_merge($inb3k, $P2ylS); } } } } goto yNhCP; zEsFS: } goto FI3_z; FI3_z: function response_json_error_quit($miOiF) { response_json_quit(-1, $miOiF); } goto jKgUq; wAAbJ: if (file_exists($bqZki = APP_PATH . '/license_url.txt')) { define('LICENSE_URL', trim(file_get_contents($bqZki))); } goto SYB3i; PKOlZ: if (!defined('INSTALL_APP_VERSION')) { define('INSTALL_APP_VERSION', '0.0.0'); } goto xzHiV; jp55J: function is_https() { if (!empty($_SERVER['HTTPS']) && strtolower($_SERVER['HTTPS']) !== 'off') { return true; } elseif (isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === 'https') { return true; } elseif (!empty($_SERVER['HTTP_FRONT_END_HTTPS']) && strtolower($_SERVER['HTTP_FRONT_END_HTTPS']) !== 'off') { return true; } return false; } goto KhzTp; lgNpb: function rewrite_check() { goto XprIw; ur0w1: $L0UG0 = request_domain(); goto QRfY5; rsus0: $FZUh3 = \ModStart\Core\Util\CurlUtil::get($VwfRl, array(), array('timeout' => 3)); goto SvkS2; XprIw: if (file_exists(APP_PATH . '/storage/rewrite.skip')) { return array('code' => 0, 'msg' => 'ok'); } goto ur0w1; JxpGW: $WjX62 = array(); goto hXjwu; SvkS2: if ($FZUh3['body'] === 'ok') { return array('code' => 0, 'msg' => ''); } goto JxpGW; WZpIo: $WjX62[] = "- 您还可以在浏览器访问 <a href='{$VwfRl}' target='_blank'>{$VwfRl}</a> 查看报错信息，调整配置保证测试页面提示“ok”字样"; goto DZaY4; Asvoc: if (!empty($FZUh3['code'])) { if (!empty($FZUh3['body'])) { goto y89UT; lfJQn: if (false !== $oPu4k) { $miOiF = substr($miOiF, $oPu4k); } goto smOMu; h6E0j: $oPu4k = strpos($FZUh3['body'], '<body>'); goto lfJQn; mk5Fr: $WjX62[] = '- 程序出错:' . preg_replace('/\\s+/', ' ', preg_replace('/<[^>]+>/', '', $miOiF)); goto xLZf_; YzTTQ: if (false !== $oPu4k) { $miOiF = substr($miOiF, 0, $oPu4k); } goto mk5Fr; smOMu: $oPu4k = strpos($FZUh3['body'], '</body>'); goto YzTTQ; y89UT: $miOiF = $FZUh3['body']; goto h6E0j; xLZf_: } } goto WZpIo; DZaY4: return array('code' => -1, 'msg' => 'Rewrite规则错误可能原因（仅供参考）：<br/>' . join('<br/>', $WjX62)); goto Uzvbr; hXjwu: if (!empty($FZUh3['error'])) { if (false !== strpos($FZUh3['error'], 'Resolving timed out')) { $WjX62[] = "- 域名 {$L0UG0} 解析失败（可能您没有解析域名）"; $WjX62[] = "- 在服务器不能访问 {$VwfRl} ，需要在程序中通过改地址访问到程序"; } else { $WjX62[] = '- ERROR:' . $FZUh3['error']; } } goto Asvoc; QRfY5: $VwfRl = request_url() . '/install/ping'; goto rsus0; Uzvbr: } goto PST01; lBqR6: include APP_PATH . '/vendor/modstart/modstart/src/Core/Env/EnvUtil.php'; goto InTCW; uPax_: include APP_PATH . '/vendor/modstart/modstart/src/Data/FileManager.php'; goto lBqR6; TM36x: define('ENV_FILE', APP_PATH . '/.env'); goto wAAbJ; cr3qI: function php_version_requires() { if (php_is_laravel9()) { return join('，', array('8.1.x')); } return join(', ', array('5.6.x', '7.0.x')); } goto PXT6P; PST01: function env($Cc2wA, $BHEh0 = '') { goto x_aUF; x_aUF: static $aOaiS = null; goto vOPdt; vOPdt: if (null === $aOaiS) { $aOaiS = \ModStart\Core\Util\EnvUtil::all(ENV_FILE_EXAMPLE); } goto qGyIT; qGyIT: return isset($aOaiS[$Cc2wA]) ? $aOaiS[$Cc2wA] : $BHEh0; goto NuEt6; NuEt6: } goto qOLb4; EdEQ6: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/CurlUtil.php'; goto JtZVw; jKgUq: function response_json_quit($fKl3n, $miOiF, $XWlC_ = null, $mDpIY = null) { goto kY51I; kY51I: header('Content-type: application/json'); goto J15QJ; KaT3P: die; goto T1IKl; J15QJ: echo json_encode(array('code' => $fKl3n, 'msg' => $miOiF, 'data' => $XWlC_, 'redirect' => $mDpIY)); goto KaT3P; T1IKl: } goto gmf17; p5uVC: function text_warning($miOiF, $inYhe = null) { echo '<div class="ub-alert warning">? ' . $miOiF . ' ' . ($inYhe ? '<a target="_blank" href="' . $inYhe . '">解决办法</a>' : '') . '</div>'; } goto oO7jR; bXfKq: define('ENV_FILE_EXAMPLE', APP_PATH . '/env.example'); goto TM36x; qWXqX: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/RandomUtil.php'; goto EdEQ6; jXAiD: function request_url() { return request_schema() . '://' . request_domain(); } goto V0lea; JtZVw: include APP_PATH . '/vendor/modstart/modstart/src/Core/Util/FileUtil.php'; goto bOEkm; gHkoP: if (!defined('INSTALL_APP_NAME')) { if (defined('INSTALL_APP')) { define('INSTALL_APP_NAME', INSTALL_APP); } else { define('INSTALL_APP_NAME', 'APP'); } } goto PKOlZ; SYB3i: if (file_exists($Lh0dF = APP_PATH . '/public/data_demo/data.php')) { define('DEMO_DATA', true); } goto pzcN6; xzHiV: if (!file_exists(ENV_FILE)) { file_put_contents(ENV_FILE, 'APP_ENV=beta
APP_DEBUG=true
APP_KEY=' . \ModStart\Core\Util\RandomUtil::string(32)); } goto cZjgM; KhzTp: function request_post($U8G_W, $BHEh0 = '') { return isset($_POST[$U8G_W]) ? $_POST[$U8G_W] : $BHEh0; } goto ZedPd; PXT6P: function php_version_ok() { goto r9qWC; gTDK1: if (version_compare(PHP_VERSION, '5.5.9', '<')) { return false; } goto oASW0; r9qWC: if (php_is_laravel9()) { if (version_compare(PHP_VERSION, '8.1.0', '<')) { return false; } return true; } goto gTDK1; DX6Hs: return true; goto ZsNXq; oASW0: if (version_compare(PHP_VERSION, '7.1.0', '>=')) { return false; } goto DX6Hs; ZsNXq: } goto QzApj; QqoEk: define('APP_PATH', realpath(__DIR__ . '/../../../')); goto MnCTC; cZjgM: function php_is_laravel9() { return in_array(INSTALL_APP, array('CMS9', 'BLOG9')); } goto cr3qI; m2cm_: function request_domain() { return $_SERVER['HTTP_HOST']; } goto jXAiD; qOLb4: function is_dir_really_writable($RrlCs) { goto Wj3qp; Bo8Zb: return true; goto Igkkn; Wj3qp: $RrlCs = rtrim($RrlCs, '/\\') . '/'; goto kqar4; PwJzF: @unlink($qdqJi); goto Bo8Zb; kqar4: $qdqJi = $RrlCs . '.writable_test_file'; goto zuQMI; EZf3l: if (!file_exists($qdqJi)) { return false; } goto wFwX7; wFwX7: if (file_get_contents($qdqJi) != 'test') { return false; } goto PwJzF; zuQMI: @file_put_contents($qdqJi, 'test'); goto EZf3l; Igkkn: }