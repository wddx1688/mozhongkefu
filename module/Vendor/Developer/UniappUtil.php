<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Developer; use ModStart\Core\Util\PlatformUtil; use ModStart\Core\Util\ReUtil; include_once __DIR__ . '/../Shell/include.php'; class UniappUtil { public static function runOrFail($YmK0O) { goto RE7WV; RE7WV: shell_echo_info("开始运行 {$YmK0O}"); goto pfkk7; pfkk7: passthru($YmK0O, $o8Yz3); goto RTTcr; RTTcr: if ($o8Yz3 !== 0) { shell_echo_error('运行命令 ' . $YmK0O . ' 失败'); die(1); } goto HLZ89; HLZ89: } public static function build($RrlCs) { goto rTaEp; RNUi6: shell_file_write($HX37m, $uzyhW); goto PODHL; KH9qQ: $e8PBh = $rGUSQ[2]; goto HWK26; SFlJw: shell_ensure_dir(shell_module_path($NS22k, 'Asset')); goto bAy7g; H74Qc: shell_echo_block('温馨提示'); goto ZK1l1; BU5jS: shell_echo_block('处理HTML文件'); goto v700i; YMOxU: $uzyhW = str_replace(array_keys($Eh3Vd), array_values($Eh3Vd), $e8PBh); goto hyZ7c; ZK1l1: shell_echo_info('如果您的正在运行的网站还没有更新静态资源，您需要运行如下命令更新模块静态资源'); goto G7001; CjF1A: $mnt2N = glob('dist/build/h5/static/js/*.js'); goto xUWvo; aYqO_: shell_echo_success('打包完成'); goto H74Qc; aqnUt: shell_throws_if('系统只持支Linux和OSX', !PlatformUtil::isType(array(PlatformUtil::LINUX, PlatformUtil::OSX))); goto G00ru; rTaEp: $NS22k = ReUtil::group1('/module[\\/\\\\](.*?)[\\/\\\\]resources/', $RrlCs); goto Nn_xn; YQ6La: shell_echo_success('环境正常'); goto WhVKK; w3xjB: preg_match('/<head>([\\s\\S]+)<\\/head>[\\s\\S]*<body>([\\s\\S]+)<\\/body>/', $n3GvS, $rGUSQ); goto C5ds4; o26_H: $fQCUC = str_replace(array_keys($Eh3Vd), array_values($Eh3Vd), $UK3_V); goto YMOxU; coonR: passthru('rm -rfv ' . shell_module_path($NS22k, 'Asset/static/')); goto h5q8V; xUWvo: foreach ($mnt2N as $n8fWJ) { goto kyNFD; jt_J_: $n3GvS = file_get_contents($n8fWJ); goto pEEiH; kyNFD: shell_echo_info($n8fWJ); goto jt_J_; HQBWW: file_put_contents($n8fWJ, $n3GvS); goto uc_9C; pEEiH: $n3GvS = str_replace(array_keys($Eh3Vd), array_values($Eh3Vd), $n3GvS); goto HQBWW; uc_9C: } goto TdAth; bAy7g: shell_echo_info('清空目录'); goto coonR; eH6zU: shell_throws_if('解析模块名称失败', empty($NS22k)); goto YQ6La; Nn_xn: shell_echo_block('检查环境'); goto yoctR; JNIjG: $aE_0U = shell_module_path($NS22k, 'View/m/' . lcfirst($NS22k) . '/head.blade.php'); goto poArN; A6hvo: self::runOrFail('npm run build:h5'); goto BU5jS; SQDfO: $Eh3Vd = array('"__cdn_url__/"' => 'window.__msCDN+"vendor/' . $NS22k . '/"', '"/static/' => 'window.__msCDN+"vendor/' . $NS22k . '/static/'); goto CjF1A; C5ds4: $UK3_V = $rGUSQ[1]; goto KH9qQ; poArN: $HX37m = shell_module_path($NS22k, 'View/m/' . lcfirst($NS22k) . '/body.blade.php'); goto yyB7l; PODHL: shell_echo_block('处理静态文件'); goto SQDfO; TdAth: shell_echo_block('更新模块静态资源'); goto SFlJw; G00ru: shell_throws_if('请安装 nodejs，安装后自检 npm --version 输出正确', !shell_command_check('npm --version')); goto eH6zU; yyB7l: shell_file_write($aE_0U, $fQCUC); goto RNUi6; G7001: shell_echo_info("php artisan modstart:module-install {$NS22k} --force"); goto DThl_; yoctR: shell_throws_if('请进入 ' . $RrlCs . '目录再运行该脚本', getcwd() !== $RrlCs); goto aqnUt; ZQas2: shell_echo_info('处理Body : ' . strlen($e8PBh) . ' -> ' . strlen($uzyhW)); goto JNIjG; hyZ7c: shell_echo_info('处理Head : ' . strlen($UK3_V) . ' -> ' . strlen($fQCUC)); goto ZQas2; VSOv0: passthru('cp -av dist/build/h5/static ' . shell_module_path($NS22k, 'Asset/static/')); goto aYqO_; h5q8V: shell_echo_info('更新文件'); goto VSOv0; v700i: $n3GvS = file_get_contents('dist/build/h5/index.html'); goto w3xjB; HWK26: $Eh3Vd = array('__cdn_url__/' => '{{\\ModStart\\Core\\Assets\\AssetsUtil::cdn()}}vendor/' . $NS22k . '/'); goto o26_H; WhVKK: shell_echo_block('开始编译'); goto qbZjw; qbZjw: self::runOrFail('npm install'); goto A6hvo; DThl_: } }