<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Job; use Illuminate\Support\Facades\View; use ModStart\Core\Exception\BizException; use ModStart\Core\Job\BaseJob; use Module\Vendor\Log\Logger; use Module\Vendor\Provider\MailSender\AbstractMailSenderProvider; use Module\Vendor\Provider\MailSender\MailSenderProvider; class MailSendJob extends BaseJob { public $email; public $subject; public $template; public $templateData = array(); public $emailUserName = null; public $option = array(); public $module; public $html; public $type; private static function checkConfig() { $yHanX = app()->config->get('EmailSenderProvider'); BizException::throwsIfEmpty('邮箱发送未设置', $yHanX); } public static function createHtml($PcW1B, $UeeeP, $ZpNyF, $IinAz = null, $cD48i = array(), $nysIy = 0) { goto I1SfH; YrYZc: $Q10Sr->subject = $UeeeP; goto ClnZ1; z02Gy: if ($nysIy > 0) { $Q10Sr->delay($nysIy); } goto moFX2; aA_Ve: $Q10Sr->option = $cD48i; goto z02Gy; l21we: $Q10Sr->emailUserName = $IinAz; goto aA_Ve; y5RK7: $Q10Sr = new static(); goto N9_Bn; N9_Bn: $Q10Sr->type = 'html'; goto q25hK; ClnZ1: $Q10Sr->html = $ZpNyF; goto l21we; I1SfH: self::checkConfig(); goto y5RK7; q25hK: $Q10Sr->email = $PcW1B; goto YrYZc; moFX2: app('Illuminate\\Contracts\\Bus\\Dispatcher')->dispatch($Q10Sr); goto JMWX7; JMWX7: } public static function createModule($NS22k, $mPYOc, $PcW1B, $UeeeP, $NALde = array(), $IinAz = null, $cD48i = array(), $nysIy = 0) { self::create($PcW1B, $UeeeP, $mPYOc, $NALde, $IinAz, $cD48i, $nysIy, $NS22k); } public static function create($PcW1B, $UeeeP, $mPYOc, $NALde = array(), $IinAz = null, $cD48i = array(), $nysIy = 0, $NS22k = null) { goto K14Vm; RvxHS: $Q10Sr->template = $mPYOc; goto te1yp; YRqyy: $Q10Sr->emailUserName = $IinAz; goto pLjqW; Fl0Ss: app('Illuminate\\Contracts\\Bus\\Dispatcher')->dispatch($Q10Sr); goto xt1Vd; pLjqW: $Q10Sr->option = $cD48i; goto ZHgwZ; eAeSd: if ($nysIy > 0) { $Q10Sr->delay($nysIy); } goto Fl0Ss; K14Vm: self::checkConfig(); goto q2r65; kfv4k: $Q10Sr->subject = $UeeeP; goto RvxHS; TVLZU: $Q10Sr->email = $PcW1B; goto kfv4k; te1yp: $Q10Sr->templateData = $NALde; goto YRqyy; q2r65: $Q10Sr = new static(); goto TVLZU; ZHgwZ: $Q10Sr->module = $NS22k; goto eAeSd; xt1Vd: } public function handle() { goto lZxfg; PLa_r: switch ($this->type) { case 'html': $ZpNyF = $this->html; break; default: goto g9XRY; g9XRY: $tURZC = $this->template; goto IXWmf; JuQ9U: break; goto zg20o; IXWmf: if (!view()->exists($tURZC)) { $tURZC = 'theme.' . modstart_config()->getWithEnv('siteTemplate', 'default') . '.mail.' . $this->template; if (!view()->exists($tURZC)) { $tURZC = 'theme.default.mail.' . $this->template; if (!view()->exists($tURZC)) { if ($this->module) { $tURZC = 'module::' . $this->module . '.View.mail.' . $this->template; } if (!view()->exists($tURZC)) { $tURZC = 'module::Vendor.View.mail.' . $this->template; } } } } goto lHSou; lHSou: if (!view()->exists($tURZC)) { throw new \Exception('mail view not found : ' . $tURZC); } goto OHZyc; OHZyc: if (null === $this->emailUserName) { $this->emailUserName = $this->email; } goto Vmmqw; Vmmqw: $ZpNyF = View::make($tURZC, $this->templateData)->render(); goto JuQ9U; zg20o: } goto qAuFg; OPy4_: BizException::throwsIfResponseError($FZUh3); goto tZF76; qAuFg: BizException::throwsIfEmpty('MailSendJob.HtmlEmpty', $ZpNyF); goto okPg3; T2kHi: $X0c2E = MailSenderProvider::get($yHanX); goto N6Lhv; okPg3: $FZUh3 = $X0c2E->send($this->email, $this->emailUserName, $this->subject, $ZpNyF); goto OPy4_; tZF76: Logger::info('Email', 'End', $this->email . ' - ' . $this->subject); goto uTHGW; lZxfg: $yHanX = app()->config->get('EmailSenderProvider'); goto T2kHi; N6Lhv: Logger::info('Email', 'Start', $this->email . ' - ' . $this->subject . ' - ' . $this->template); goto PLa_r; uTHGW: } }