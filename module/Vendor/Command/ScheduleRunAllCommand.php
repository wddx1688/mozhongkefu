<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Vendor\Command; use Illuminate\Console\Command; use Illuminate\Support\Facades\Log; use Illuminate\Support\Str; use ModStart\Core\Util\ArrayUtil; use ModStart\Core\Util\FileUtil; use ModStart\Core\Util\ShellUtil; use ModStart\Core\Util\TimeUtil; use ModStart\ModStart; use Module\Vendor\Util\CacheUtil; class ScheduleRunAllCommand extends Command { protected $signature = 'modstart:schedule-run-all {php} {dir}'; public function handle() { goto MeLm2; HhKTE: $k5S8c = CacheUtil::remember('Vendor:ScheduleRunAll:Projects:' . $tNnqn, 3600, function () use($RrlCs) { $k5S8c = FileUtil::listFiles($RrlCs); $k5S8c = array_filter($k5S8c, function ($njUmW) { return $njUmW['isDir'] && @file_exists($njUmW['pathname'] . '/artisan') && @file_exists($njUmW['pathname'] . '/.env') && !Str::startsWith($njUmW['filename'], '_delete.') && @file_exists($njUmW['pathname'] . '/vendor/modstart/modstart-' . ModStart::env()); }); shuffle($k5S8c); return ArrayUtil::keepItemsKeys($k5S8c, array('pathname')); }); goto Gay8s; jTFQc: $RrlCs = $this->argument('dir'); goto KHrII; KHrII: $tNnqn = md5($FumLZ . ':' . $RrlCs); goto HhKTE; MeLm2: $FumLZ = $this->argument('php'); goto jTFQc; Gay8s: foreach ($k5S8c as $w3n0R) { goto VckzK; KxldP: Log::info("Vendor.ScheduleRunAllCommand.Result - {$FEjaa} - {$uVRy6}ms"); goto WExUF; vs0iS: $FEjaa = str_replace(array(''), '', $FEjaa); goto n4csG; DYiU0: $FEjaa = ShellUtil::run($YmK0O, false); goto vs0iS; qBfcs: $FEjaa = str_replace('No scheduled commands are ready to run.', '〇', $FEjaa); goto nYQ3H; tqA87: Log::info("Vendor.ScheduleRunAllCommand.Run - {$YmK0O}"); goto DYiU0; nYQ3H: $uVRy6 = TimeUtil::millitime() - $x5GcS; goto KxldP; n4csG: $FEjaa = str_replace('
', ' ', $FEjaa); goto ilaeM; VckzK: $x5GcS = TimeUtil::millitime(); goto YIPGS; YIPGS: $YmK0O = "{$FumLZ} {$w3n0R['pathname']}/artisan schedule:run"; goto tqA87; ilaeM: $FEjaa = str_replace('Running scheduled command: Closure', '√', $FEjaa); goto qBfcs; WExUF: } goto DhFSr; DhFSr: } }