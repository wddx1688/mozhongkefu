<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Oauth; use ModStart\Core\Input\Response; use Module\Member\Util\MemberUtil; abstract class AbstractOauth { public function hasRender() { return true; } public function isSupport() { return true; } public function color() { return null; } public function title() { return $this->name(); } public function oauthKey() { return $this->name(); } public abstract function name(); public abstract function render(); public function bindRender() { return null; } public abstract function processRedirect($uZEpM); public abstract function processLogin($uZEpM); public function processTryLogin($uZEpM) { goto q5hWa; Tj0Ug: $hYN3E = $cPWai['openid']; goto pysQZ; q5hWa: $cPWai = $uZEpM['userInfo']; goto Tj0Ug; pysQZ: $tJ6XI = MemberUtil::getIdByOauthAndCheck($this->name(), $hYN3E); goto YmjaK; YmjaK: if ($tJ6XI) { return Response::generateSuccessData(array('memberUserId' => $tJ6XI)); } goto UJqBK; UJqBK: return Response::generateSuccessData(array('memberUserId' => 0)); goto Qltxx; Qltxx: } public function processBindToUser($uZEpM) { goto jQxrJ; BHCzt: $vWdBd = MemberUtil::getIdByOauthAndCheck($this->name(), $cPWai['openid']); goto pviEB; pviEB: if ($vWdBd && $tJ6XI != $vWdBd) { MemberUtil::forgetOauth($this->name(), $cPWai['openid']); } goto ZRqBU; s96jL: MemberUtil::putOauth($tJ6XI, $this->name(), $cPWai['openid'], $hEapL); goto FzhdV; JxsNv: if (!empty($cPWai['username'])) { $hEapL['infoUsername'] = $cPWai['username']; } goto TYFFy; TYFFy: if (!empty($cPWai['avatar'])) { $hEapL['infoAvatar'] = $cPWai['avatar']; } goto s96jL; jQxrJ: $tJ6XI = $uZEpM['memberUserId']; goto HRg4S; HRg4S: $cPWai = $uZEpM['userInfo']; goto BHCzt; FzhdV: return Response::generateSuccess(); goto uFVAh; ZRqBU: $hEapL = array(); goto JxsNv; uFVAh: } }