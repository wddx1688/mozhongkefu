<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use Illuminate\Support\Facades\View; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; class WebAuthMiddleware { public function handle($Sh3_E, \Closure $JNgx0) { goto HvF9O; Fu7Ky: return $JNgx0($Sh3_E); goto ytCUx; OtM4s: if (empty($tJ6XI)) { if (is_subclass_of($HB1O4, MemberLoginCheck::class)) { if (property_exists($HB1O4, 'memberLoginCheckIgnores') && is_array($HB1O4::$memberLoginCheckIgnores) && in_array($yA25I, $HB1O4::$memberLoginCheckIgnores)) { } else { return Response::send(-1, null, null, modstart_web_url('login') . '?redirect=' . urlencode(Request::currentPageUrl())); } } } goto o5WG0; o5WG0: Session::put('memberUserId', $tJ6XI); goto r7MzT; driEJ: View::share('_memberUser', $CRCLA); goto Fu7Ky; r7MzT: Session::flash('_memberUser', $CRCLA); goto driEJ; cWAnf: if ($tJ6XI) { goto KIH6A; G9kZu: MemberUtil::processDefault($CRCLA); goto JnMAv; JnMAv: if ($CRCLA) { switch ($CRCLA['status']) { case MemberStatus::FORBIDDEN: $CRCLA = null; break; } } goto EOTB9; KIH6A: $CRCLA = MemberUtil::get($tJ6XI); goto G9kZu; EOTB9: } goto m2f2U; WbWPN: $CRCLA = null; goto cWAnf; HvF9O: list($HB1O4, $yA25I) = Request::getControllerAction(); goto kXcZv; kH021: View::share('_memberUserId', $tJ6XI); goto OtM4s; m2f2U: if ($tJ6XI && !$CRCLA) { $tJ6XI = 0; Session::forget('memberUserId'); } goto kH021; kXcZv: $tJ6XI = intval(Session::get('memberUserId', 0)); goto WbWPN; ytCUx: } }