<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\Member\Middleware; use Illuminate\Support\Facades\Session; use ModStart\Core\Input\Request; use ModStart\Core\Input\Response; use Module\Member\Support\MemberLoginCheck; use Module\Member\Type\MemberStatus; use Module\Member\Util\MemberUtil; use Module\Vendor\Support\ResponseCodes; class ApiAuthMiddleware { public function handle($Sh3_E, \Closure $JNgx0) { goto Iyiyi; pebKO: $CRCLA = null; goto oMGI6; o9e_5: Session::flash('_memberUser', $CRCLA); goto wtvAd; soSqo: if ($tJ6XI && !$CRCLA) { $tJ6XI = 0; Session::forget('memberUserId'); } goto CHXpd; oMGI6: if ($tJ6XI) { goto JdVun; j1qLV: if ($CRCLA) { switch ($CRCLA['status']) { case MemberStatus::FORBIDDEN: $CRCLA = null; break; } if ($CRCLA['isDeleted']) { $CRCLA = null; } } goto MS70q; FAalQ: MemberUtil::processDefault($CRCLA); goto j1qLV; JdVun: $CRCLA = MemberUtil::get($tJ6XI); goto FAalQ; MS70q: } goto soSqo; wtvAd: return $JNgx0($Sh3_E); goto fpGhE; Iyiyi: list($HB1O4, $yA25I) = Request::getControllerAction(); goto D_Qt2; D_Qt2: $tJ6XI = intval(Session::get('memberUserId', 0)); goto pebKO; CHXpd: if (empty($tJ6XI)) { if (is_subclass_of($HB1O4, MemberLoginCheck::class)) { if (property_exists($HB1O4, 'memberLoginCheckIgnores') && is_array($HB1O4::$memberLoginCheckIgnores) && in_array($yA25I, $HB1O4::$memberLoginCheckIgnores)) { } else { return Response::json(ResponseCodes::LOGIN_REQUIRED, '请登录', null, modstart_web_url('login', array('redirect' => Request::currentPageUrl()))); } } } goto MAx6l; MAx6l: Session::put('memberUserId', $tJ6XI); goto o9e_5; fpGhE: } }