<?php
/**
 * ------------------------ 
 *  版权所有  www.tecmz.com
 *  商业版本请购买正版授权使用
 * ------------------------
*/ namespace Module\LiveChat\Api\Controller; use ModStart\Core\Dao\ModelUtil; use ModStart\Core\Exception\BizException; use ModStart\Core\Input\InputPackage; use ModStart\Core\Input\Response; use Module\ImServer\Core\Model\ServiceModel; use Module\ImServer\Core\Model\UserModel; use Module\ImServer\Core\Repository\ServiceRepository; use Module\ImServer\Core\Repository\UserRepository; use Module\LiveChat\Constant\LiveChatConstant; use Module\LiveChat\Type\AccountChatStatus; use Module\LiveChat\Util\AccountUtil; use Module\LiveChat\Util\ChannelUtil; use Module\LiveChat\Util\UserUtil; class StaffServiceController extends AbstractStaffController { public function userGet() { goto xDq9U; T48MH: $t9mtn['remark'] = $k81RV['remark']; goto gjWOa; xDq9U: $ErQts = InputPackage::buildFromInput(); goto XBiF4; ZEQq3: $ybVCD = ChannelUtil::get($t9mtn['channelId']); goto Rwva2; GpA1E: $t9mtn = array(); goto g0eQF; bHnvF: $t9mtn['avatar'] = $k81RV['avatar']; goto Bm3O3; tpTwe: $t9mtn['name'] = $k81RV['name']; goto T48MH; LaFZy: BizException::throwsIfEmpty('客户不存在', $k81RV); goto GpA1E; kmy5k: $FhRrv = ServiceModel::get($FWfay); goto qZrAN; Rwva2: $t9mtn['channelTitle'] = $ybVCD ? $ybVCD['title'] : null; goto T84c_; r0TGo: $zcWCd = UserModel::get($FhRrv['creatorUserId']); goto DHvhf; DHvhf: $k81RV = UserUtil::get($zcWCd['bizId']); goto LaFZy; g0eQF: $t9mtn['id'] = $k81RV['id']; goto rHpuD; qZrAN: BizException::throwsIfEmpty('客户不存在', $FhRrv); goto r0TGo; Bm3O3: $t9mtn['channelId'] = $k81RV['channelId']; goto ZEQq3; gjWOa: $t9mtn['ip'] = $k81RV['ip']; goto bHnvF; XBiF4: $FWfay = $ErQts->getInteger('serviceId'); goto kmy5k; rHpuD: $t9mtn['nickname'] = $k81RV['nickname']; goto tpTwe; T84c_: return Response::generateSuccessData(array('user' => $t9mtn)); goto pVApC; pVApC: } public function userSave() { goto PuFnL; u37rL: $FhRrv = ServiceModel::get($FWfay); goto CTtbT; yKfv7: $Bj5vh = array(); goto P_VuV; JeMXO: if (!empty($Bj5vh)) { ModelUtil::update('live_chat_user', $k81RV['id'], $Bj5vh); } goto pJ_ud; CTtbT: BizException::throwsIfEmpty('客户不存在', $FhRrv); goto nZM7c; DCJ9o: $k81RV = UserUtil::get($zcWCd['bizId']); goto GJS3p; GJS3p: BizException::throwsIfEmpty('客户不存在', $k81RV); goto yKfv7; huTGQ: if ($bv12A = $ErQts->getTrimString('remark')) { $Bj5vh['remark'] = $bv12A; } goto JeMXO; pJ_ud: return Response::generateSuccess(); goto rybp2; PuFnL: $ErQts = InputPackage::buildFromInput(); goto xxCn5; P_VuV: if ($rfBQu = $ErQts->getTrimString('name')) { $Bj5vh['name'] = $rfBQu; } goto huTGQ; xxCn5: $FWfay = $ErQts->getInteger('serviceId'); goto u37rL; nZM7c: $zcWCd = UserModel::get($FhRrv['creatorUserId']); goto DCJ9o; rybp2: } public function transfer() { goto WAEuQ; jestc: $x_TWK = UserRepository::get(LiveChatConstant::IM_USER_STAFF, $FXkbf['id']); goto NQY3o; vuf5k: BizException::throwsIfEmpty('客户不存在', $FhRrv); goto M24uI; sTrwJ: return Response::generateSuccess(); goto DNvNG; MYMKu: $FWfay = $ErQts->getInteger('serviceId'); goto XHeV4; zOoW0: $FXkbf = AccountUtil::get($iwLDV); goto FqXiO; oPYq2: ServiceRepository::pushQueueToUsers(LiveChatConstant::IM_SERVICE_NAME, $x_TWK['id']); goto sTrwJ; NQY3o: ServiceRepository::transfer($FhRrv['id'], $x_TWK['id']); goto oPYq2; xsg42: BizException::throwsIf('不能转接给自己', $iwLDV == $this->accountId()); goto cSgSO; FqXiO: BizException::throwsIfEmpty('转接客服不存在', $FXkbf); goto xsg42; M24uI: $iwLDV = $ErQts->getInteger('accountId'); goto zOoW0; WAEuQ: $ErQts = InputPackage::buildFromInput(); goto MYMKu; XHeV4: $FhRrv = ServiceModel::get($FWfay); goto vuf5k; cSgSO: BizException::throwsIf('当前客服不在线', $FXkbf['chatStatus'] != AccountChatStatus::ONLINE); goto jestc; DNvNG: } }